# ะะพะปะฝะฐั ะธะฝััััะบัะธั ะฟะพ ัะธััะตะผะต ัะพะตะดะธะฝะตะฝะธะน ะทะฐะดะฐั (Connections)

## ๐ ะกะพะดะตัะถะฐะฝะธะต
1. [ะะฑัะตะต ะพะฟะธัะฐะฝะธะต ัะธััะตะผั ัะพะตะดะธะฝะตะฝะธะน](#ะพะฑัะตะต-ะพะฟะธัะฐะฝะธะต-ัะธััะตะผั-ัะพะตะดะธะฝะตะฝะธะน)
2. [ะกะธััะตะผะฐ ะบะพะพัะดะธะฝะฐั ะธ ัะฐะทะผะตัะตะฝะธะต ะทะฐะดะฐั ะฝะฐ ะบะฐะฝะฒะฐัะต](#ัะธััะตะผะฐ-ะบะพะพัะดะธะฝะฐั-ะธ-ัะฐะทะผะตัะตะฝะธะต-ะทะฐะดะฐั-ะฝะฐ-ะบะฐะฝะฒะฐัะต)
3. [ะััะธัะตะบัััะฐ ะดะฐะฝะฝัั](#ะฐััะธัะตะบัััะฐ-ะดะฐะฝะฝัั)
4. [ะกะพะทะดะฐะฝะธะต ัะพะตะดะธะฝะตะฝะธะน](#ัะพะทะดะฐะฝะธะต-ัะพะตะดะธะฝะตะฝะธะน)
5. [ะคัะฝะบัะธั ะพััะธัะพะฒะบะธ ัะพะตะดะธะฝะตะฝะธะน](#ััะฝะบัะธั-ะพััะธัะพะฒะบะธ-ัะพะตะดะธะฝะตะฝะธะน)
6. [ะััะธัะปะตะฝะธะต ะบะพะพัะดะธะฝะฐั ัะพัะตะบ ัะพะตะดะธะฝะตะฝะธั](#ะฒััะธัะปะตะฝะธะต-ะบะพะพัะดะธะฝะฐั-ัะพัะตะบ-ัะพะตะดะธะฝะตะฝะธั)
7. [ะัะธะฒะฐั ะะตะทัะต - ะผะฐัะตะผะฐัะธะบะฐ ะธ ัะพัะผัะปะฐ](#ะบัะธะฒะฐั-ะฑะตะทัะต---ะผะฐัะตะผะฐัะธะบะฐ-ะธ-ัะพัะผัะปะฐ)
8. [ะะฑัะฐะฑะพัะบะฐ ะฟะตัะตัะฐัะบะธะฒะฐะฝะธั](#ะพะฑัะฐะฑะพัะบะฐ-ะฟะตัะตัะฐัะบะธะฒะฐะฝะธั)
9. [ะััะปะตะถะธะฒะฐะฝะธะต ะฒััะพัั ะบะฐััะพัะตะบ](#ะพััะปะตะถะธะฒะฐะฝะธะต-ะฒััะพัั-ะบะฐััะพัะตะบ)
10. [ะะธะทัะฐะปัะฝัะต ะฟะฐัะฐะผะตััั ัะพะตะดะธะฝะตะฝะธะน](#ะฒะธะทัะฐะปัะฝัะต-ะฟะฐัะฐะผะตััั-ัะพะตะดะธะฝะตะฝะธะน)
11. [ะะฝัะตะณัะฐัะธั ั ะบะฐะฝะฒะฐัะพะผ](#ะธะฝัะตะณัะฐัะธั-ั-ะบะฐะฝะฒะฐัะพะผ)
12. [ะฆะตะปัะฝะฐั ัะธััะตะผะฐ ัะฐะทะผะตัะตะฝะธั ะธ ัะพะตะดะธะฝะตะฝะธั](#ัะตะปัะฝะฐั-ัะธััะตะผะฐ-ัะฐะทะผะตัะตะฝะธั-ะธ-ัะพะตะดะธะฝะตะฝะธั)
13. [ะะฟัะธะผะธะทะฐัะธั ะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั](#ะพะฟัะธะผะธะทะฐัะธั-ะธ-ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั)
14. [ะัะธะผะตัั ะธ ััะตะฝะฐัะธะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธั](#ะฟัะธะผะตัั-ะธ-ััะตะฝะฐัะธะธ-ะธัะฟะพะปัะทะพะฒะฐะฝะธั)

---

## ะะฑัะตะต ะพะฟะธัะฐะฝะธะต ัะธััะตะผั ัะพะตะดะธะฝะตะฝะธะน

**ะกะธััะตะผะฐ ัะพะตะดะธะฝะตะฝะธะน** - ััะพ ะผะตัะฐะฝะธะทะผ ะฒะธะทัะฐะปัะฝะพะณะพ ะพัะพะฑัะฐะถะตะฝะธั ะธะตัะฐััะธัะตัะบะธั ัะฒัะทะตะน ะผะตะถะดั ะทะฐะดะฐัะฐะผะธ ะฝะฐ ะดะพัะบะต. ะกะพะตะดะธะฝะตะฝะธั ะฟัะตะดััะฐะฒะปััั ัะพะฑะพะน ะบัะธะฒัะต ะปะธะฝะธะธ (ะะตะทัะต), ะบะพัะพััะต ัะฒัะทัะฒะฐัั ัะพะดะธัะตะปััะบะธะต ะทะฐะดะฐัะธ ั ะดะพัะตัะฝะธะผะธ.

### ะัะฝะพะฒะฝัะต ัะฐัะฐะบัะตัะธััะธะบะธ:

- โ **ะขะธะฟ ัะฒัะทะธ:** ะะพะดะธัะตะปั-ะฟะพัะพะผะพะบ (parent-child)
- โ **ะะธะทัะฐะปะธะทะฐัะธั:** ะัะธะฒะฐั ะะตะทัะต (ะบัะฑะธัะตัะบะฐั)
- โ **ะะฐะฟัะฐะฒะปะตะฝะธะต:** ะั ะฝะธะถะฝะตะน ัะฐััะธ ัะพะดะธัะตะปั ะบ ะฒะตััะฝะตะน ัะฐััะธ ะฟะพัะพะผะบะฐ
- โ **ะะตะฐะปัะฐะนะผ ะพะฑะฝะพะฒะปะตะฝะธะต:** ะกะฒัะทะธ ะพะฑะฝะพะฒะปััััั ะฟัะธ ะฟะตัะตัะฐัะบะธะฒะฐะฝะธะธ ะทะฐะดะฐั
- โ **ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต:** ะกะฒัะทะธ ะผะฐัััะฐะฑะธัััััั ะฒะผะตััะต ั ะบะฐะฝะฒะฐัะพะผ
- โ **ะะธะทัะฐะปัะฝัะต ะผะฐัะบะตัั:** ะขะพัะบะธ ัะพะตะดะธะฝะตะฝะธั ะฝะฐ ะบะพะฝัะฐั ะปะธะฝะธะน

### ะัะธะฝัะธะฟ ัะฐะฑะพัั:

1. **ะกะฒัะทั ัะพะทะดะฐะตััั** ัะตัะตะท ะฟะพะปะต `parent_id` ะฒ ัะฐะฑะปะธัะต `tasks`
2. **ะกะพะตะดะธะฝะตะฝะธะต ะพััะธัะพะฒัะฒะฐะตััั** ััะฝะบัะธะตะน `drawTaskConnections()`
3. **ะะพะพัะดะธะฝะฐัั ะฒััะธัะปััััั** ะฝะฐ ะพัะฝะพะฒะต ะฟะพะทะธัะธะน ะธ ัะฐะทะผะตัะพะฒ ะบะฐััะพัะตะบ
4. **ะัะธะฒะฐั ัััะพะธััั** ะฟะพ ัะพัะผัะปะต ะบัะฑะธัะตัะบะพะน ะบัะธะฒะพะน ะะตะทัะต
5. **ะะฑะฝะพะฒะปะตะฝะธะต ะฟัะพะธััะพะดะธั** ะฟัะธ ะบะฐะถะดะพะผ ัะตะฝะดะตัะต ะบะพะผะฟะพะฝะตะฝัะฐ

---

## ะกะธััะตะผะฐ ะบะพะพัะดะธะฝะฐั ะธ ัะฐะทะผะตัะตะฝะธะต ะทะฐะดะฐั ะฝะฐ ะบะฐะฝะฒะฐัะต

### ะะฑัะตะต ะพะฟะธัะฐะฝะธะต ัะธััะตะผั ัะฐะทะผะตัะตะฝะธั

**ะะฐะฝะฒะฐั ะทะฐะดะฐั** - ััะพ ะฒะธัััะฐะปัะฝะพะต ะฟัะพัััะฐะฝััะฒะพ ัะฐะทะผะตัะพะผ 5000x5000 ะฟะธะบัะตะปะตะน, ะฝะฐ ะบะพัะพัะพะผ ัะฐะทะผะตัะฐัััั ะทะฐะดะฐัะธ ะฒ ะฐะฑัะพะปััะฝัั ะบะพะพัะดะธะฝะฐัะฐั. ะะฐะถะดะฐั ะทะฐะดะฐัะฐ ะธะผะตะตั ัะฒะพั ะฟะพะทะธัะธั `(position_x, position_y)`, ะบะพัะพัะฐั ะพะฟัะตะดะตะปัะตั ะปะตะฒัะน ะฒะตััะฝะธะน ัะณะพะป ะบะฐััะพัะบะธ ะทะฐะดะฐัะธ.

### ะะฐัะฐะผะตััั ะบะฐะฝะฒะฐัะฐ

**ะะฐะทะผะตัั:**
```typescript
const CANVAS_WIDTH = 5000   // ะจะธัะธะฝะฐ ะฒะธัััะฐะปัะฝะพะณะพ ะฟัะพัััะฐะฝััะฒะฐ
const CANVAS_HEIGHT = 5000  // ะััะพัะฐ ะฒะธัััะฐะปัะฝะพะณะพ ะฟัะพัััะฐะฝััะฒะฐ
```

**ะกะตัะบะฐ:**
```typescript
const GRID_SIZE = 20  // ะะฐะทะผะตั ััะตะนะบะธ ัะตัะบะธ ะฒ ะฟะธะบัะตะปัั
```

**ะะฐัััะฐะฑ:**
```typescript
const [scale, setScale] = useState(1)  // ะั 0.3 ะดะพ 2.0
```

**ะกะผะตัะตะฝะธะต (ะฟะฐะฝะพัะฐะผะธัะพะฒะฐะฝะธะต):**
```typescript
const [offset, setOffset] = useState({ x: 0, y: 0 })
```

---

### ะกะธััะตะผะฐ ะบะพะพัะดะธะฝะฐั

#### ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั (ะฟัะพัััะฐะฝััะฒะพ ะบะฐะฝะฒะฐัะฐ)

**ะะฟัะตะดะตะปะตะฝะธะต:**
- ะะฐัะฐะปะพ ะบะพะพัะดะธะฝะฐั: `(0, 0)` - ะปะตะฒัะน ะฒะตััะฝะธะน ัะณะพะป ะบะฐะฝะฒะฐัะฐ
- ะัั X: ะณะพัะธะทะพะฝัะฐะปัะฝะฐั, ัะฒะตะปะธัะธะฒะฐะตััั ะฒะฟัะฐะฒะพ
- ะัั Y: ะฒะตััะธะบะฐะปัะฝะฐั, ัะฒะตะปะธัะธะฒะฐะตััั ะฒะฝะธะท
- ะะดะธะฝะธัั ะธะทะผะตัะตะฝะธั: ะฟะธะบัะตะปะธ

**ะะธะฐะฟะฐะทะพะฝ:**
- X: ะพั `0` ะดะพ `5000`
- Y: ะพั `0` ะดะพ `5000`

**ะัะธะผะตั:**
```
(0, 0) โโโโโโโโโโโโโโโโโโโโโโโโโโโโ (5000, 0)
  โ                                    โ
  โ                                    โ
  โ         ะะธัััะฐะปัะฝัะน ะบะฐะฝะฒะฐั        โ
  โ           5000 x 5000px           โ
  โ                                    โ
  โ                                    โ
(0, 5000) โโโโโโโโโโโโโโโโโโโโโโโโโ (5000, 5000)
```

---

#### ะะพะพัะดะธะฝะฐัั ะทะฐะดะฐัะธ (position_x, position_y)

**ะะฟัะตะดะตะปะตะฝะธะต:**
- `position_x` - ะณะพัะธะทะพะฝัะฐะปัะฝะฐั ะบะพะพัะดะธะฝะฐัะฐ ะปะตะฒะพะณะพ ะฒะตััะฝะตะณะพ ัะณะปะฐ ะบะฐััะพัะบะธ
- `position_y` - ะฒะตััะธะบะฐะปัะฝะฐั ะบะพะพัะดะธะฝะฐัะฐ ะปะตะฒะพะณะพ ะฒะตััะฝะตะณะพ ัะณะปะฐ ะบะฐััะพัะบะธ
- ะะดะธะฝะธัั: ะฟะธะบัะตะปะธ ะฒ ะฟัะพัััะฐะฝััะฒะต ะบะฐะฝะฒะฐัะฐ

**ะกัััะบัััะฐ ะดะฐะฝะฝัั:**
```typescript
interface Task {
  id: string
  position_x: number  // X ะบะพะพัะดะธะฝะฐัะฐ ะปะตะฒะพะณะพ ะฒะตััะฝะตะณะพ ัะณะปะฐ
  position_y: number  // Y ะบะพะพัะดะธะฝะฐัะฐ ะปะตะฒะพะณะพ ะฒะตััะฝะตะณะพ ัะณะปะฐ
  // ...
}
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
(position_x, position_y) โ ะะตะฒัะน ะฒะตััะฝะธะน ัะณะพะป
         โโโโโโโโโโโโโโโโโโโโโโโ
         โ                     โ
         โ    ะะฐััะพัะบะฐ ะทะฐะดะฐัะธ   โ
         โ      width: 224px    โ
         โ     height: ~150px   โ
         โ                     โ
         โโโโโโโโโโโโโโโโโโโโโโโ
```

---

### ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต (Snap to Grid)

#### ะคัะฝะบัะธั ะฟัะธะฒัะทะบะธ

```typescript
const snapToGrid = (value: number) => Math.round(value / GRID_SIZE) * GRID_SIZE
```

**ะะฐัะฐะผะตััั:**
- `GRID_SIZE = 20` - ัะฐะทะผะตั ััะตะนะบะธ ัะตัะบะธ

**ะะฐัะตะผะฐัะธะบะฐ:**
1. ะะตะปะธะผ ะทะฝะฐัะตะฝะธะต ะฝะฐ ัะฐะทะผะตั ัะตัะบะธ: `value / 20`
2. ะะบััะณะปัะตะผ ะดะพ ะฑะปะธะถะฐะนัะตะณะพ ัะตะปะพะณะพ: `Math.round(...)`
3. ะฃะผะฝะพะถะฐะตะผ ะพะฑัะฐัะฝะพ: `... * 20`

**ะัะธะผะตัั:**
```
snapToGrid(37)  = Math.round(37 / 20) * 20 = Math.round(1.85) * 20 = 2 * 20 = 40
snapToGrid(123) = Math.round(123 / 20) * 20 = Math.round(6.15) * 20 = 6 * 20 = 120
snapToGrid(115) = Math.round(115 / 20) * 20 = Math.round(5.75) * 20 = 6 * 20 = 120
```

**ะะธะทัะฐะปะธะทะฐัะธั ัะตัะบะธ:**
```
  0    20   40   60   80   100  120  140
  โ    โ    โ    โ    โ    โ    โ    โ
  โโโโโโผโโโโโผโโโโโผโโโโโผโโโโโผโโโโโผโโโโโผโโ
  โ    โ    โ    โ    โ    โ    โ    โ
  โโโโโโผโโโโโผโโโโโผโโโโโผโโโโโผโโโโโผโโโโโผโโ
  โ    โ    โ    โ    โ    โ    โ    โ
  โโโโโโผโโโโโผโโโโโผโโโโโผโโโโโผโโโโโผโโโโโผโโ
```

**ะัะธะผะตะฝะตะฝะธะต:**
- ะัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะดะฐัะธ: `position_x = snapToGrid(x)`
- ะัะธ ะฟะตัะตะผะตัะตะฝะธะธ ะทะฐะดะฐัะธ: `position_x = snapToGrid(newX)`
- ะัะธ ัะพะทะดะฐะฝะธะธ ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ: `position_y = snapToGrid(parentY + 150)`

---

### ะะฐะทะผะตัั ะบะฐััะพัะบะธ ะทะฐะดะฐัะธ

#### ะจะธัะธะฝะฐ ะบะฐััะพัะบะธ

**ะคะธะบัะธัะพะฒะฐะฝะฝะฐั ัะธัะธะฝะฐ:**
```typescript
const parentWidth = 224  // ะจะธัะธะฝะฐ ัะพะดะธัะตะปััะบะพะน ะบะฐััะพัะบะธ
const childWidth = 224   // ะจะธัะธะฝะฐ ะดะพัะตัะฝะตะน ะบะฐััะพัะบะธ
```

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**
- ะะปั ะฒััะธัะปะตะฝะธั ัะตะฝััะฐ ะบะฐััะพัะบะธ: `position_x + width / 2`
- ะะปั ะฒััะธัะปะตะฝะธั ะฟัะฐะฒะพะณะพ ะบัะฐั: `position_x + width`
- ะะปั ัะพะตะดะธะฝะตะฝะธะน: ะฒัะตะณะดะฐ ะธัะฟะพะปัะทัะตััั `224px` (ะดะฐะถะต ะตัะปะธ ะบะฐััะพัะบะฐ ะธะทะผะตะฝะตะฝะฐ ัะตัะตะท resize)

**ะะพัะตะผั ัะธะบัะธัะพะฒะฐะฝะฝะพะต ะทะฝะฐัะตะฝะธะต:**
- ะฃะฟัะพัะฐะตั ะฒััะธัะปะตะฝะธั ะบะพะพัะดะธะฝะฐั ัะพะตะดะธะฝะตะฝะธะน
- ะะฑะตัะฟะตัะธะฒะฐะตั ััะฐะฑะธะปัะฝะพััั ะฟะพะทะธัะธะน ัะพัะตะบ ัะพะตะดะธะฝะตะฝะธั
- ะฆะตะฝัั ะบะฐััะพัะบะธ ะฒัะตะณะดะฐ ะฝะฐัะพะดะธััั ะฒ `position_x + 112`

---

#### ะััะพัะฐ ะบะฐััะพัะบะธ

**ะะธะฝะฐะผะธัะตัะบะฐั ะฒััะพัะฐ:**
```typescript
const parentHeight = taskHeights[parent.id] || 150
```

**ะััะพัะฝะธะบะธ ะฒััะพัั:**
1. **ะะท ัะพััะพัะฝะธั:** `taskHeights[taskId]` - ะธะทะผะตัะตะฝะฝะฐั ะฒััะพัะฐ ัะตัะตะท ResizeObserver
2. **ะะพ ัะผะพะปัะฐะฝะธั:** `150px` - ะตัะปะธ ะฒััะพัะฐ ะตัะต ะฝะต ะธะทะผะตัะตะฝะฐ

**ะคะฐะบัะพัั, ะฒะปะธัััะธะต ะฝะฐ ะฒััะพัั:**
- ะะฐะทะพะฒะฐั ะฒััะพัะฐ ะทะฐะณะพะปะพะฒะบะฐ: `~60px`
- ะกะพะดะตัะถะธะผะพะต ะทะฐะดะฐัะธ (ัะตะบะปะธัั): `~32px` ะฝะฐ ัะปะตะผะตะฝั
- ะะฐะฝะตะปั ะฝะฐัััะพะตะบ: ะฝะต ะฒะปะธัะตั (ะพัะบััะฒะฐะตััั ะพัะดะตะปัะฝะพ)
- ะะธะฝะธะผะฐะปัะฝะฐั ะฒััะพัะฐ: ะพะฟัะตะดะตะปัะตััั ัะพะดะตัะถะธะผัะผ

**ะะทะผะตัะตะฝะธะต ะฒััะพัั:**
```typescript
useEffect(() => {
  const updateHeight = () => {
    if (nodeRef.current) {
      const height = nodeRef.current.offsetHeight
      onHeightChange(task.id, height)
    }
  }
  
  const observer = new ResizeObserver(updateHeight)
  if (nodeRef.current) {
    observer.observe(nodeRef.current)
  }
  
  return () => observer.disconnect()
}, [task.id, contentItems, isExpanded, isContentCollapsed])
```

---

### ะะพะทะธัะธะพะฝะธัะพะฒะฐะฝะธะต ะทะฐะดะฐั

#### ะะฑัะพะปััะฝะพะต ะฟะพะทะธัะธะพะฝะธัะพะฒะฐะฝะธะต

**CSS ััะธะปะธ:**
```tsx
<div
  className="absolute"
  style={{
    left: task.position_x,
    top: task.position_y,
    width: cardSize.width,
  }}
>
  {/* ะะฐััะพัะบะฐ ะทะฐะดะฐัะธ */}
</div>
```

**ะัะพะฑะตะฝะฝะพััะธ:**
- `position: absolute` - ะฐะฑัะพะปััะฝะพะต ะฟะพะทะธัะธะพะฝะธัะพะฒะฐะฝะธะต ะพัะฝะพัะธัะตะปัะฝะพ ะบะฐะฝะฒะฐัะฐ
- `left: position_x` - ะณะพัะธะทะพะฝัะฐะปัะฝะฐั ะฟะพะทะธัะธั
- `top: position_y` - ะฒะตััะธะบะฐะปัะฝะฐั ะฟะพะทะธัะธั
- ะะดะธะฝะธัั: ะฟะธะบัะตะปะธ ะฒ ะฟัะพัััะฐะฝััะฒะต ะบะฐะฝะฒะฐัะฐ

---

#### ะขัะฐะฝััะพัะผะฐัะธั ะบะฐะฝะฒะฐัะฐ

**ะัะธะผะตะฝะตะฝะธะต ััะฐะฝััะพัะผะฐัะธะน:**
```tsx
<div
  data-canvas-content
  style={{
    transform: `translate(${offset.x}px, ${offset.y}px) scale(${scale})`,
    transformOrigin: "0 0",
    width: `${CANVAS_WIDTH}px`,
    height: `${CANVAS_HEIGHT}px`,
  }}
>
  {/* ะะฐะดะฐัะธ ะธ ัะพะตะดะธะฝะตะฝะธั */}
</div>
```

**ะขัะฐะฝััะพัะผะฐัะธะธ:**
1. **Translate:** `translate(offset.x, offset.y)` - ะฟะฐะฝะพัะฐะผะธัะพะฒะฐะฝะธะต
2. **Scale:** `scale(scale)` - ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต
3. **Transform Origin:** `0 0` - ัะพัะบะฐ ะพัััะตัะฐ ััะฐะฝััะพัะผะฐัะธะน (ะปะตะฒัะน ะฒะตััะฝะธะน ัะณะพะป)

**ะะปะธัะฝะธะต ะฝะฐ ะบะพะพัะดะธะฝะฐัั:**
- ะะพะพัะดะธะฝะฐัั ะทะฐะดะฐั (`position_x`, `position_y`) ะพััะฐัััั ะฒ ะฟัะพัััะฐะฝััะฒะต ะบะฐะฝะฒะฐัะฐ
- CSS ััะฐะฝััะพัะผะฐัะธะธ ะฟัะธะผะตะฝััััั ะฒะธะทัะฐะปัะฝะพ
- ะัะธ ะผะฐัััะฐะฑะต `0.5`: ะทะฐะดะฐัะฐ ะฒะธะทัะฐะปัะฝะพ ะฒ 2 ัะฐะทะฐ ะผะตะฝััะต, ะฝะพ ะบะพะพัะดะธะฝะฐัั ัะต ะถะต

---

### ะะฐะทะผะตัะตะฝะธะต ะทะฐะดะฐั ะพัะฝะพัะธัะตะปัะฝะพ ะดััะณ ะดััะณะฐ

#### ะะตััะธะบะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต (ัะพะดะธัะตะปั-ะฟะพัะพะผะพะบ)

**ะกัะฐะฝะดะฐััะฝะพะต ัะฐะทะผะตัะตะฝะธะต ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ:**
```typescript
// ะัะธ ัะพะทะดะฐะฝะธะธ ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ ัะตัะตะท ะบะพะฝัะตะบััะฝะพะต ะผะตะฝั
handleCreateTask(
  parentId,
  parentTask.position_x,           // ะขะฐ ะถะต X ะบะพะพัะดะธะฝะฐัะฐ
  parentTask.position_y + 150       // ะะฐ 150px ะฝะธะถะต
)
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพะดะธัะตะปััะบะฐั ะทะฐะดะฐัะฐ   โ  position_y = 100
โ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ 150px
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพัะตัะฝัั ะทะฐะดะฐัะฐ       โ  position_y = 250
โ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะฐัััะพัะฝะธะต:** `150px` - ััะฐะฝะดะฐััะฝัะน ะพััััะฟ ะผะตะถะดั ัะพะดะธัะตะปะตะผ ะธ ะฟะพัะพะผะบะพะผ

**ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต:**
```typescript
position_y = snapToGrid(parentTask.position_y + 150)
```

**ะัะธะผะตั:**
```
parent.position_y = 100
offset = 150
raw_y = 100 + 150 = 250
snapped_y = snapToGrid(250) = Math.round(250/20) * 20 = 12 * 20 = 240
```

---

#### ะะพัะธะทะพะฝัะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต (ะฑัะฐััะบะธะต ะทะฐะดะฐัะธ)

**ะะฐะทะผะตัะตะฝะธะต ััะดะพะผ:**
```typescript
// ะะฐะดะฐัะธ ะฝะฐ ะพะดะฝะพะผ ััะพะฒะฝะต
Task A: position_x = 100, position_y = 200
Task B: position_x = 100 + 224 + 20 = 344, position_y = 200
```

**ะะฐััะตั:**
- ะจะธัะธะฝะฐ ะบะฐััะพัะบะธ: `224px`
- ะััััะฟ ะผะตะถะดั ะบะฐััะพัะบะฐะผะธ: `20px` (1 ััะตะนะบะฐ ัะตัะบะธ)
- ะะพะฒะฐั ะฟะพะทะธัะธั: `previous_x + width + gap`

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโ  20px  โโโโโโโโโโโ
โ Task A  โ โโโโโโ โ Task B  โ
โ         โ        โ         โ
โโโโโโโโโโโ        โโโโโโโโโโโ
x=100              x=344
```

---

#### ะะธะฐะณะพะฝะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต

**ะะฐะทะผะตัะตะฝะธะต ะฟะพ ะดะธะฐะณะพะฝะฐะปะธ:**
```typescript
Task A: position_x = 100, position_y = 100
Task B: position_x = 400, position_y = 300
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโ
โ Task A  โ
โ         โ
โโโโโโโโโโโ
    โ
    โ  (ะดะธะฐะณะพะฝะฐะปัะฝะพะต ัะพะตะดะธะฝะตะฝะธะต)
    โ
         โโโโโโโโโโโ
         โ Task B  โ
         โ         โ
         โโโโโโโโโโโ
```

---

### ะขะพัะบะธ ัะพะตะดะธะฝะตะฝะธั ะฝะฐ ะบะฐััะพัะบะต

#### ะะตะพะผะตััะธั ะบะฐััะพัะบะธ ะทะฐะดะฐัะธ

**ะกัััะบัััะฐ ะบะฐััะพัะบะธ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                     โ
โ         ะะฐะณะพะปะพะฒะพะบ ะทะฐะดะฐัะธ            โ  โ ะะตััะฝัั ัะฐััั
โ                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                     โ
โ         ะกะพะดะตัะถะธะผะพะต (ะตัะปะธ ะตััั)      โ  โ ะกัะตะดะฝัั ัะฐััั
โ                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                      โ
                              ะะธะถะฝัั ัะฐััั
```

**ะะปััะตะฒัะต ัะพัะบะธ:**
- **ะะตะฒัะน ะฒะตััะฝะธะน ัะณะพะป:** `(position_x, position_y)`
- **ะฆะตะฝัั ะฟะพ ะณะพัะธะทะพะฝัะฐะปะธ:** `position_x + width / 2`
- **ะัะฐะฒัะน ะฒะตััะฝะธะน ัะณะพะป:** `(position_x + width, position_y)`
- **ะะตะฒัะน ะฝะธะถะฝะธะน ัะณะพะป:** `(position_x, position_y + height)`
- **ะฆะตะฝัั ะบะฐััะพัะบะธ:** `(position_x + width/2, position_y + height/2)`
- **ะัะฐะฒัะน ะฝะธะถะฝะธะน ัะณะพะป:** `(position_x + width, position_y + height)`

---

#### ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ะฝะฐ ัะพะดะธัะตะปััะบะพะน ะทะฐะดะฐัะต

**ะะฐัะฟะพะปะพะถะตะฝะธะต:** ะะธะถะฝะธะน ัะตะฝัั ะบะฐััะพัะบะธ

**ะคะพัะผัะปะฐ:**
```typescript
startX = parent.position_x + (parentWidth / 2)
startY = parent.position_y + parentHeight
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพะดะธัะตะปััะบะฐั ะทะฐะดะฐัะฐ               โ
โ   position_x = 300                  โ
โ   position_y = 100                  โ
โ   width = 224                       โ
โ   height = 150                      โ
โ                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
            โ
      (startX, startY)
      = (412, 250)
```

**ะะตัะฐะปัะฝัะน ัะฐััะตั:**
```
parent.position_x = 300
parent.position_y = 100
parentWidth = 224
parentHeight = 150

startX = 300 + (224 / 2)
      = 300 + 112
      = 412

startY = 100 + 150
      = 250

ะะตะทัะปััะฐั: (412, 250)
```

**ะัะพะฑะตะฝะฝะพััะธ:**
- X ะบะพะพัะดะธะฝะฐัะฐ: ะฒัะตะณะดะฐ ัะตะฝัั ะบะฐััะพัะบะธ ะฟะพ ะณะพัะธะทะพะฝัะฐะปะธ
- Y ะบะพะพัะดะธะฝะฐัะฐ: ะฒัะตะณะดะฐ ะฝะธะถะฝะธะน ะบัะฐะน ะบะฐััะพัะบะธ
- ะะต ะทะฐะฒะธัะธั ะพั ัะพะดะตัะถะธะผะพะณะพ (ะฒััะพัะฐ ััะธััะฒะฐะตััั ัะตัะตะท `taskHeights`)

---

#### ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ะฝะฐ ะดะพัะตัะฝะตะน ะทะฐะดะฐัะต

**ะะฐัะฟะพะปะพะถะตะฝะธะต:** ะะตััะฝะธะน ัะตะฝัั ะบะฐััะพัะบะธ

**ะคะพัะผัะปะฐ:**
```typescript
endX = task.position_x + (childWidth / 2)
endY = task.position_y
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
      (endX, endY)
      = (412, 400)
            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพัะตัะฝัั ะทะฐะดะฐัะฐ                    โ
โ   position_x = 300                  โ
โ   position_y = 400                  โ
โ   width = 224                       โ
โ                                     โ
โ                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะตัะฐะปัะฝัะน ัะฐััะตั:**
```
task.position_x = 300
task.position_y = 400
childWidth = 224

endX = 300 + (224 / 2)
     = 300 + 112
     = 412

endY = 400

ะะตะทัะปััะฐั: (412, 400)
```

**ะัะพะฑะตะฝะฝะพััะธ:**
- X ะบะพะพัะดะธะฝะฐัะฐ: ะฒัะตะณะดะฐ ัะตะฝัั ะบะฐััะพัะบะธ ะฟะพ ะณะพัะธะทะพะฝัะฐะปะธ
- Y ะบะพะพัะดะธะฝะฐัะฐ: ะฒัะตะณะดะฐ ะฒะตััะฝะธะน ะบัะฐะน ะบะฐััะพัะบะธ (ะฑะตะท ะดะพะฑะฐะฒะปะตะฝะธั ะฒััะพัั)
- ะัะพัะต ัะตะผ ั ัะพะดะธัะตะปั (ะฝะต ะฝัะถะฝะพ ััะธััะฒะฐัั ะฒััะพัั)

---

### ะะทะฐะธะผะพัะฒัะทั ัะฐะทะผะตัะตะฝะธั ะธ ัะพะตะดะธะฝะตะฝะธะน

#### ะะดะธะฝะฐั ัะธััะตะผะฐ ะบะพะพัะดะธะฝะฐั

**ะัะธะฝัะธะฟ:**
- ะะฐะดะฐัะธ ัะฐะทะผะตัะฐัััั ะฒ ะฐะฑัะพะปััะฝัั ะบะพะพัะดะธะฝะฐัะฐั ะบะฐะฝะฒะฐัะฐ
- ะกะพะตะดะธะฝะตะฝะธั ะฒััะธัะปััััั ะฝะฐ ะพัะฝะพะฒะต ัะตั ะถะต ะบะพะพัะดะธะฝะฐั
- ะัะต ะฒ ะตะดะธะฝะพะผ ะฟัะพัััะฐะฝััะฒะต: `(0, 0)` ะดะพ `(5000, 5000)`

**ะกัะตะผะฐ:**
```
ะะฐะฝะฒะฐั (5000x5000)
  โ
  โโ ะะฐะดะฐัะฐ A (300, 100)
  โ    โ
  โ    โโ ะกะพะตะดะธะฝะตะฝะธะต: (412, 250) โ (412, 400)
  โ                      โ
  โโ ะะฐะดะฐัะฐ B (300, 400) โ
  โ
  โโ ะะฐะดะฐัะฐ C (600, 200)
```

---

#### ะะปะธัะฝะธะต ัะฐะทะผะตัะตะฝะธั ะฝะฐ ัะพัะผั ัะพะตะดะธะฝะตะฝะธั

**ะกะปััะฐะน 1: ะะตััะธะบะฐะปัะฝะพะต ะฒััะฐะฒะฝะธะฒะฐะฝะธะต**

**ะฃัะปะพะฒะธะต:** `startX === endX` (ะทะฐะดะฐัะธ ะฝะฐ ะพะดะฝะพะน ะฒะตััะธะบะฐะปะธ)

**ะะฐะทะผะตัะตะฝะธะต:**
```
ะะพะดะธัะตะปั: position_x = 300
ะะพัะพะผะพะบ:  position_x = 300  (ัะฐ ะถะต X ะบะพะพัะดะธะฝะฐัะฐ)
```

**ะกะพะตะดะธะฝะตะฝะธะต:**
```
startX = 300 + 112 = 412
endX = 300 + 112 = 412

ะะตะทัะปััะฐั: ะััะผะฐั ะฒะตััะธะบะฐะปัะฝะฐั ะปะธะฝะธั
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
     (412, 250)
          โ
          โ  (ะฟััะผะฐั ะปะธะฝะธั)
          โ
     (412, 400)
```

---

**ะกะปััะฐะน 2: ะะพัะธะทะพะฝัะฐะปัะฝะพะต ัะผะตัะตะฝะธะต**

**ะฃัะปะพะฒะธะต:** `startX !== endX` (ะทะฐะดะฐัะธ ะฝะฐ ัะฐะทะฝัั ะฒะตััะธะบะฐะปัั)

**ะะฐะทะผะตัะตะฝะธะต:**
```
ะะพะดะธัะตะปั: position_x = 300
ะะพัะพะผะพะบ:  position_x = 500  (ัะผะตัะตะฝะธะต ะฒะฟัะฐะฒะพ)
```

**ะกะพะตะดะธะฝะตะฝะธะต:**
```
startX = 300 + 112 = 412
endX = 500 + 112 = 612

ะะตะทัะปััะฐั: S-ะพะฑัะฐะทะฝะฐั ะบัะธะฒะฐั
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
     (412, 250)
          โ
          โ
          โ
     (412, 325) โโโโโโโโโโโโ (612, 325)
          โ                      โ
          โ                      โ
          โ                      โ
                              (612, 400)
```

---

**ะกะปััะฐะน 3: ะะธะฐะณะพะฝะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต**

**ะฃัะปะพะฒะธะต:** ะะฐะทะฝัะต X ะธ Y ะบะพะพัะดะธะฝะฐัั

**ะะฐะทะผะตัะตะฝะธะต:**
```
ะะพะดะธัะตะปั: position_x = 200, position_y = 100
ะะพัะพะผะพะบ:  position_x = 600, position_y = 500
```

**ะกะพะตะดะธะฝะตะฝะธะต:**
```
startX = 200 + 112 = 312
startY = 100 + 150 = 250

endX = 600 + 112 = 712
endY = 500

controlY = 250 + (500 - 250) / 2 = 375

ะะตะทัะปััะฐั: ะะธะฐะณะพะฝะฐะปัะฝะฐั S-ะพะฑัะฐะทะฝะฐั ะบัะธะฒะฐั
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
     (312, 250)
          โ
          โ
          โ
     (312, 375) โโโโโโโโโโโโโโโโโโโโ (712, 375)
          โ                              โ
          โ                              โ
          โ                              โ
                                      (712, 500)
```

---

### ะะฐะทะผะตัะตะฝะธะต ะฟัะธ ัะพะทะดะฐะฝะธะธ ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ

#### ะะฒัะพะผะฐัะธัะตัะบะพะต ะฟะพะทะธัะธะพะฝะธัะพะฒะฐะฝะธะต

**ะัะธ ัะพะทะดะฐะฝะธะธ ัะตัะตะท ะบะพะฝัะตะบััะฝะพะต ะผะตะฝั:**
```typescript
const parentTask = tasks.find((t) => t.id === taskContextMenu.taskId)
if (parentTask) {
  handleCreateTask(
    taskContextMenu.taskId,                    // parentId
    parentTask.position_x,                      // X: ัะฐ ะถะต ะบะพะพัะดะธะฝะฐัะฐ
    parentTask.position_y + 150                // Y: ะฝะฐ 150px ะฝะธะถะต
  )
}
```

**ะะพะณะธะบะฐ:**
1. ะะฐัะพะดะธะผ ัะพะดะธัะตะปััะบัั ะทะฐะดะฐัั
2. ะะตัะตะผ ะตั X ะบะพะพัะดะธะฝะฐัั (ะฒะตััะธะบะฐะปัะฝะพะต ะฒััะฐะฒะฝะธะฒะฐะฝะธะต)
3. ะะพะฑะฐะฒะปัะตะผ 150px ะบ Y ะบะพะพัะดะธะฝะฐัะต (ััะฐะฝะดะฐััะฝัะน ะพััััะฟ)
4. ะัะธะผะตะฝัะตะผ ะฟัะธะฒัะทะบั ะบ ัะตัะบะต

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพะดะธัะตะปั (300, 100)   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ 150px
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพัะพะผะพะบ (300, 250)    โ  โ ะะฒัะพะผะฐัะธัะตัะบะธ ัะฐะทะผะตัะตะฝะฐ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

#### ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต ะฟัะธ ัะพะทะดะฐะฝะธะธ

**ะัะพัะตัั:**
```typescript
const rawX = parentTask.position_x
const rawY = parentTask.position_y + 150

const snappedX = snapToGrid(rawX)
const snappedY = snapToGrid(rawY)

// ะกะพะทะดะฐะฝะธะต ะทะฐะดะฐัะธ
insert({
  position_x: snappedX,
  position_y: snappedY,
  parent_id: parentId
})
```

**ะัะธะผะตั:**
```
parent.position_x = 305
parent.position_y = 107

rawX = 305
rawY = 107 + 150 = 257

snappedX = snapToGrid(305) = Math.round(305/20) * 20 = 15 * 20 = 300
snappedY = snapToGrid(257) = Math.round(257/20) * 20 = 13 * 20 = 260

ะะตะทัะปััะฐั: ะะพัะพะผะพะบ ัะพะทะดะฐะตััั ะฒ (300, 260)
```

---

### ะะฐะทะผะตัะตะฝะธะต ะฟัะธ ะฟะตัะตัะฐัะบะธะฒะฐะฝะธะธ

#### ะะฑะฝะพะฒะปะตะฝะธะต ะบะพะพัะดะธะฝะฐั

**ะัะพัะตัั ะฟะตัะตัะฐัะบะธะฒะฐะฝะธั:**
1. **ะะฐัะฐะปะพ:** ะะพะปัะทะพะฒะฐัะตะปั ะทะฐะถะธะผะฐะตั ะบะฐััะพัะบั
2. **ะะฒะธะถะตะฝะธะต:** ะะฐััะพัะบะฐ ัะปะตะดัะตั ะทะฐ ะบัััะพัะพะผ
3. **ะัะธะฒัะทะบะฐ:** ะะพะพัะดะธะฝะฐัั ะฟัะธะฒัะทัะฒะฐัััั ะบ ัะตัะบะต
4. **ะะธะทัะฐะปะธะทะฐัะธั:** ะกะพะตะดะธะฝะตะฝะธั ะพะฑะฝะพะฒะปััััั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
5. **ะะฐะฒะตััะตะฝะธะต:** ะะพะพัะดะธะฝะฐัั ัะพััะฐะฝััััั ะฒ ะะ

**ะะพะด:**
```typescript
// ะ TaskNode
const handleMouseMove = (e: MouseEvent) => {
  if (isDragging) {
    const newX = snapToGrid(e.clientX - dragOffset.x)
    const newY = snapToGrid(e.clientY - dragOffset.y)
    setTempPosition({ x: newX, y: newY })
    onDragMove(task.id, newX, newY)  // โ ะฃะฒะตะดะพะผะปะตะฝะธะต ัะพะดะธัะตะปั
  }
}
```

**ะ TaskBoard:**
```typescript
onDragMove={(taskId, x, y) => {
  setDraggingTaskId(taskId)
  setDraggingPosition({ x, y })  // โ ะัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั
}}
```

---

#### ะะฑะฝะพะฒะปะตะฝะธะต ัะพะตะดะธะฝะตะฝะธะน ะฟัะธ ะฟะตัะตัะฐัะบะธะฒะฐะฝะธะธ

**ะะพะณะธะบะฐ ะฒ drawTaskConnections:**
```typescript
const isTaskDragging = draggingTaskId === task.id && draggingPosition
const isParentDragging = draggingTaskId === parent.id && draggingPosition

// ะัะฟะพะปัะทัะตะผ ะฒัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั ะตัะปะธ ะทะฐะดะฐัะฐ ะฟะตัะตัะฐัะบะธะฒะฐะตััั
const startX = isParentDragging
  ? draggingPosition!.x + parentWidth / 2  // โ ะัะตะผะตะฝะฝัะต
  : parent.position_x + parentWidth / 2   // โ ะกะพััะฐะฝะตะฝะฝัะต

const endX = isTaskDragging
  ? draggingPosition!.x + childWidth / 2   // โ ะัะตะผะตะฝะฝัะต
  : task.position_x + childWidth / 2       // โ ะกะพััะฐะฝะตะฝะฝัะต
```

**ะะธะทัะฐะปัะฝัะน ัััะตะบั:**
- ะกะพะตะดะธะฝะตะฝะธั ะพะฑะฝะพะฒะปััััั ะผะณะฝะพะฒะตะฝะฝะพ ะฟัะธ ะฟะตัะตัะฐัะบะธะฒะฐะฝะธะธ
- ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั, ะบะฐะบ ะฑัะดะตั ะฒัะณะปัะดะตัั ัะฒัะทั ะฟะพัะปะต ะฟะตัะตะผะตัะตะฝะธั
- ะะตั ะทะฐะดะตัะถะบะธ ะฝะฐ ัะพััะฐะฝะตะฝะธะต ะฒ ะะ

---

### ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต ะธ ะตะณะพ ะฒะปะธัะฝะธะต ะฝะฐ ัะฐะทะผะตัะตะฝะธะต

#### ะะธะทัะฐะปัะฝะพะต ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต

**ะขัะฐะฝััะพัะผะฐัะธั:**
```typescript
transform: `translate(${offset.x}px, ${offset.y}px) scale(${scale})`
```

**ะะปะธัะฝะธะต ะฝะฐ ะบะพะพัะดะธะฝะฐัั:**
- **ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั** (`position_x`, `position_y`) **ะะ ะธะทะผะตะฝััััั**
- **ะะธะทัะฐะปัะฝัะน ัะฐะทะผะตั** ะบะฐััะพัะตะบ ะธะทะผะตะฝัะตััั
- **ะะฐัััะพัะฝะธั** ะผะตะถะดั ะทะฐะดะฐัะฐะผะธ ะฒะธะทัะฐะปัะฝะพ ะธะทะผะตะฝััััั

**ะัะธะผะตั ะฟัะธ scale = 0.5 (50%):**
```
ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั:
  ะะพะดะธัะตะปั: (300, 100)
  ะะพัะพะผะพะบ:  (300, 250)
  ะะฐัััะพัะฝะธะต: 150px

ะะธะทัะฐะปัะฝะพ (ะฟะพัะปะต scale 0.5):
  ะะพะดะธัะตะปั: ะฒะธะทัะฐะปัะฝะพ ะฒ (150, 50)
  ะะพัะพะผะพะบ:  ะฒะธะทัะฐะปัะฝะพ ะฒ (150, 125)
  ะะฐัััะพัะฝะธะต: ะฒะธะทัะฐะปัะฝะพ 75px
```

---

#### ะะปะธัะฝะธะต ะฝะฐ ัะพะตะดะธะฝะตะฝะธั

**ะะพะพัะดะธะฝะฐัั ัะพะตะดะธะฝะตะฝะธะน:**
- ะััะธัะปััััั ะฒ ะฐะฑัะพะปััะฝัั ะบะพะพัะดะธะฝะฐัะฐั ะบะฐะฝะฒะฐัะฐ
- ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต ะฟัะธะผะตะฝัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะตะท CSS transform
- ะะธะฝะธะธ ะธ ัะพัะบะธ ะผะฐัััะฐะฑะธัััััั ะฟัะพะฟะพััะธะพะฝะฐะปัะฝะพ

**ะัะธะผะตั:**
```
ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั ัะพะตะดะธะฝะตะฝะธั:
  startX = 412, startY = 250
  endX = 412, endY = 400

ะัะธ scale = 0.5:
  ะะธะทัะฐะปัะฝะพ: startX = 206, startY = 125
  ะะธะทัะฐะปัะฝะพ: endX = 206, endY = 200
  (ะฝะพ ะฒ ะบะพะดะต ะพััะฐัััั 412, 250, 412, 400)
```

---

### ะะฐะฝะพัะฐะผะธัะพะฒะฐะฝะธะต ะธ ะตะณะพ ะฒะปะธัะฝะธะต

#### ะกะผะตัะตะฝะธะต ะบะฐะฝะฒะฐัะฐ

**ะขัะฐะฝััะพัะผะฐัะธั:**
```typescript
transform: `translate(${offset.x}px, ${offset.y}px) scale(${scale})`
```

**ะะปะธัะฝะธะต:**
- ะัะต ะทะฐะดะฐัะธ ะธ ัะพะตะดะธะฝะตะฝะธั ัะผะตัะฐัััั ะฒะผะตััะต
- ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั ะฝะต ะธะทะผะตะฝััััั
- ะะธะทัะฐะปัะฝะพ ะฒัะต ัะปะตะผะตะฝัั ะดะฒะธะณะฐัััั

**ะัะธะผะตั:**
```
offset = { x: 200, y: 100 }

ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั ะทะฐะดะฐัะธ:
  position_x = 300, position_y = 200

ะะธะทัะฐะปัะฝะฐั ะฟะพะทะธัะธั ะฝะฐ ัะบัะฐะฝะต:
  screen_x = 300 + 200 = 500
  screen_y = 200 + 100 = 300
```

---

### ะกะตัะบะฐ ะธ ะฒะธะทัะฐะปัะฝะพะต ะพัะพะฑัะฐะถะตะฝะธะต

#### ะัะพะฑัะฐะถะตะฝะธะต ัะตัะบะธ

**CSS ััะธะปะธ:**
```tsx
style={{
  backgroundImage: `
    linear-gradient(to right, rgba(255, 255, 255, 0.025) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(255, 255, 255, 0.025) 1px, transparent 1px)
  `,
  backgroundSize: `${GRID_SIZE * scale}px ${GRID_SIZE * scale}px`,
  backgroundPosition: `${offset.x}px ${offset.y}px`,
}}
```

**ะะฐัะฐะผะตััั:**
- ะะฐะทะผะตั ััะตะนะบะธ: `GRID_SIZE * scale` (ะผะฐัััะฐะฑะธััะตััั)
- ะะพะทะธัะธั: ัะธะฝััะพะฝะธะทะธัะพะฒะฐะฝะฐ ั `offset` (ะดะฒะธะณะฐะตััั ะฟัะธ ะฟะฐะฝะพัะฐะผะธัะพะฒะฐะฝะธะธ)
- ะฆะฒะตั: `rgba(255, 255, 255, 0.025)` - ะพัะตะฝั ะฟัะพะทัะฐัะฝัะน ะฑะตะปัะน

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
ะัะธ scale = 1.0:
  ะฏัะตะนะบะฐ ัะตัะบะธ: 20x20px

ะัะธ scale = 0.5:
  ะฏัะตะนะบะฐ ัะตัะบะธ: 10x10px (ะฒะธะทัะฐะปัะฝะพ)

ะัะธ scale = 2.0:
  ะฏัะตะนะบะฐ ัะตัะบะธ: 40x40px (ะฒะธะทัะฐะปัะฝะพ)
```

---

### ะฆะตะปัะฝะฐั ัะธััะตะผะฐ: ะทะฐะดะฐัะธ + ัะพะตะดะธะฝะตะฝะธั

#### ะะดะธะฝัะน ะฟัะพัะตัั ัะฐะทะผะตัะตะฝะธั ะธ ัะพะตะดะธะฝะตะฝะธั

**ะจะฐะณ 1: ะกะพะทะดะฐะฝะธะต ะทะฐะดะฐัะธ**
```typescript
// ะะพะปัะทะพะฒะฐัะตะปั ัะพะทะดะฐะตั ะทะฐะดะฐัั ะฒ ะฟะพะทะธัะธะธ (x, y)
const snappedX = snapToGrid(x)
const snappedY = snapToGrid(y)

// ะะฐะดะฐัะฐ ัะพะทะดะฐะตััั ั ะบะพะพัะดะธะฝะฐัะฐะผะธ
insert({
  position_x: snappedX,
  position_y: snappedY,
  parent_id: null  // ะะพัะฝะตะฒะฐั ะทะฐะดะฐัะฐ
})
```

**ะจะฐะณ 2: ะะฐะทะผะตัะตะฝะธะต ะฝะฐ ะบะฐะฝะฒะฐัะต**
```tsx
// ะะฐะดะฐัะฐ ะพััะธัะพะฒัะฒะฐะตััั ะฒ ะฐะฑัะพะปััะฝัั ะบะพะพัะดะธะฝะฐัะฐั
<div
  style={{
    position: 'absolute',
    left: task.position_x,  // 300
    top: task.position_y,   // 100
  }}
>
  {/* ะะฐััะพัะบะฐ ะทะฐะดะฐัะธ */}
</div>
```

**ะจะฐะณ 3: ะกะพะทะดะฐะฝะธะต ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ**
```typescript
// ะะพะปัะทะพะฒะฐัะตะปั ัะพะทะดะฐะตั ะดะพัะตัะฝัั ะทะฐะดะฐัั
const childX = parent.position_x  // 300 (ัะฐ ะถะต X)
const childY = parent.position_y + 150  // 250 (ะฝะฐ 150px ะฝะธะถะต)

insert({
  position_x: snapToGrid(childX),  // 300
  position_y: snapToGrid(childY), // 240 (ะฟัะธะฒัะทะฐะฝะพ ะบ ัะตัะบะต)
  parent_id: parent.id
})
```

**ะจะฐะณ 4: ะััะธัะพะฒะบะฐ ัะพะตะดะธะฝะตะฝะธั**
```typescript
// ะคัะฝะบัะธั drawTaskConnections ะฒััะธัะปัะตั ะบะพะพัะดะธะฝะฐัั
const startX = parent.position_x + 112  // 412 (ัะตะฝัั ัะพะดะธัะตะปั)
const startY = parent.position_y + 150   // 250 (ะฝะธะท ัะพะดะธัะตะปั)

const endX = child.position_x + 112     // 412 (ัะตะฝัั ะฟะพัะพะผะบะฐ)
const endY = child.position_y            // 240 (ะฒะตัั ะฟะพัะพะผะบะฐ)

// ะกะพะทะดะฐะตััั ะบัะธะฒะฐั ะะตะทัะต
const path = `M 412 250 C 412 245, 412 245, 412 240`
```

**ะจะฐะณ 5: ะะธะทัะฐะปะธะทะฐัะธั**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพะดะธัะตะปั (300, 100)   โ
โ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
            โ
      (412, 250) โโโโโโโโโ (412, 240)
            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพัะพะผะพะบ (300, 240)    โ
โ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

#### ะกะธะฝััะพะฝะธะทะฐัะธั ะบะพะพัะดะธะฝะฐั

**ะัะธะฝัะธะฟ:**
- ะัะต ะบะพะพัะดะธะฝะฐัั ะฒ ะตะดะธะฝะพะผ ะฟัะพัััะฐะฝััะฒะต ะบะฐะฝะฒะฐัะฐ
- ะะฐะดะฐัะธ ะธ ัะพะตะดะธะฝะตะฝะธั ะธัะฟะพะปัะทััั ะพะดะฝะธ ะธ ัะต ะถะต ะบะพะพัะดะธะฝะฐัั
- ะะทะผะตะฝะตะฝะธะต ะฟะพะทะธัะธะธ ะทะฐะดะฐัะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปัะตั ัะพะตะดะธะฝะตะฝะธะต

**ะัะธะผะตั ัะธะฝััะพะฝะธะทะฐัะธะธ:**
```typescript
// ะะพะปัะทะพะฒะฐัะตะปั ะฟะตัะตะผะตัะฐะตั ัะพะดะธัะตะปััะบัั ะทะฐะดะฐัั
// ะกัะฐััะต ะบะพะพัะดะธะฝะฐัั: (300, 100)
// ะะพะฒัะต ะบะพะพัะดะธะฝะฐัั: (500, 200)

// ะะฑะฝะพะฒะปะตะฝะธะต ะทะฐะดะฐัะธ
update({ position_x: 500, position_y: 200 })

// ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ัะพะตะดะธะฝะตะฝะธั
// ะกัะฐัะพะต ัะพะตะดะธะฝะตะฝะธะต: (412, 250) โ (412, 240)
// ะะพะฒะพะต ัะพะตะดะธะฝะตะฝะธะต:  (612, 350) โ (412, 240)
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
ะะพ ะฟะตัะตะผะตัะตะฝะธั:
  ะะพะดะธัะตะปั: (300, 100)
  ะะพัะพะผะพะบ:  (300, 240)
  ะกะพะตะดะธะฝะตะฝะธะต: (412, 250) โ (412, 240)

ะะพัะปะต ะฟะตัะตะผะตัะตะฝะธั:
  ะะพะดะธัะตะปั: (500, 200)
  ะะพัะพะผะพะบ:  (300, 240)  (ะฝะต ะธะทะผะตะฝะธะปะฐัั)
  ะกะพะตะดะธะฝะตะฝะธะต: (612, 350) โ (412, 240)  (ะพะฑะฝะพะฒะธะปะพัั ะฐะฒัะพะผะฐัะธัะตัะบะธ)
```

---

### ะะตัะฐะปัะฝัะน ะฟัะธะผะตั ัะฐะทะผะตัะตะฝะธั ะธ ัะพะตะดะธะฝะตะฝะธั

#### ะะพะปะฝัะน ััะตะฝะฐัะธะน

**ะััะพะดะฝัะต ะดะฐะฝะฝัะต:**
```
ะะฐะฝะฒะฐั: 5000x5000px
ะกะตัะบะฐ: 20px
ะะฐัััะฐะฑ: 1.0 (100%)
ะกะผะตัะตะฝะธะต: (0, 0)

ะะฐะดะฐัะฐ A (ัะพะดะธัะตะปั):
  id: "task-a"
  position_x: 400
  position_y: 200
  width: 224
  height: 150
  parent_id: null

ะะฐะดะฐัะฐ B (ะฟะพัะพะผะพะบ):
  id: "task-b"
  position_x: 400
  position_y: 360
  width: 224
  height: 120
  parent_id: "task-a"
```

---

#### ะจะฐะณ 1: ะะฐะทะผะตัะตะฝะธะต ัะพะดะธัะตะปััะบะพะน ะทะฐะดะฐัะธ

**ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั:**
```
position_x = 400
position_y = 200
```

**ะะธะทัะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต:**
```
ะะฐะฝะฒะฐั (0, 0)
  โ
  โ
  โ     (400, 200) โ ะะตะฒัะน ะฒะตััะฝะธะน ัะณะพะป
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ     โ   ะะฐะดะฐัะฐ A          โ
  โ     โ   width: 224        โ
  โ     โ   height: 150       โ
  โ     โ                     โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ              (624, 350) โ ะัะฐะฒัะน ะฝะธะถะฝะธะน ัะณะพะป
  โ
```

**ะัะฐะฝะธัั ะบะฐััะพัะบะธ:**
- ะะตะฒัะน ะฒะตััะฝะธะน: `(400, 200)`
- ะัะฐะฒัะน ะฒะตััะฝะธะน: `(624, 200)`
- ะะตะฒัะน ะฝะธะถะฝะธะน: `(400, 350)`
- ะัะฐะฒัะน ะฝะธะถะฝะธะน: `(624, 350)`
- ะฆะตะฝัั: `(512, 275)`

---

#### ะจะฐะณ 2: ะะฐะทะผะตัะตะฝะธะต ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ

**ะััะธัะปะตะฝะธะต ะฟะพะทะธัะธะธ:**
```
parent.position_x = 400
parent.position_y = 200
offset = 150

raw_x = 400
raw_y = 200 + 150 = 350

snapped_x = snapToGrid(400) = 400
snapped_y = snapToGrid(350) = Math.round(350/20) * 20 = 17 * 20 = 340
```

**ะะตะทัะปััะฐั:**
```
position_x = 400  (ัะฐ ะถะต X ะบะพะพัะดะธะฝะฐัะฐ)
position_y = 340  (ะฟัะธะฒัะทะฐะฝะพ ะบ ัะตัะบะต, ะฝะฐ 140px ะฝะธะถะต ะฒะผะตััะพ 150px)
```

**ะะธะทัะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต:**
```
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ A          โ  (400, 200)
โ                     โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ 140px
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ B          โ  (400, 340)
โ                     โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

#### ะจะฐะณ 3: ะััะธัะปะตะฝะธะต ัะพัะตะบ ัะพะตะดะธะฝะตะฝะธั

**ะะฐัะฐะปัะฝะฐั ัะพัะบะฐ (ัะพะดะธัะตะปั):**
```
startX = 400 + (224 / 2) = 512
startY = 200 + 150 = 350
```

**ะะพะฝะตัะฝะฐั ัะพัะบะฐ (ะฟะพัะพะผะพะบ):**
```
endX = 400 + (224 / 2) = 512
endY = 340
```

**ะะพะฝััะพะปัะฝะฐั ัะพัะบะฐ:**
```
controlY = 350 + (340 - 350) / 2
         = 350 + (-10) / 2
         = 350 - 5
         = 345
```

**ะะตะทัะปััะฐั:**
```
ะะฐัะฐะปัะฝะฐั ัะพัะบะฐ: (512, 350)
ะะพะฝะตัะฝะฐั ัะพัะบะฐ:  (512, 340)
ะะพะฝััะพะปัะฝัะต ัะพัะบะธ: (512, 345), (512, 345)
```

---

#### ะจะฐะณ 4: ะคะพัะผะธัะพะฒะฐะฝะธะต ะบัะธะฒะพะน

**SVG Path:**
```
M 512 350 C 512 345, 512 345, 512 340
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
     (512, 350) โ ะะธะถะฝะธะน ัะตะฝัั ัะพะดะธัะตะปั
          โ
          โ  (ะบะพัะพัะบะฐั ะบัะธะฒะฐั, ะฟะพััะธ ะฟััะผะฐั)
          โ
     (512, 340) โ ะะตััะฝะธะน ัะตะฝัั ะฟะพัะพะผะบะฐ
```

**ะัะพะฑะตะฝะฝะพััั:** ะขะฐะบ ะบะฐะบ ะพะฑะต ะบะพะฝััะพะปัะฝัะต ัะพัะบะธ ัะพะฒะฟะฐะดะฐัั ะธ ะฝะฐัะพะดัััั ะฟะพัะตัะตะดะธะฝะต, ะบัะธะฒะฐั ะฟะพััะธ ะฟััะผะฐั

---

#### ะจะฐะณ 5: ะะธะทัะฐะปะธะทะฐัะธั ะฝะฐ ะบะฐะฝะฒะฐัะต

**ะะพะปะฝะฐั ะบะฐััะธะฝะฐ:**
```
ะะฐะฝะฒะฐั (5000x5000)
  โ
  โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ     โ   ะะฐะดะฐัะฐ A          โ  (400, 200)
  โ     โ                     โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ              โ
  โ              โ (512, 350)
  โ              โ
  โ         โโโโโโโโโ  (ัะพะตะดะธะฝะตะฝะธะต)
  โ              โ
  โ         (512, 340)
  โ              โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ     โ   ะะฐะดะฐัะฐ B          โ  (400, 340)
  โ     โ                     โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ
```

---

### ะะปะธัะฝะธะต ัะพะดะตัะถะธะผะพะณะพ ะฝะฐ ัะฐะทะผะตัะตะฝะธะต

#### ะะทะผะตะฝะตะฝะธะต ะฒััะพัั ะบะฐััะพัะบะธ

**ะกัะตะฝะฐัะธะน:**
1. ะะฐะดะฐัะฐ ัะพะทะดะฐะฝะฐ ะฑะตะท ัะพะดะตัะถะธะผะพะณะพ: `height = 150px`
2. ะะพะปัะทะพะฒะฐัะตะปั ะดะพะฑะฐะฒะปัะตั ัะพะดะตัะถะธะผะพะต: `height = 250px`
3. ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ะดะพะปะถะฝะฐ ะฟะตัะตะผะตััะธัััั

**ะัะพัะตัั:**
```typescript
// ะะฐัะฐะปัะฝะพะต ัะพััะพัะฝะธะต
taskHeights["task-a"] = 150
startY = 200 + 150 = 350

// ะะพัะปะต ะดะพะฑะฐะฒะปะตะฝะธั ัะพะดะตัะถะธะผะพะณะพ
taskHeights["task-a"] = 250  // โ ะะฑะฝะพะฒะปะตะฝะพ ัะตัะตะท ResizeObserver
startY = 200 + 250 = 450     // โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ะฟะตัะตะผะตััะธะปะฐัั
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
ะะพ ะดะพะฑะฐะฒะปะตะฝะธั ัะพะดะตัะถะธะผะพะณะพ:
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ A          โ  height: 150
โ                     โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ (350)
    [ัะพะตะดะธะฝะตะฝะธะต]

ะะพัะปะต ะดะพะฑะฐะฒะปะตะฝะธั ัะพะดะตัะถะธะผะพะณะพ:
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ A          โ  height: 250
โ   [ัะพะดะตัะถะธะผะพะต]      โ
โ                     โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ (450)  โ ะขะพัะบะฐ ะฟะตัะตะผะตััะธะปะฐัั
    [ัะพะตะดะธะฝะตะฝะธะต]
```

---

### ะะฝะพะถะตััะฒะตะฝะฝัะต ัะพะตะดะธะฝะตะฝะธั

#### ะะฐะทะผะตัะตะฝะธะต ะฝะตัะบะพะปัะบะธั ะฟะพัะพะผะบะพะฒ

**ะกัะตะฝะฐัะธะน:**
- ะะพะดะธัะตะปั: `(400, 200)`
- ะะพัะพะผะพะบ 1: `(300, 400)` - ัะปะตะฒะฐ
- ะะพัะพะผะพะบ 2: `(400, 400)` - ะฟะพ ัะตะฝััั
- ะะพัะพะผะพะบ 3: `(500, 400)` - ัะฟัะฐะฒะฐ

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
         โโโโโโโโโโโโโโโโโโโโโโโ
         โ   ะะพะดะธัะตะปั          โ  (400, 200)
         โ                     โ
         โโโโโโโโโโโโโโโโโโโโโโโ
              โ
        โโโโโโโผโโโโโโ
        โ     โ     โ
        โ     โ     โ
   โโโโโโ  โโโโโโ  โโโโโโ
   โ B1 โ  โ B2 โ  โ B3 โ
   โโโโโโ  โโโโโโ  โโโโโโ
```

**ะกะพะตะดะธะฝะตะฝะธั:**
1. ะะพะดะธัะตะปั โ ะะพัะพะผะพะบ 1: `(512, 350) โ (412, 400)`
2. ะะพะดะธัะตะปั โ ะะพัะพะผะพะบ 2: `(512, 350) โ (512, 400)`
3. ะะพะดะธัะตะปั โ ะะพัะพะผะพะบ 3: `(512, 350) โ (612, 400)`

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะัะต ัะพะตะดะธะฝะตะฝะธั ะฝะฐัะธะฝะฐัััั ะฒ ะพะดะฝะพะน ัะพัะบะต (ะฝะธะท ัะพะดะธัะตะปั)
- ะะฐะถะดะพะต ัะพะตะดะธะฝะตะฝะธะต ะฝะตะทะฐะฒะธัะธะผะพ ะฒััะธัะปัะตััั
- ะคะพัะผะฐ ะบัะธะฒัั ัะฐะทะฝะฐั (ะทะฐะฒะธัะธั ะพั ะฟะพะทะธัะธะธ ะฟะพัะพะผะบะฐ)

---

### ะะตัะฐััะธั (ะผะฝะพะณะพััะพะฒะฝะตะฒะฐั)

#### ะะฐะทะผะตัะตะฝะธะต ัะตะฟะพัะบะธ ะทะฐะดะฐั

**ะกัะตะฝะฐัะธะน:**
- ะฃัะพะฒะตะฝั 1: `Task A` (400, 100)
- ะฃัะพะฒะตะฝั 2: `Task B` (400, 280) - ะฟะพัะพะผะพะบ A
- ะฃัะพะฒะตะฝั 3: `Task C` (400, 460) - ะฟะพัะพะผะพะบ B

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโโโโโโโโโโโโโ
โ   Task A            โ  (400, 100)
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โ (512, 250)
    [ัะพะตะดะธะฝะตะฝะธะต 1]
         โ (512, 280)
โโโโโโโโโโโโโโโโโโโโโโโ
โ   Task B            โ  (400, 280)
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โ (512, 430)
    [ัะพะตะดะธะฝะตะฝะธะต 2]
         โ (512, 460)
โโโโโโโโโโโโโโโโโโโโโโโ
โ   Task C            โ  (400, 460)
โโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะฐััะตั ัะพะตะดะธะฝะตะฝะธะน:**
```
ะกะพะตะดะธะฝะตะฝะธะต 1 (A โ B):
  startX = 400 + 112 = 512
  startY = 100 + 150 = 250
  endX = 400 + 112 = 512
  endY = 280
  Path: M 512 250 C 512 265, 512 265, 512 280

ะกะพะตะดะธะฝะตะฝะธะต 2 (B โ C):
  startX = 400 + 112 = 512
  startY = 280 + 150 = 430
  endX = 400 + 112 = 512
  endY = 460
  Path: M 512 430 C 512 445, 512 445, 512 460
```

---

### ะะฟัะธะผะธะทะฐัะธั ัะฐะทะผะตัะตะฝะธั

#### ะญััะตะบัะธะฒะฝะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟัะพัััะฐะฝััะฒะฐ

**ะะตะบะพะผะตะฝะดะฐัะธะธ:**
1. **ะะตััะธะบะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต:** ะะพัะพะผะบะธ ะฟะพะด ัะพะดะธัะตะปัะผะธ (ััะฐะฝะดะฐัั)
2. **ะะพัะธะทะพะฝัะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต:** ะัะฐััะบะธะต ะทะฐะดะฐัะธ ััะดะพะผ
3. **ะััััะฟั:** ะะธะฝะธะผัะผ 20px (1 ััะตะนะบะฐ ัะตัะบะธ) ะผะตะถะดั ะทะฐะดะฐัะฐะผะธ
4. **ะััะฟะฟะธัะพะฒะบะฐ:** ะกะฒัะทะฐะฝะฝัะต ะทะฐะดะฐัะธ ัะฐะทะผะตัะฐัั ะฑะปะธะทะบะพ

**ะัะธะผะตั ัััะตะบัะธะฒะฝะพะณะพ ัะฐะทะผะตัะตะฝะธั:**
```
โโโโโโโ     โโโโโโโ     โโโโโโโ
โ  A  โ     โ  B  โ     โ  C  โ  (ะฑัะฐััะบะธะต ะทะฐะดะฐัะธ)
โโโโโโโ     โโโโโโโ     โโโโโโโ
  โ           โ           โ
  โ           โ           โ
โโโโโโโ     โโโโโโโ     โโโโโโโ
โ  D  โ     โ  E  โ     โ  F  โ  (ะฟะพัะพะผะบะธ)
โโโโโโโ     โโโโโโโ     โโโโโโโ
```

---

## ะฆะตะปัะฝะฐั ัะธััะตะผะฐ ัะฐะทะผะตัะตะฝะธั ะธ ัะพะตะดะธะฝะตะฝะธั

### ะะดะธะฝัะน ะฟัะพัะตัั ัะฐะฑะพัั

**1. ะกะพะทะดะฐะฝะธะต ะทะฐะดะฐัะธ:**
```
ะะพะปัะทะพะฒะฐัะตะปั โ ะะฒะพะนะฝะพะน ะบะปะธะบ/ะะพะฝัะตะบััะฝะพะต ะผะตะฝั
  โ
ะััะธัะปะตะฝะธะต ะบะพะพัะดะธะฝะฐั (ั ััะตัะพะผ ะผะฐัััะฐะฑะฐ ะธ ัะผะตัะตะฝะธั)
  โ
ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต (snapToGrid)
  โ
ะกะพััะฐะฝะตะฝะธะต ะฒ ะะ (position_x, position_y)
  โ
ะััะธัะพะฒะบะฐ ะฝะฐ ะบะฐะฝะฒะฐัะต (absolute positioning)
```

**2. ะกะพะทะดะฐะฝะธะต ัะฒัะทะธ:**
```
ะะพะปัะทะพะฒะฐัะตะปั โ ะะพะฝัะตะบััะฝะพะต ะผะตะฝั ะทะฐะดะฐัะธ โ "ะกะพะทะดะฐัั ัะฒัะทะฐะฝะฝัั ะทะฐะดะฐัั"
  โ
ะััะธัะปะตะฝะธะต ะฟะพะทะธัะธะธ ะฟะพัะพะผะบะฐ (parent.position_x, parent.position_y + 150)
  โ
ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต
  โ
ะกะพะทะดะฐะฝะธะต ะทะฐะดะฐัะธ ั parent_id
  โ
ะะฒัะพะผะฐัะธัะตัะบะฐั ะพััะธัะพะฒะบะฐ ัะพะตะดะธะฝะตะฝะธั
```

**3. ะะตัะตะผะตัะตะฝะธะต ะทะฐะดะฐัะธ:**
```
ะะพะปัะทะพะฒะฐัะตะปั โ ะะตัะตัะฐัะบะธะฒะฐะฝะธะต ะบะฐััะพัะบะธ
  โ
ะะฑะฝะพะฒะปะตะฝะธะต ะฒัะตะผะตะฝะฝัั ะบะพะพัะดะธะฝะฐั (draggingPosition)
  โ
ะะฑะฝะพะฒะปะตะฝะธะต ัะพะตะดะธะฝะตะฝะธะน ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ (ะธัะฟะพะปัะทัั ะฒัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั)
  โ
ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต ะฟัะธ ะพัะฟััะบะฐะฝะธะธ
  โ
ะกะพััะฐะฝะตะฝะธะต ะฒ ะะ
  โ
ะะฑะฝะพะฒะปะตะฝะธะต ัะพะตะดะธะฝะตะฝะธะน (ะธัะฟะพะปัะทัั ัะพััะฐะฝะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั)
```

**4. ะะทะผะตะฝะตะฝะธะต ัะฐะทะผะตัะฐ ะบะฐััะพัะบะธ:**
```
ะะพะปัะทะพะฒะฐัะตะปั โ Resize handle
  โ
ะะทะผะตะฝะตะฝะธะต ัะฐะทะผะตัะฐ ะบะฐััะพัะบะธ
  โ
ResizeObserver ะพััะปะตะถะธะฒะฐะตั ะธะทะผะตะฝะตะฝะธะต
  โ
ะะฑะฝะพะฒะปะตะฝะธะต taskHeights[taskId]
  โ
ะะตัะตััะตั ัะพัะบะธ ัะพะตะดะธะฝะตะฝะธั (startY = position_y + height)
  โ
ะะฑะฝะพะฒะปะตะฝะธะต ัะพะตะดะธะฝะตะฝะธั
```

---

### ะะทะฐะธะผะพัะฒัะทั ะฒัะตั ัะปะตะผะตะฝัะพะฒ

**ะกัะตะผะฐ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         ะะฐะฝะฒะฐั (5000x5000)              โ
โ  transform: translate + scale            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  SVG (ัะพะตะดะธะฝะตะฝะธั)                 โ โ
โ  โ  z-index: 1                        โ โ
โ  โ  {drawTaskConnections()}           โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  ะะฐะดะฐัะธ (absolute)                โ โ
โ  โ  z-index: 10/30                   โ โ
โ  โ  position: (x, y)                 โ โ
โ  โ  size: 224 x height               โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  ะกะตัะบะฐ (background)               โ โ
โ  โ  size: 20px * scale               โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะทะฐะธะผะพะดะตะนััะฒะธะต:**
- ะะฐะดะฐัะธ ัะฐะทะผะตัะฐัััั ะฒ ะฐะฑัะพะปััะฝัั ะบะพะพัะดะธะฝะฐัะฐั
- ะกะพะตะดะธะฝะตะฝะธั ะฒััะธัะปััััั ะฝะฐ ะพัะฝะพะฒะต ะบะพะพัะดะธะฝะฐั ะทะฐะดะฐั
- ะกะตัะบะฐ ะฟะพะผะพะณะฐะตั ะฒััะฐะฒะฝะธะฒะฐะฝะธั
- ะขัะฐะฝััะพัะผะฐัะธะธ ะฟัะธะผะตะฝััััั ะบะพ ะฒัะตะผั ะบะฐะฝะฒะฐัั

---

### ะะฐัะตะผะฐัะธัะตัะบะฐั ะผะพะดะตะปั ัะฐะทะผะตัะตะฝะธั

#### ะกะธััะตะผะฐ ััะฐะฒะฝะตะฝะธะน

**ะะพะพัะดะธะฝะฐัั ะทะฐะดะฐัะธ:**
```
task.position_x โ [0, CANVAS_WIDTH]
task.position_y โ [0, CANVAS_HEIGHT]
```

**ะะพะพัะดะธะฝะฐัั ัะพัะบะธ ัะพะตะดะธะฝะตะฝะธั (ัะพะดะธัะตะปั):**
```
startX = parent.position_x + (parentWidth / 2)
startY = parent.position_y + parentHeight
```

**ะะพะพัะดะธะฝะฐัั ัะพัะบะธ ัะพะตะดะธะฝะตะฝะธั (ะฟะพัะพะผะพะบ):**
```
endX = child.position_x + (childWidth / 2)
endY = child.position_y
```

**ะฃัะปะพะฒะธะต ัะฒัะทะธ:**
```
child.parent_id === parent.id
```

**ะฃัะปะพะฒะธะต ะฟัะธะฒัะทะบะธ ะบ ัะตัะบะต:**
```
position_x = snapToGrid(raw_x)
position_y = snapToGrid(raw_y)
```

---

### ะะธะทัะฐะปัะฝะพะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ัะตะปัะฝะพะน ัะธััะตะผั

#### ะะพะปะฝะฐั ะบะฐััะธะฝะฐ ัะฐะทะผะตัะตะฝะธั

```
                    ะะะะะะก (5000x5000)
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ                                                  โ
    โ  offset: (200, 100)                             โ
    โ  scale: 1.0                                     โ
    โ                                                  โ
    โ    โโโโโโโโโโโโโโโโโโโโโโโ                      โ
    โ    โ Task A (300, 200)    โ                      โ
    โ    โ width: 224           โ                      โ
    โ    โ height: 150           โ                      โ
    โ    โ                       โ                      โ
    โ    โโโโโโโโโโโโโโโโโโโโโโโ                      โ
    โ            โ                                     โ
    โ            โ (512, 350) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั      โ
    โ            โ                                     โ
    โ      โโโโโโโโโโโโโโโโ  (ะบัะธะฒะฐั ะะตะทัะต)            โ
    โ            โ                                     โ
    โ      (512, 400) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั              โ
    โ            โ                                     โ
    โ    โโโโโโโโโโโโโโโโโโโโโโโ                      โ
    โ    โ Task B (300, 400)    โ                      โ
    โ    โ width: 224           โ                      โ
    โ    โ height: 120           โ                      โ
    โ    โ parent_id: "task-a"  โ                      โ
    โ    โโโโโโโโโโโโโโโโโโโโโโโ                      โ
    โ                                                  โ
    โ  ะกะตัะบะฐ: 20x20px (ะฒะธะทัะฐะปัะฝะพ)                     โ
    โ                                                  โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

#### ะะตัะฐะปะธะทะฐัะธั ะบะพะพัะดะธะฝะฐั

**ะะฐะดะฐัะฐ A:**
```
ะะตะฒัะน ะฒะตััะฝะธะน ัะณะพะป: (300, 200)
ะัะฐะฒัะน ะฒะตััะฝะธะน ัะณะพะป: (524, 200)
ะะตะฒัะน ะฝะธะถะฝะธะน ัะณะพะป: (300, 350)
ะัะฐะฒัะน ะฝะธะถะฝะธะน ัะณะพะป: (524, 350)
ะฆะตะฝัั: (412, 275)
ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั: (412, 350)  โ ะะธะถะฝะธะน ัะตะฝัั
```

**ะะฐะดะฐัะฐ B:**
```
ะะตะฒัะน ะฒะตััะฝะธะน ัะณะพะป: (300, 400)
ะัะฐะฒัะน ะฒะตััะฝะธะน ัะณะพะป: (524, 400)
ะะตะฒัะน ะฝะธะถะฝะธะน ัะณะพะป: (300, 520)
ะัะฐะฒัะน ะฝะธะถะฝะธะน ัะณะพะป: (524, 520)
ะฆะตะฝัั: (412, 460)
ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั: (412, 400)  โ ะะตััะฝะธะน ัะตะฝัั
```

**ะกะพะตะดะธะฝะตะฝะธะต:**
```
ะะฐัะฐะปัะฝะฐั ัะพัะบะฐ: (412, 350)
ะะพะฝะตัะฝะฐั ัะพัะบะฐ: (412, 400)
ะะพะฝััะพะปัะฝัะต ัะพัะบะธ: (412, 375), (412, 375)
ะัะธะฒะฐั: M 412 350 C 412 375, 412 375, 412 400
```

---

### ะะปะธัะฝะธะต ะผะฐัััะฐะฑะฐ ะฝะฐ ะฒะธะทัะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต

#### ะัะธะผะตั ะฟัะธ ัะฐะทะฝัั ะผะฐัััะฐะฑะฐั

**ะััะพะดะฝัะต ะดะฐะฝะฝัะต:**
```
ะะฐะดะฐัะฐ: position_x = 400, position_y = 200
ะะฐะฝะฒะฐั: offset = (0, 0)
```

**ะัะธ scale = 1.0 (100%):**
```
ะะธะทัะฐะปัะฝะฐั ะฟะพะทะธัะธั ะฝะฐ ัะบัะฐะฝะต: (400, 200)
ะะฐะทะผะตั ะบะฐััะพัะบะธ: 224x150px
```

**ะัะธ scale = 0.5 (50%):**
```
ะะธะทัะฐะปัะฝะฐั ะฟะพะทะธัะธั ะฝะฐ ัะบัะฐะฝะต: (200, 100)
ะะฐะทะผะตั ะบะฐััะพัะบะธ: 112x75px (ะฒะธะทัะฐะปัะฝะพ)
ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั: (400, 200) - ะฝะต ะธะทะผะตะฝะธะปะธัั
```

**ะัะธ scale = 2.0 (200%):**
```
ะะธะทัะฐะปัะฝะฐั ะฟะพะทะธัะธั ะฝะฐ ัะบัะฐะฝะต: (800, 400)
ะะฐะทะผะตั ะบะฐััะพัะบะธ: 448x300px (ะฒะธะทัะฐะปัะฝะพ)
ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั: (400, 200) - ะฝะต ะธะทะผะตะฝะธะปะธัั
```

**ะะปะธัะฝะธะต ะฝะฐ ัะพะตะดะธะฝะตะฝะธั:**
- ะะพะพัะดะธะฝะฐัั ัะพะตะดะธะฝะตะฝะธะน ะพััะฐัััั ัะตะผะธ ะถะต
- ะะธะทัะฐะปัะฝัะน ัะฐะทะผะตั ะปะธะฝะธะน ะธ ัะพัะตะบ ะผะฐัััะฐะฑะธััะตััั
- ะะฐัััะพัะฝะธั ะฒะธะทัะฐะปัะฝะพ ะธะทะผะตะฝััััั

---

### ะะปะธัะฝะธะต ะฟะฐะฝะพัะฐะผะธัะพะฒะฐะฝะธั

#### ะัะธะผะตั ัะผะตัะตะฝะธั

**ะััะพะดะฝัะต ะดะฐะฝะฝัะต:**
```
ะะฐะดะฐัะฐ: position_x = 400, position_y = 200
offset: (0, 0)
```

**ะะพัะปะต ะฟะฐะฝะพัะฐะผะธัะพะฒะฐะฝะธั:**
```
offset: (200, 100)
```

**ะะตะทัะปััะฐั:**
```
ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั: (400, 200) - ะฝะต ะธะทะผะตะฝะธะปะธัั
ะะธะทัะฐะปัะฝะฐั ะฟะพะทะธัะธั ะฝะฐ ัะบัะฐะฝะต: (600, 300)
  = position_x + offset.x = 400 + 200 = 600
  = position_y + offset.y = 200 + 100 = 300
```

**ะะปะธัะฝะธะต ะฝะฐ ัะพะตะดะธะฝะตะฝะธั:**
- ะัะต ัะพะตะดะธะฝะตะฝะธั ัะผะตัะฐัััั ะฒะผะตััะต ั ะทะฐะดะฐัะฐะผะธ
- ะัะฝะพัะธัะตะปัะฝัะต ะฟะพะทะธัะธะธ ัะพััะฐะฝััััั
- ะะธะทัะฐะปัะฝะพ ะฒัะต ัะปะตะผะตะฝัั ะดะฒะธะณะฐัััั ัะธะฝััะพะฝะฝะพ

---

## ะััะธัะตะบัััะฐ ะดะฐะฝะฝัั

### ะฅัะฐะฝะตะฝะธะต ัะฒัะทะตะน

**ะัะฝะพะฒะฝะพะน ัะฟะพัะพะฑ:** ะะพะปะต `parent_id` ะฒ ัะฐะฑะปะธัะต `tasks`

```sql
CREATE TABLE tasks (
  id UUID PRIMARY KEY,
  parent_id UUID REFERENCES tasks(id) ON DELETE CASCADE,
  -- ะดััะณะธะต ะฟะพะปั...
)
```

**ะกัััะบัััะฐ ัะฒัะทะธ:**
- `parent_id = NULL` โ ะทะฐะดะฐัะฐ ะฑะตะท ัะพะดะธัะตะปั (ะบะพัะฝะตะฒะฐั)
- `parent_id = <task_id>` โ ะทะฐะดะฐัะฐ ัะฒะปัะตััั ะดะพัะตัะฝะตะน

**ะัะธะผะตั:**
```
Task A (id: "aaa", parent_id: null)
  โโ Task B (id: "bbb", parent_id: "aaa")
      โโ Task C (id: "ccc", parent_id: "bbb")
```

### ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ัะฐะฑะปะธัะฐ (ะฝะต ะธัะฟะพะปัะทัะตััั ะฒ ัะตะบััะตะน ัะตะฐะปะธะทะฐัะธะธ)

**ะขะฐะฑะปะธัะฐ `task_connections`:**
```sql
CREATE TABLE task_connections (
  id UUID PRIMARY KEY,
  from_task_id UUID REFERENCES tasks(id),
  to_task_id UUID REFERENCES tasks(id),
  project_id UUID REFERENCES projects(id),
  created_at TIMESTAMPTZ
)
```

**ะัะธะผะตัะฐะฝะธะต:** ะญัะฐ ัะฐะฑะปะธัะฐ ัััะตััะฒัะตั ะฒ ะะ, ะฝะพ ะฒ ัะตะบััะตะน ัะตะฐะปะธะทะฐัะธะธ **ะะ ะะกะะะะฌะะฃะะขะกะฏ**. ะกะฒัะทะธ ะพะฟัะตะดะตะปััััั ัะพะปัะบะพ ัะตัะตะท `parent_id`.

---

## ะกะพะทะดะฐะฝะธะต ัะพะตะดะธะฝะตะฝะธะน

### ะกะฟะพัะพะฑ 1: ะกะพะทะดะฐะฝะธะต ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ ัะตัะตะท ะบะพะฝัะตะบััะฝะพะต ะผะตะฝั

**ะะตะนััะฒะธะต:** ะัะฐะฒัะน ะบะปะธะบ ะฝะฐ ะทะฐะดะฐัะต โ "ะกะพะทะดะฐัั ัะฒัะทะฐะฝะฝัั ะทะฐะดะฐัั"

**ะะพะด:**
```tsx
// ะ ะบะพะฝัะตะบััะฝะพะผ ะผะตะฝั ะทะฐะดะฐัะธ
<button
  onClick={() => {
    const parentTask = tasks.find((t) => t.id === taskContextMenu.taskId)
    if (parentTask) {
      handleCreateTask(
        taskContextMenu.taskId,  // parentId
        parentTask.position_x,
        parentTask.position_y + 150  // ะะพะทะธัะธั ะฟะพะด ัะพะดะธัะตะปะตะผ
      )
    }
  }}
>
  ะกะพะทะดะฐัั ัะฒัะทะฐะฝะฝัั ะทะฐะดะฐัั
</button>
```

**ะคัะฝะบัะธั ัะพะทะดะฐะฝะธั:**
```typescript
const handleCreateTask = async (
  parentId: string | null = null,  // ID ัะพะดะธัะตะปััะบะพะน ะทะฐะดะฐัะธ
  x: number,                        // X ะบะพะพัะดะธะฝะฐัะฐ
  y: number,                         // Y ะบะพะพัะดะธะฝะฐัะฐ
  hasContent = false
) => {
  if (!canEdit) return

  const { data, error } = await supabase
    .from("tasks")
    .insert({
      project_id: projectId,
      parent_id: parentId,  // โ ะกะฒัะทั ัะพะทะดะฐะตััั ะทะดะตัั
      title: "",
      owner_id: userId,
      position_x: snapToGrid(x),
      position_y: snapToGrid(y),
      has_content: hasContent,
      color: "107, 114, 128",
    })
    .select()
    .single()

  if (!error && data) {
    setTasks([...tasks, data])
  }
}
```

**ะะพะทะธัะธะพะฝะธัะพะฒะฐะฝะธะต ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ:**
- X: `parentTask.position_x` (ัะฐ ะถะต X ะบะพะพัะดะธะฝะฐัะฐ)
- Y: `parentTask.position_y + 150` (ะฝะฐ 150px ะฝะธะถะต ัะพะดะธัะตะปั)

---

### ะกะฟะพัะพะฑ 2: ะัะพะณัะฐะผะผะฝะพะต ัะพะทะดะฐะฝะธะต ัะฒัะทะธ

**ะะทะผะตะฝะตะฝะธะต ัััะตััะฒัััะตะน ะทะฐะดะฐัะธ:**
```typescript
// ะฃััะฐะฝะพะฒะธัั ัะพะดะธัะตะปั
await supabase
  .from("tasks")
  .update({ parent_id: "parent-task-id" })
  .eq("id", "child-task-id")

// ะฃะฑัะฐัั ัะพะดะธัะตะปั (ัะดะตะปะฐัั ะบะพัะฝะตะฒะพะน)
await supabase
  .from("tasks")
  .update({ parent_id: null })
  .eq("id", "task-id")
```

---

### ะกะฟะพัะพะฑ 3: ะะฐัะบะฐะดะฝะพะต ัะดะฐะปะตะฝะธะต

**ะัะธ ัะดะฐะปะตะฝะธะธ ัะพะดะธัะตะปััะบะพะน ะทะฐะดะฐัะธ:**
- ะัะต ะดะพัะตัะฝะธะต ะทะฐะดะฐัะธ ัะฐะบะถะต ัะดะฐะปััััั (CASCADE)
- ะกะฒัะทะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะดะฐะปััััั

**SQL:**
```sql
parent_id UUID REFERENCES tasks(id) ON DELETE CASCADE
```

---

## ะคัะฝะบัะธั ะพััะธัะพะฒะบะธ ัะพะตะดะธะฝะตะฝะธะน

### ะะพะปะฝัะน ะบะพะด ััะฝะบัะธะธ

```typescript
const drawTaskConnections = () => {
  // 1. ะคะธะปัััะฐัะธั: ะฝะฐัะพะดะธะผ ะฒัะต ะทะฐะดะฐัะธ ั ัะพะดะธัะตะปะตะผ
  const parentChildConnections = tasks
    .filter((task) => task.parent_id)
    .map((task) => {
      // 2. ะะฐัะพะดะธะผ ัะพะดะธัะตะปััะบัั ะทะฐะดะฐัั
      const parent = tasks.find((t) => t.id === task.parent_id)
      if (!parent) return null

      // 3. ะัะพะฒะตััะตะผ ัะพััะพัะฝะธะต ะฟะตัะตัะฐัะบะธะฒะฐะฝะธั
      const isTaskDragging = draggingTaskId === task.id && draggingPosition
      const isParentDragging = draggingTaskId === parent.id && draggingPosition

      // 4. ะคะธะบัะธัะพะฒะฐะฝะฝะฐั ัะธัะธะฝะฐ ะบะฐััะพัะตะบ
      const parentWidth = 224
      const childWidth = 224

      // 5. ะััะธัะปะตะฝะธะต ะบะพะพัะดะธะฝะฐั ะฝะฐัะฐะปัะฝะพะน ัะพัะบะธ (ัะพะดะธัะตะปั)
      const startX = isParentDragging
        ? draggingPosition!.x + parentWidth / 2
        : parent.position_x + parentWidth / 2
      
      const parentHeight = taskHeights[parent.id] || 150
      const startY = isParentDragging
        ? draggingPosition!.y + parentHeight
        : parent.position_y + parentHeight

      // 6. ะััะธัะปะตะฝะธะต ะบะพะพัะดะธะฝะฐั ะบะพะฝะตัะฝะพะน ัะพัะบะธ (ะฟะพัะพะผะพะบ)
      const endX = isTaskDragging
        ? draggingPosition!.x + childWidth / 2
        : task.position_x + childWidth / 2
      
      const endY = isTaskDragging
        ? draggingPosition!.y
        : task.position_y

      // 7. ะััะธัะปะตะฝะธะต ะบะพะฝััะพะปัะฝะพะน ัะพัะบะธ ะดะปั ะบัะธะฒะพะน ะะตะทัะต
      const controlY = startY + (endY - startY) / 2

      // 8. ะคะพัะผะธัะพะฒะฐะฝะธะต ะฟััะธ ะบัะธะฒะพะน ะะตะทัะต
      const path = `M ${startX} ${startY} C ${startX} ${controlY}, ${endX} ${controlY}, ${endX} ${endY}`

      // 9. ะะพะทะฒัะฐั SVG ัะปะตะผะตะฝัะพะฒ
      return (
        <g key={`parent-child-${task.id}`}>
          <path
            d={path}
            stroke="rgba(255, 255, 255, 0.3)"
            strokeWidth="2"
            fill="none"
          />
          <circle
            cx={startX}
            cy={startY}
            r="4"
            fill="rgba(255, 255, 255, 0.5)"
          />
          <circle
            cx={endX}
            cy={endY}
            r="4"
            fill="rgba(255, 255, 255, 0.5)"
          />
        </g>
      )
    })
    .filter(Boolean)  // ะฃะดะฐะปัะตะผ null ะทะฝะฐัะตะฝะธั

  return parentChildConnections
}
```

---

### ะะพัะฐะณะพะฒัะน ัะฐะทะฑะพั ััะฝะบัะธะธ

#### ะจะฐะณ 1: ะคะธะปัััะฐัะธั ะทะฐะดะฐั

```typescript
tasks.filter((task) => task.parent_id)
```

**ะะตะนััะฒะธะต:** ะัะฑะธัะฐะตะผ ัะพะปัะบะพ ะทะฐะดะฐัะธ, ั ะบะพัะพััั ะตััั ัะพะดะธัะตะปั (`parent_id !== null`)

**ะะตะทัะปััะฐั:** ะะฐััะธะฒ ะดะพัะตัะฝะธั ะทะฐะดะฐั

---

#### ะจะฐะณ 2: ะะพะธัะบ ัะพะดะธัะตะปััะบะพะน ะทะฐะดะฐัะธ

```typescript
const parent = tasks.find((t) => t.id === task.parent_id)
if (!parent) return null
```

**ะะตะนััะฒะธะต:** ะะฐัะพะดะธะผ ัะพะดะธัะตะปััะบัั ะทะฐะดะฐัั ะฟะพ ID

**ะัะพะฒะตัะบะฐ:** ะัะปะธ ัะพะดะธัะตะปั ะฝะต ะฝะฐะนะดะตะฝ โ ะฒะพะทะฒัะฐัะฐะตะผ `null` (ัะฒัะทั ะฝะต ะพััะธัะพะฒัะฒะฐะตััั)

**ะัะธัะธะฝะฐ ะพััััััะฒะธั ัะพะดะธัะตะปั:**
- ะะพะดะธัะตะปััะบะฐั ะทะฐะดะฐัะฐ ะฑัะปะฐ ัะดะฐะปะตะฝะฐ
- ะัะธะฑะบะฐ ะฒ ะดะฐะฝะฝัั
- ะะพะดะธัะตะปั ะฝะฐัะพะดะธััั ะฒ ะดััะณะพะผ ะฟัะพะตะบัะต

---

#### ะจะฐะณ 3: ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ะฟะตัะตัะฐัะบะธะฒะฐะฝะธั

```typescript
const isTaskDragging = draggingTaskId === task.id && draggingPosition
const isParentDragging = draggingTaskId === parent.id && draggingPosition
```

**ะะตัะตะผะตะฝะฝัะต ัะพััะพัะฝะธั:**
- `draggingTaskId` - ID ะทะฐะดะฐัะธ, ะบะพัะพัะฐั ัะตะนัะฐั ะฟะตัะตัะฐัะบะธะฒะฐะตััั
- `draggingPosition` - ะฒัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั ะฟะตัะตัะฐัะบะธะฒะฐะตะผะพะน ะทะฐะดะฐัะธ `{x, y}`

**ะะพะณะธะบะฐ:**
- ะัะปะธ ะทะฐะดะฐัะฐ ะฟะตัะตัะฐัะบะธะฒะฐะตััั โ ะธัะฟะพะปัะทัะตะผ ะฒัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั
- ะัะปะธ ะทะฐะดะฐัะฐ ะฝะต ะฟะตัะตัะฐัะบะธะฒะฐะตััั โ ะธัะฟะพะปัะทัะตะผ ัะพััะฐะฝะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั

**ะะฐัะตะผ ััะพ ะฝัะถะฝะพ:**
- ะกะฒัะทะธ ะพะฑะฝะพะฒะปััััั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ ะฟัะธ ะฟะตัะตัะฐัะบะธะฒะฐะฝะธะธ
- ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั, ะบะฐะบ ะฑัะดะตั ะฒัะณะปัะดะตัั ัะฒัะทั ะฟะพัะปะต ะฟะตัะตะผะตัะตะฝะธั

---

#### ะจะฐะณ 4: ะคะธะบัะธัะพะฒะฐะฝะฝะฐั ัะธัะธะฝะฐ ะบะฐััะพัะตะบ

```typescript
const parentWidth = 224
const childWidth = 224
```

**ะะฝะฐัะตะฝะธะต:** `224px` - ััะฐะฝะดะฐััะฝะฐั ัะธัะธะฝะฐ ะบะฐััะพัะบะธ ะทะฐะดะฐัะธ

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**
- ะะปั ะฒััะธัะปะตะฝะธั ัะตะฝััะฐ ะบะฐััะพัะบะธ: `position_x + width / 2`
- ะะดะธะฝะฐะบะพะฒะฐั ะดะปั ะฒัะตั ะบะฐััะพัะตะบ (ะผะพะถะตั ะธะทะผะตะฝััััั ัะตัะตะท resize, ะฝะพ ะดะปั ัะพะตะดะธะฝะตะฝะธะน ะธัะฟะพะปัะทัะตััั ัะธะบัะธัะพะฒะฐะฝะฝะพะต ะทะฝะฐัะตะฝะธะต)

**ะะพัะตะผั ัะธะบัะธัะพะฒะฐะฝะฝะพะต:**
- ะฃะฟัะพัะฐะตั ะฒััะธัะปะตะฝะธั
- ะะฑะตัะฟะตัะธะฒะฐะตั ััะฐะฑะธะปัะฝะพััั ัะพะตะดะธะฝะตะฝะธะน
- ะฆะตะฝัั ะบะฐััะพัะบะธ ะฒัะตะณะดะฐ ะฒ ะพะดะฝะพะผ ะผะตััะต ะพัะฝะพัะธัะตะปัะฝะพ ะปะตะฒะพะณะพ ะบัะฐั

---

#### ะจะฐะณ 5: ะััะธัะปะตะฝะธะต ะฝะฐัะฐะปัะฝะพะน ัะพัะบะธ (ัะพะดะธัะตะปั)

**X ะบะพะพัะดะธะฝะฐัะฐ:**
```typescript
const startX = isParentDragging
  ? draggingPosition!.x + parentWidth / 2
  : parent.position_x + parentWidth / 2
```

**ะะพะณะธะบะฐ:**
- ะัะปะธ ัะพะดะธัะตะปั ะฟะตัะตัะฐัะบะธะฒะฐะตััั โ ะธัะฟะพะปัะทัะตะผ `draggingPosition.x`
- ะะฝะฐัะต โ ะธัะฟะพะปัะทัะตะผ `parent.position_x`
- ะฆะตะฝัั ะบะฐััะพัะบะธ: `position_x + width / 2`

**ะัะธะผะตั:**
- `parent.position_x = 400`
- `parentWidth = 224`
- `startX = 400 + 224 / 2 = 400 + 112 = 512`

---

**Y ะบะพะพัะดะธะฝะฐัะฐ:**
```typescript
const parentHeight = taskHeights[parent.id] || 150
const startY = isParentDragging
  ? draggingPosition!.y + parentHeight
  : parent.position_y + parentHeight
```

**ะะพะณะธะบะฐ:**
- ะะพะปััะฐะตะผ ะฒััะพัั ัะพะดะธัะตะปััะบะพะน ะบะฐััะพัะบะธ ะธะท `taskHeights`
- ะัะปะธ ะฒััะพัะฐ ะฝะตะธะทะฒะตััะฝะฐ โ ะธัะฟะพะปัะทัะตะผ `150px` (ะทะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั)
- ะะธะถะฝัั ัะพัะบะฐ ะบะฐััะพัะบะธ: `position_y + height`

**ะััะปะตะถะธะฒะฐะฝะธะต ะฒััะพัั:**
- ะััะพัะฐ ะบะฐััะพัะบะธ ะผะพะถะตั ะธะทะผะตะฝััััั (ัะพะดะตัะถะธะผะพะต, ะฝะฐัััะพะนะบะธ)
- ะัะฟะพะปัะทัะตััั `ResizeObserver` ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั ะธะทะผะตะฝะตะฝะธะน
- ะกะพััะฐะฝัะตััั ะฒ ัะพััะพัะฝะธะธ `taskHeights[taskId]`

**ะัะธะผะตั:**
- `parent.position_y = 200`
- `parentHeight = 180`
- `startY = 200 + 180 = 380`

---

#### ะจะฐะณ 6: ะััะธัะปะตะฝะธะต ะบะพะฝะตัะฝะพะน ัะพัะบะธ (ะฟะพัะพะผะพะบ)

**X ะบะพะพัะดะธะฝะฐัะฐ:**
```typescript
const endX = isTaskDragging
  ? draggingPosition!.x + childWidth / 2
  : task.position_x + childWidth / 2
```

**ะะพะณะธะบะฐ:** ะะฝะฐะปะพะณะธัะฝะพ ะฝะฐัะฐะปัะฝะพะน ัะพัะบะต, ะฝะพ ะดะปั ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ

**ะัะธะผะตั:**
- `task.position_x = 400`
- `childWidth = 224`
- `endX = 400 + 112 = 512`

---

**Y ะบะพะพัะดะธะฝะฐัะฐ:**
```typescript
const endY = isTaskDragging
  ? draggingPosition!.y
  : task.position_y
```

**ะะพะณะธะบะฐ:**
- ะะตััะฝัั ัะพัะบะฐ ะดะพัะตัะฝะตะน ะบะฐััะพัะบะธ (ะฑะตะท ะดะพะฑะฐะฒะปะตะฝะธั ะฒััะพัั)
- ะัะฟะพะปัะทัะตััั `position_y` ะฝะฐะฟััะผัั

**ะัะธะผะตั:**
- `task.position_y = 450`
- `endY = 450`

---

#### ะจะฐะณ 7: ะััะธัะปะตะฝะธะต ะบะพะฝััะพะปัะฝะพะน ัะพัะบะธ

```typescript
const controlY = startY + (endY - startY) / 2
```

**ะคะพัะผัะปะฐ:** ะกัะตะดะฝัั ัะพัะบะฐ ะผะตะถะดั ะฝะฐัะฐะปัะฝะพะน ะธ ะบะพะฝะตัะฝะพะน Y ะบะพะพัะดะธะฝะฐัะฐะผะธ

**ะะฐัะตะผะฐัะธะบะฐ:**
```
controlY = startY + (endY - startY) / 2
         = startY + (endY - startY) * 0.5
         = startY + endY * 0.5 - startY * 0.5
         = startY * 0.5 + endY * 0.5
         = (startY + endY) / 2
```

**ะะตะทัะปััะฐั:** Y ะบะพะพัะดะธะฝะฐัะฐ ะฟะพัะตัะตะดะธะฝะต ะผะตะถะดั ะฝะฐัะฐะปัะฝะพะน ะธ ะบะพะฝะตัะฝะพะน ัะพัะบะฐะผะธ

**ะัะธะผะตั:**
- `startY = 380`
- `endY = 450`
- `controlY = 380 + (450 - 380) / 2 = 380 + 35 = 415`

**X ะบะพะพัะดะธะฝะฐัั ะบะพะฝััะพะปัะฝัั ัะพัะตะบ:**
- ะะตัะฒะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ: `(startX, controlY)`
- ะัะพัะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ: `(endX, controlY)`

**ะัะพะฑะตะฝะฝะพััั:** ะะฑะต ะบะพะฝััะพะปัะฝัะต ัะพัะบะธ ะธะผะตัั ะพะดะธะฝะฐะบะพะฒัั Y ะบะพะพัะดะธะฝะฐัั, ััะพ ัะพะทะดะฐะตั ัะธะผะผะตััะธัะฝัั ะบัะธะฒัั

---

#### ะจะฐะณ 8: ะคะพัะผะธัะพะฒะฐะฝะธะต ะฟััะธ ะบัะธะฒะพะน ะะตะทัะต

```typescript
const path = `M ${startX} ${startY} C ${startX} ${controlY}, ${endX} ${controlY}, ${endX} ${endY}`
```

**SVG Path ะบะพะผะฐะฝะดั:**
- `M` - Move to (ะฝะฐัะฐะปัะฝะฐั ัะพัะบะฐ)
- `C` - Cubic Bezier curve (ะบัะฑะธัะตัะบะฐั ะบัะธะฒะฐั ะะตะทัะต)

**ะคะพัะผะฐั ะบะพะผะฐะฝะดั C:**
```
C x1 y1, x2 y2, x y
```

ะะดะต:
- `(x1, y1)` - ะฟะตัะฒะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ
- `(x2, y2)` - ะฒัะพัะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ
- `(x, y)` - ะบะพะฝะตัะฝะฐั ัะพัะบะฐ

**ะ ะฝะฐัะตะผ ัะปััะฐะต:**
```
C startX controlY, endX controlY, endX endY
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
ะะฐัะฐะปัะฝะฐั ัะพัะบะฐ: (startX, startY)
    โ
ะะพะฝััะพะปัะฝะฐั 1: (startX, controlY) โโโโโ
                                        โ
ะะพะฝััะพะปัะฝะฐั 2: (endX, controlY) โโโโโโโโผโโโ ะะพะฝะตัะฝะฐั ัะพัะบะฐ: (endX, endY)
```

---

#### ะจะฐะณ 9: ะกะพะทะดะฐะฝะธะต SVG ัะปะตะผะตะฝัะพะฒ

```tsx
return (
  <g key={`parent-child-${task.id}`}>
    {/* ะะธะฝะธั ัะพะตะดะธะฝะตะฝะธั */}
    <path
      d={path}
      stroke="rgba(255, 255, 255, 0.3)"
      strokeWidth="2"
      fill="none"
    />
    
    {/* ะขะพัะบะฐ ะฝะฐ ัะพะดะธัะตะปะต */}
    <circle
      cx={startX}
      cy={startY}
      r="4"
      fill="rgba(255, 255, 255, 0.5)"
    />
    
    {/* ะขะพัะบะฐ ะฝะฐ ะฟะพัะพะผะบะต */}
    <circle
      cx={endX}
      cy={endY}
      r="4"
      fill="rgba(255, 255, 255, 0.5)"
    />
  </g>
)
```

**ะญะปะตะผะตะฝัั:**
1. **`<g>`** - ะณััะฟะฟะฐ SVG ัะปะตะผะตะฝัะพะฒ (ะบะพะฝัะตะนะฝะตั)
2. **`<path>`** - ะบัะธะฒะฐั ะปะธะฝะธั ัะพะตะดะธะฝะตะฝะธั
3. **`<circle>`** (x2) - ัะพัะบะธ ัะพะตะดะธะฝะตะฝะธั ะฝะฐ ะบะพะฝัะฐั

**Key ะดะปั React:** `parent-child-${task.id}` - ัะฝะธะบะฐะปัะฝัะน ะบะปัั ะดะปั ะบะฐะถะดะพะน ัะฒัะทะธ

---

## ะััะธัะปะตะฝะธะต ะบะพะพัะดะธะฝะฐั ัะพัะตะบ ัะพะตะดะธะฝะตะฝะธั

### ะะฐัะฐะปัะฝะฐั ัะพัะบะฐ (Start Point) - ะะพะดะธัะตะปััะบะฐั ะทะฐะดะฐัะฐ

**ะะฐัะฟะพะปะพะถะตะฝะธะต:** ะะธะถะฝะธะน ัะตะฝัั ะบะฐััะพัะบะธ ัะพะดะธัะตะปั

**ะคะพัะผัะปะฐ:**
```typescript
startX = parent.position_x + (parentWidth / 2)
startY = parent.position_y + parentHeight
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพะดะธัะตะปััะบะฐั ะทะฐะดะฐัะฐ   โ
โ                         โ
โ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
            โ
         (startX, startY) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั
```

**ะะพะพัะดะธะฝะฐัั:**
- **X:** ะฆะตะฝัั ะบะฐััะพัะบะธ ะฟะพ ะณะพัะธะทะพะฝัะฐะปะธ
- **Y:** ะะธะถะฝะธะน ะบัะฐะน ะบะฐััะพัะบะธ ะฟะพ ะฒะตััะธะบะฐะปะธ

**ะัะธะผะตั ัะฐััะตัะฐ:**
```
parent.position_x = 300
parent.position_y = 100
parentWidth = 224
parentHeight = 180

startX = 300 + (224 / 2) = 300 + 112 = 412
startY = 100 + 180 = 280

ะะตะทัะปััะฐั: (412, 280)
```

---

### ะะพะฝะตัะฝะฐั ัะพัะบะฐ (End Point) - ะะพัะตัะฝัั ะทะฐะดะฐัะฐ

**ะะฐัะฟะพะปะพะถะตะฝะธะต:** ะะตััะฝะธะน ัะตะฝัั ะบะฐััะพัะบะธ ะฟะพัะพะผะบะฐ

**ะคะพัะผัะปะฐ:**
```typescript
endX = task.position_x + (childWidth / 2)
endY = task.position_y
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
         (endX, endY) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั
            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพัะตัะฝัั ะทะฐะดะฐัะฐ       โ
โ                         โ
โ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะพะพัะดะธะฝะฐัั:**
- **X:** ะฆะตะฝัั ะบะฐััะพัะบะธ ะฟะพ ะณะพัะธะทะพะฝัะฐะปะธ
- **Y:** ะะตััะฝะธะน ะบัะฐะน ะบะฐััะพัะบะธ ะฟะพ ะฒะตััะธะบะฐะปะธ

**ะัะธะผะตั ัะฐััะตัะฐ:**
```
task.position_x = 300
task.position_y = 500
childWidth = 224

endX = 300 + (224 / 2) = 300 + 112 = 412
endY = 500

ะะตะทัะปััะฐั: (412, 500)
```

---

### ะะพะฝััะพะปัะฝัะต ัะพัะบะธ (Control Points) - ะัะธะฒะฐั ะะตะทัะต

**ะะฐัะฟะพะปะพะถะตะฝะธะต:** ะะพัะตัะตะดะธะฝะต ะผะตะถะดั ะฝะฐัะฐะปัะฝะพะน ะธ ะบะพะฝะตัะฝะพะน ัะพัะบะฐะผะธ

**ะคะพัะผัะปะฐ:**
```typescript
controlY = startY + (endY - startY) / 2
```

**ะะพะพัะดะธะฝะฐัั ะบะพะฝััะพะปัะฝัั ัะพัะตะบ:**
- **ะะตัะฒะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ:** `(startX, controlY)`
- **ะัะพัะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ:** `(endX, controlY)`

**ะัะพะฑะตะฝะฝะพััั:** ะะฑะต ะบะพะฝััะพะปัะฝัะต ัะพัะบะธ ะธะผะตัั ะพะดะธะฝะฐะบะพะฒัั Y ะบะพะพัะดะธะฝะฐัั

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
(startX, startY)
    โ
    โ
    โ  โ ะะตััะธะบะฐะปัะฝะฐั ะปะธะฝะธั ะพั ัะพะดะธัะตะปั
    โ
(startX, controlY) โโโโโโโโโโโโ (endX, controlY)
    โ                              โ
    โ                              โ  โ ะะตััะธะบะฐะปัะฝะฐั ะปะธะฝะธั ะบ ะฟะพัะพะผะบั
    โ                              โ
(endX, endY)
```

**ะัะธะผะตั ัะฐััะตัะฐ:**
```
startX = 412, startY = 280
endX = 412, endY = 500

controlY = 280 + (500 - 280) / 2
         = 280 + 220 / 2
         = 280 + 110
         = 390

ะะตัะฒะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ: (412, 390)
ะัะพัะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ: (412, 390)
```

**ะัะธะผะตัะฐะฝะธะต:** ะ ะดะฐะฝะฝะพะผ ัะปััะฐะต ะพะฑะต ะบะพะฝััะพะปัะฝัะต ัะพัะบะธ ัะพะฒะฟะฐะดะฐัั, ัะฐะบ ะบะฐะบ `startX === endX` (ะทะฐะดะฐัะธ ะฝะฐ ะพะดะฝะพะน ะฒะตััะธะบะฐะปะธ)

---

## ะัะธะฒะฐั ะะตะทัะต - ะผะฐัะตะผะฐัะธะบะฐ ะธ ัะพัะผัะปะฐ

### ะขะธะฟ ะบัะธะฒะพะน

**ะัะฑะธัะตัะบะฐั ะบัะธะฒะฐั ะะตะทัะต (Cubic Bezier Curve)**

**SVG ะบะพะผะฐะฝะดะฐ:** `C` (Cubic bezier)

**ะคะพัะผะฐั:**
```
C x1 y1, x2 y2, x y
```

ะะดะต:
- `(x1, y1)` - ะฟะตัะฒะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ
- `(x2, y2)` - ะฒัะพัะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ
- `(x, y)` - ะบะพะฝะตัะฝะฐั ัะพัะบะฐ

---

### ะะฐัะตะผะฐัะธัะตัะบะฐั ัะพัะผัะปะฐ

**ะะฐัะฐะผะตััะธัะตัะบะพะต ััะฐะฒะฝะตะฝะธะต ะบัะฑะธัะตัะบะพะน ะบัะธะฒะพะน ะะตะทัะต:**

```
B(t) = (1-t)ยณPโ + 3(1-t)ยฒtPโ + 3(1-t)tยฒPโ + tยณPโ
```

ะะดะต:
- `t` - ะฟะฐัะฐะผะตัั ะพั 0 ะดะพ 1
- `Pโ` - ะฝะฐัะฐะปัะฝะฐั ัะพัะบะฐ (startX, startY)
- `Pโ` - ะฟะตัะฒะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ (startX, controlY)
- `Pโ` - ะฒัะพัะฐั ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ (endX, controlY)
- `Pโ` - ะบะพะฝะตัะฝะฐั ัะพัะบะฐ (endX, endY)

**ะ ะฝะฐัะตะผ ัะปััะฐะต:**
```
Pโ = (startX, startY)
Pโ = (startX, controlY)
Pโ = (endX, controlY)
Pโ = (endX, endY)
```

---

### ะะฐะทะปะพะถะตะฝะธะต ะฟะพ ะบะพะพัะดะธะฝะฐัะฐะผ

**X ะบะพะพัะดะธะฝะฐัะฐ:**
```
X(t) = (1-t)ยณยทstartX + 3(1-t)ยฒtยทstartX + 3(1-t)tยฒยทendX + tยณยทendX
```

**Y ะบะพะพัะดะธะฝะฐัะฐ:**
```
Y(t) = (1-t)ยณยทstartY + 3(1-t)ยฒtยทcontrolY + 3(1-t)tยฒยทcontrolY + tยณยทendY
```

**ะฃะฟัะพัะตะฝะธะต (ะตัะปะธ startX === endX):**
```
X(t) = startX = endX  (ะฟะพััะพัะฝะฝะฐั)
Y(t) = (1-t)ยณยทstartY + 3(1-t)ยฒtยทcontrolY + 3(1-t)tยฒยทcontrolY + tยณยทendY
     = (1-t)ยณยทstartY + 3(1-t)tยทcontrolY + tยณยทendY
```

---

### ะะธะทัะฐะปัะฝะพะต ะฟัะตะดััะฐะฒะปะตะฝะธะต

**ะคะพัะผะฐ ะบัะธะฒะพะน:**

```
     Pโ (startX, startY)
      โ
      โ
      โ  โ ะะตััะธะบะฐะปัะฝัะน ัะตะณะผะตะฝั
      โ
      โ
Pโ (startX, controlY) โโโโโโโโโโโโ Pโ (endX, controlY)
      โ                              โ
      โ                              โ  โ ะะตััะธะบะฐะปัะฝัะน ัะตะณะผะตะฝั
      โ                              โ
      โ                              โ
     Pโ (endX, endY)
```

**ะฅะฐัะฐะบัะตัะธััะธะบะธ:**
- ะัะธะฒะฐั ะฝะฐัะธะฝะฐะตััั ะฒ `Pโ` ะธ ะทะฐะบะฐะฝัะธะฒะฐะตััั ะฒ `Pโ`
- ะัะธะฒะฐั "ะฟัะธััะณะธะฒะฐะตััั" ะบ ะบะพะฝััะพะปัะฝัะผ ัะพัะบะฐะผ `Pโ` ะธ `Pโ`
- ะ ะฝะฐัะตะผ ัะปััะฐะต ะบัะธะฒะฐั ะธะผะตะตั S-ะพะฑัะฐะทะฝัั ัะพัะผั

---

### ะัะธะผะตั ัะฐััะตัะฐ ัะพัะตะบ ะฝะฐ ะบัะธะฒะพะน

**ะะฐะฝะพ:**
```
startX = 400, startY = 200
endX = 400, endY = 500
controlY = 350
```

**ะะฐััะตั ะดะปั t = 0.5 (ัะตัะตะดะธะฝะฐ ะบัะธะฒะพะน):**

```
X(0.5) = (1-0.5)ยณยท400 + 3(1-0.5)ยฒยท0.5ยท400 + 3(1-0.5)ยท0.5ยฒยท400 + 0.5ยณยท400
       = 0.125ยท400 + 3ยท0.25ยท0.5ยท400 + 3ยท0.5ยท0.25ยท400 + 0.125ยท400
       = 50 + 150 + 150 + 50
       = 400

Y(0.5) = (1-0.5)ยณยท200 + 3(1-0.5)ยฒยท0.5ยท350 + 3(1-0.5)ยท0.5ยฒยท350 + 0.5ยณยท500
       = 0.125ยท200 + 3ยท0.25ยท0.5ยท350 + 3ยท0.5ยท0.25ยท350 + 0.125ยท500
       = 25 + 131.25 + 131.25 + 62.5
       = 350
```

**ะะตะทัะปััะฐั:** ะขะพัะบะฐ ะฝะฐ ะบัะธะฒะพะน ะฟัะธ t=0.5: `(400, 350)`

---

## ะะฑัะฐะฑะพัะบะฐ ะฟะตัะตัะฐัะบะธะฒะฐะฝะธั

### ะกะพััะพัะฝะธะต ะฟะตัะตัะฐัะบะธะฒะฐะฝะธั

**ะะตัะตะผะตะฝะฝัะต ัะพััะพัะฝะธั:**
```typescript
const [draggingTaskId, setDraggingTaskId] = useState<string | null>(null)
const [draggingPosition, setDraggingPosition] = useState<{ x: number; y: number } | null>(null)
```

**ะะฐะทะฝะฐัะตะฝะธะต:**
- `draggingTaskId` - ID ะทะฐะดะฐัะธ, ะบะพัะพัะฐั ะฟะตัะตัะฐัะบะธะฒะฐะตััั
- `draggingPosition` - ัะตะบััะธะต ะบะพะพัะดะธะฝะฐัั ะฟะตัะตัะฐัะบะธะฒะฐะตะผะพะน ะทะฐะดะฐัะธ

---

### ะะฝะธัะธะฐัะธั ะฟะตัะตัะฐัะบะธะฒะฐะฝะธั

**ะ ะบะพะผะฟะพะฝะตะฝัะต TaskNode:**
```typescript
const handleMouseDown = (e: React.MouseEvent) => {
  e.stopPropagation()
  setIsDragging(true)
  setDragOffset({
    x: e.clientX - (nodeRef.current?.offsetLeft || 0),
    y: e.clientY - (nodeRef.current?.offsetTop || 0),
  })
  onDragStart(task.id)  // โ ะฃะฒะตะดะพะผะปะตะฝะธะต ัะพะดะธัะตะปั
}
```

**ะ ะบะพะผะฟะพะฝะตะฝัะต TaskBoard:**
```typescript
onDragStart={(taskId: string) => {
  setDraggingTaskId(taskId)
}}
```

---

### ะะฑะฝะพะฒะปะตะฝะธะต ะฟะพะทะธัะธะธ ะฟัะธ ะฟะตัะตัะฐัะบะธะฒะฐะฝะธะธ

**ะ ะบะพะผะฟะพะฝะตะฝัะต TaskNode:**
```typescript
const handleMouseMove = (e: MouseEvent) => {
  if (isDragging && nodeRef.current) {
    const newX = snapToGrid(e.clientX - dragOffset.x)
    const newY = snapToGrid(e.clientY - dragOffset.y)
    setTempPosition({ x: newX, y: newY })
    onDragMove(task.id, newX, newY)  // โ ะฃะฒะตะดะพะผะปะตะฝะธะต ัะพะดะธัะตะปั
  }
}
```

**ะ ะบะพะผะฟะพะฝะตะฝัะต TaskBoard:**
```typescript
onDragMove={(taskId: string, x: number, y: number) => {
  setDraggingTaskId(taskId)
  setDraggingPosition({ x, y })  // โ ะกะพััะฐะฝะตะฝะธะต ะฒัะตะผะตะฝะฝัั ะบะพะพัะดะธะฝะฐั
}}
```

**ะะตะทัะปััะฐั:** `draggingPosition` ะพะฑะฝะพะฒะปัะตััั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ

---

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒัะตะผะตะฝะฝัั ะบะพะพัะดะธะฝะฐั ะฒ ัะพะตะดะธะฝะตะฝะธัั

**ะัะพะฒะตัะบะฐ ะฒ drawTaskConnections:**
```typescript
const isTaskDragging = draggingTaskId === task.id && draggingPosition
const isParentDragging = draggingTaskId === parent.id && draggingPosition

const startX = isParentDragging
  ? draggingPosition!.x + parentWidth / 2  // โ ะัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั
  : parent.position_x + parentWidth / 2   // โ ะกะพััะฐะฝะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั

const endX = isTaskDragging
  ? draggingPosition!.x + childWidth / 2   // โ ะัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั
  : task.position_x + childWidth / 2       // โ ะกะพััะฐะฝะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั
```

**ะะพะณะธะบะฐ:**
- ะัะปะธ ะทะฐะดะฐัะฐ ะฟะตัะตัะฐัะบะธะฒะฐะตััั โ ะธัะฟะพะปัะทัะตะผ `draggingPosition`
- ะะฝะฐัะต โ ะธัะฟะพะปัะทัะตะผ `position_x` ะธ `position_y` ะธะท ะะ

**ะัะตะธะผััะตััะฒะฐ:**
- ะกะฒัะทะธ ะพะฑะฝะพะฒะปััััั ะผะณะฝะพะฒะตะฝะฝะพ ะฟัะธ ะฟะตัะตัะฐัะบะธะฒะฐะฝะธะธ
- ะะตั ะทะฐะดะตัะถะบะธ ะฝะฐ ะทะฐะฟัะพั ะบ ะะ
- ะะปะฐะฒะฝะฐั ะฐะฝะธะผะฐัะธั ะดะฒะธะถะตะฝะธั

---

### ะะฐะฒะตััะตะฝะธะต ะฟะตัะตัะฐัะบะธะฒะฐะฝะธั

**ะ ะบะพะผะฟะพะฝะตะฝัะต TaskNode:**
```typescript
const handleMouseUp = () => {
  if (isDragging) {
    onUpdate(task.id, { 
      position_x: tempPosition.x, 
      position_y: tempPosition.y 
    })  // โ ะกะพััะฐะฝะตะฝะธะต ะฒ ะะ
  }
  setIsDragging(false)
  onDragEnd()  // โ ะฃะฒะตะดะพะผะปะตะฝะธะต ัะพะดะธัะตะปั
}
```

**ะ ะบะพะผะฟะพะฝะตะฝัะต TaskBoard:**
```typescript
onDragEnd={() => {
  setDraggingTaskId(null)
  setDraggingPosition(null)  // โ ะัะธััะบะฐ ะฒัะตะผะตะฝะฝัั ะบะพะพัะดะธะฝะฐั
}}
```

**ะะตะทัะปััะฐั:**
- ะะพะพัะดะธะฝะฐัั ัะพััะฐะฝััััั ะฒ ะะ
- ะัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั ะพัะธัะฐัััั
- ะกะพะตะดะธะฝะตะฝะธั ะฟะตัะตะบะปััะฐัััั ะฝะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะพััะฐะฝะตะฝะฝัั ะบะพะพัะดะธะฝะฐั

---

## ะััะปะตะถะธะฒะฐะฝะธะต ะฒััะพัั ะบะฐััะพัะตะบ

### ะัะพะฑะปะตะผะฐ

**ะััะพัะฐ ะบะฐััะพัะบะธ ะผะพะถะตั ะธะทะผะตะฝััััั:**
- ะะพะฑะฐะฒะปะตะฝะธะต ัะพะดะตัะถะธะผะพะณะพ (ัะตะบะปะธัั)
- ะะทะผะตะฝะตะฝะธะต ัะฐะทะผะตัะฐ ัะตัะตะท resize handle
- ะัะบัััะธะต/ะทะฐะบัััะธะต ะฟะฐะฝะตะปะธ ะฝะฐัััะพะตะบ
- ะะทะผะตะฝะตะฝะธะต ะบะพะปะธัะตััะฒะฐ ัะปะตะผะตะฝัะพะฒ ัะพะดะตัะถะธะผะพะณะพ

**ะะปะธัะฝะธะต ะฝะฐ ัะพะตะดะธะฝะตะฝะธั:**
- ะะฐัะฐะปัะฝะฐั ัะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ะฝะฐัะพะดะธััั ะฒ ะฝะธะถะฝะตะน ัะฐััะธ ะบะฐััะพัะบะธ
- ะัะปะธ ะฒััะพัะฐ ะธะทะผะตะฝัะตััั โ ัะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ะดะพะปะถะฝะฐ ะฟะตัะตะผะตััะธัััั

---

### ะะตัะตะฝะธะต: ResizeObserver

**ะ ะบะพะผะฟะพะฝะตะฝัะต TaskNode:**
```typescript
useEffect(() => {
  const updateHeight = () => {
    if (nodeRef.current) {
      const height = nodeRef.current.offsetHeight
      onHeightChange(task.id, height)  // โ ะฃะฒะตะดะพะผะปะตะฝะธะต ัะพะดะธัะตะปั
    }
  }

  // ะะฐัะฐะปัะฝะพะต ะธะทะผะตัะตะฝะธะต
  updateHeight()

  // ะััะปะตะถะธะฒะฐะฝะธะต ะธะทะผะตะฝะตะฝะธะน
  const observer = new ResizeObserver(updateHeight)
  if (nodeRef.current) {
    observer.observe(nodeRef.current)
  }

  return () => {
    observer.disconnect()
  }
}, [task.id, contentItems, isExpanded, isContentCollapsed, onHeightChange])
```

**ะ ะบะพะผะฟะพะฝะตะฝัะต TaskBoard:**
```typescript
const [taskHeights, setTaskHeights] = useState<Record<string, number>>({})

const handleTaskHeightChange = useCallback((taskId: string, height: number) => {
  setTaskHeights((prev) => ({ ...prev, [taskId]: height }))
}, [])
```

**ะะตัะตะดะฐัะฐ ะฒ TaskNode:**
```tsx
<TaskNode
  onHeightChange={handleTaskHeightChange}
  // ...
/>
```

---

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒััะพัั ะฒ ัะพะตะดะธะฝะตะฝะธัั

**ะ drawTaskConnections:**
```typescript
const parentHeight = taskHeights[parent.id] || 150
const startY = isParentDragging
  ? draggingPosition!.y + parentHeight
  : parent.position_y + parentHeight
```

**ะะพะณะธะบะฐ:**
- ะะพะปััะฐะตะผ ะฒััะพัั ะธะท `taskHeights[parent.id]`
- ะัะปะธ ะฒััะพัะฐ ะฝะตะธะทะฒะตััะฝะฐ โ ะธัะฟะพะปัะทัะตะผ `150px` (ะทะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั)
- ะััะธัะปัะตะผ ะฝะธะถะฝัั ัะพัะบั: `position_y + height`

**ะะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั:**
- `150px` - ะฟัะธะผะตัะฝะฐั ะฒััะพัะฐ ะบะฐััะพัะบะธ ะฑะตะท ัะพะดะตัะถะธะผะพะณะพ
- ะัะฟะพะปัะทัะตััั ะฟัะธ ะฟะตัะฒะพะผ ัะตะฝะดะตัะต, ะฟะพะบะฐ ResizeObserver ะฝะต ะธะทะผะตัะธะป ะฒััะพัั

---

## ะะธะทัะฐะปัะฝัะต ะฟะฐัะฐะผะตััั ัะพะตะดะธะฝะตะฝะธะน

### SVG Path (ะปะธะฝะธั ัะพะตะดะธะฝะตะฝะธั)

**ะกัะธะปะธ:**
```tsx
<path
  d={path}
  stroke="rgba(255, 255, 255, 0.3)"
  strokeWidth="2"
  fill="none"
/>
```

**ะะฐัะฐะผะตััั:**
- **stroke:** `rgba(255, 255, 255, 0.3)` - ะฑะตะปัะน ัะฒะตั ั 30% ะฟัะพะทัะฐัะฝะพััะธ
- **strokeWidth:** `2` - ัะพะปัะธะฝะฐ ะปะธะฝะธะธ 2px
- **fill:** `none` - ะฑะตะท ะทะฐะปะธะฒะบะธ

**ะะธะทัะฐะปัะฝัะน ัััะตะบั:**
- ะะพะปัะฟัะพะทัะฐัะฝะฐั ะฑะตะปะฐั ะปะธะฝะธั
- ะฅะพัะพัะพ ะฒะธะดะฝะฐ ะฝะฐ ัะตะผะฝะพะผ ัะพะฝะต
- ะะต ะฟะตัะตะณััะถะฐะตั ะธะฝัะตััะตะนั

---

### ะขะพัะบะธ ัะพะตะดะธะฝะตะฝะธั (Circles)

**ะกัะธะปะธ:**
```tsx
<circle
  cx={startX}
  cy={startY}
  r="4"
  fill="rgba(255, 255, 255, 0.5)"
/>
```

**ะะฐัะฐะผะตััั:**
- **r:** `4` - ัะฐะดะธัั 4px
- **fill:** `rgba(255, 255, 255, 0.5)` - ะฑะตะปัะน ัะฒะตั ั 50% ะฟัะพะทัะฐัะฝะพััะธ

**ะะฐัะฟะพะปะพะถะตะฝะธะต:**
- ะะฐัะฐะปัะฝะฐั ัะพัะบะฐ: `(startX, startY)` - ะฝะธะถะฝะธะน ัะตะฝัั ัะพะดะธัะตะปั
- ะะพะฝะตัะฝะฐั ัะพัะบะฐ: `(endX, endY)` - ะฒะตััะฝะธะน ัะตะฝัั ะฟะพัะพะผะบะฐ

**ะะธะทัะฐะปัะฝัะน ัััะตะบั:**
- ะฏััะต ัะตะผ ะปะธะฝะธั (50% vs 30%)
- ะงะตัะบะพ ะฟะพะบะฐะทัะฒะฐะตั ัะพัะบะธ ัะพะตะดะธะฝะตะฝะธั
- ะััะณะปัะต ะผะฐัะบะตัั ะฝะฐ ะบะพะฝัะฐั ะปะธะฝะธะธ

---

### Z-index ะธ ะฟะพััะดะพะบ ะพััะธัะพะฒะบะธ

**SVG ัะปะตะผะตะฝั:**
```tsx
<svg
  className="pointer-events-none absolute left-0 top-0"
  style={{
    width: `${CANVAS_WIDTH}px`,
    height: `${CANVAS_HEIGHT}px`,
    overflow: "visible",
    zIndex: 1,
  }}
>
  {drawTaskConnections()}
</svg>
```

**Z-index:**
- SVG: `zIndex: 1` - ะฟะพะด ะทะฐะดะฐัะฐะผะธ
- ะะฐะดะฐัะธ: `zIndex: 10` (ะพะฑััะฝัะต) ะธะปะธ `zIndex: 30` (ะฒัะฑัะฐะฝะฝัะต)

**ะะตะทัะปััะฐั:** ะกะพะตะดะธะฝะตะฝะธั ะฒัะตะณะดะฐ ะฟะพะด ะบะฐััะพัะบะฐะผะธ ะทะฐะดะฐั

**pointer-events-none:**
- ะกะพะตะดะธะฝะตะฝะธั ะฝะต ะฑะปะพะบะธัััั ะบะปะธะบะธ ะฟะพ ะทะฐะดะฐัะฐะผ
- ะะพะถะฝะพ ะบะปะธะบะฐัั ัะบะฒะพะทั ะปะธะฝะธะธ

---

## ะฆะตะปัะฝะฐั ัะธััะตะผะฐ ัะฐะทะผะตัะตะฝะธั ะธ ัะพะตะดะธะฝะตะฝะธั

### ะะดะธะฝะฐั ัะธััะตะผะฐ ะบะพะพัะดะธะฝะฐั ะดะปั ะทะฐะดะฐั ะธ ัะพะตะดะธะฝะตะฝะธะน

**ะัะธะฝัะธะฟ:** ะัะต ัะปะตะผะตะฝัั (ะทะฐะดะฐัะธ ะธ ัะพะตะดะธะฝะตะฝะธั) ัััะตััะฒััั ะฒ ะตะดะธะฝะพะผ ะฟัะพัััะฐะฝััะฒะต ะบะพะพัะดะธะฝะฐั ะบะฐะฝะฒะฐัะฐ.

**ะกัะตะผะฐ ะบะพะพัะดะธะฝะฐัะฝะพะน ัะธััะตะผั:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะฐะฝะฒะฐั (5000x5000px)                  โ
โ  ะะฐัะฐะปะพ ะบะพะพัะดะธะฝะฐั: (0, 0)              โ
โ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  ะะฐะดะฐัะฐ A                         โ  โ
โ  โ  position: (300, 200)             โ  โ
โ  โ  ะะฐะทะผะตั: 224 x 150                โ  โ
โ  โ  ะัะฐะฝะธัั:                         โ  โ
โ  โ    ะะตะฒัะน ะฒะตัั: (300, 200)         โ  โ
โ  โ    ะัะฐะฒัะน ะฒะตัั: (524, 200)        โ  โ
โ  โ    ะะตะฒัะน ะฝะธะท: (300, 350)          โ  โ
โ  โ    ะัะฐะฒัะน ะฝะธะท: (524, 350)         โ  โ
โ  โ    ะฆะตะฝัั: (412, 275)              โ  โ
โ  โ    ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั: (412, 350)   โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ            โ                             โ
โ            โ ะกะพะตะดะธะฝะตะฝะธะต                  โ
โ            โ ะะฐัะฐะปะพ: (412, 350)          โ
โ            โ ะะพะฝะตั: (412, 400)            โ
โ            โ ะัะธะฒะฐั: M 412 350 C ...     โ
โ            โ                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  ะะฐะดะฐัะฐ B                         โ  โ
โ  โ  position: (300, 400)             โ  โ
โ  โ  ะะฐะทะผะตั: 224 x 120                โ  โ
โ  โ  ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั: (412, 400)     โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### ะะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ัะฐะทะผะตัะตะฝะธั ะบะฐััะพัะบะธ ะทะฐะดะฐัะธ

#### ะะตะพะผะตััะธัะตัะบะธะต ะฟะฐัะฐะผะตััั ะบะฐััะพัะบะธ

**ะะฐะทะพะฒัะต ัะฐะทะผะตัั:**
```typescript
const CARD_WIDTH = 224      // ะคะธะบัะธัะพะฒะฐะฝะฝะฐั ัะธัะธะฝะฐ
const CARD_MIN_HEIGHT = 60  // ะะธะฝะธะผะฐะปัะฝะฐั ะฒััะพัะฐ (ะทะฐะณะพะปะพะฒะพะบ)
const CARD_DEFAULT_HEIGHT = 150  // ะััะพัะฐ ะฟะพ ัะผะพะปัะฐะฝะธั
```

**ะะธะฝะฐะผะธัะตัะบะธะต ัะฐะทะผะตัั:**
- ะััะพัะฐ ะทะฐะฒะธัะธั ะพั ัะพะดะตัะถะธะผะพะณะพ
- ะจะธัะธะฝะฐ ะผะพะถะตั ะธะทะผะตะฝััััั ัะตัะตะท resize handle (ะฝะพ ะดะปั ัะพะตะดะธะฝะตะฝะธะน ะธัะฟะพะปัะทัะตััั 224px)

---

#### ะขะพัะฝะพะต ะฟะพะทะธัะธะพะฝะธัะพะฒะฐะฝะธะต ะบะฐััะพัะบะธ

**ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั:**
```typescript
style={{
  position: 'absolute',
  left: task.position_x,    // X ะบะพะพัะดะธะฝะฐัะฐ ะปะตะฒะพะณะพ ะบัะฐั
  top: task.position_y,     // Y ะบะพะพัะดะธะฝะฐัะฐ ะฒะตััะฝะตะณะพ ะบัะฐั
  width: cardSize.width,     // ะจะธัะธะฝะฐ ะบะฐััะพัะบะธ
}}
```

**ะะธะทัะฐะปะธะทะฐัะธั ะบะพะพัะดะธะฝะฐั:**
```
ะะฐะฝะฒะฐั (0, 0)
  โ
  โ
  โ     (position_x, position_y) โ ะะตะฒัะน ะฒะตััะฝะธะน ัะณะพะป
  โ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  โ     โ                             โ
  โ     โ      ะะฐััะพัะบะฐ ะทะฐะดะฐัะธ        โ
  โ     โ      width: 224px           โ
  โ     โ      height: ~150px          โ
  โ     โ                             โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  โ              (position_x + 224, position_y + height)
  โ              ะัะฐะฒัะน ะฝะธะถะฝะธะน ัะณะพะป
```

---

#### ะัะต ะบะปััะตะฒัะต ัะพัะบะธ ะบะฐััะพัะบะธ

**ะขะพัะบะฐ 1: ะะตะฒัะน ะฒะตััะฝะธะน ัะณะพะป**
```
P1 = (position_x, position_y)
```

**ะขะพัะบะฐ 2: ะัะฐะฒัะน ะฒะตััะฝะธะน ัะณะพะป**
```
P2 = (position_x + width, position_y)
   = (position_x + 224, position_y)
```

**ะขะพัะบะฐ 3: ะะตะฒัะน ะฝะธะถะฝะธะน ัะณะพะป**
```
P3 = (position_x, position_y + height)
```

**ะขะพัะบะฐ 4: ะัะฐะฒัะน ะฝะธะถะฝะธะน ัะณะพะป**
```
P4 = (position_x + width, position_y + height)
   = (position_x + 224, position_y + height)
```

**ะขะพัะบะฐ 5: ะฆะตะฝัั ะบะฐััะพัะบะธ**
```
P5 = (position_x + width/2, position_y + height/2)
   = (position_x + 112, position_y + height/2)
```

**ะขะพัะบะฐ 6: ะะตััะฝะธะน ัะตะฝัั (ะดะปั ัะพะตะดะธะฝะตะฝะธะน ะฟะพัะพะผะบะฐ)**
```
P6 = (position_x + width/2, position_y)
   = (position_x + 112, position_y)
```

**ะขะพัะบะฐ 7: ะะธะถะฝะธะน ัะตะฝัั (ะดะปั ัะพะตะดะธะฝะตะฝะธะน ัะพะดะธัะตะปั)**
```
P7 = (position_x + width/2, position_y + height)
   = (position_x + 112, position_y + height)
```

**ะัะธะผะตั ะดะปั ะทะฐะดะฐัะธ:**
```
position_x = 300
position_y = 200
width = 224
height = 150

P1 = (300, 200)      // ะะตะฒัะน ะฒะตััะฝะธะน
P2 = (524, 200)      // ะัะฐะฒัะน ะฒะตััะฝะธะน
P3 = (300, 350)      // ะะตะฒัะน ะฝะธะถะฝะธะน
P4 = (524, 350)      // ะัะฐะฒัะน ะฝะธะถะฝะธะน
P5 = (412, 275)      // ะฆะตะฝัั
P6 = (412, 200)      // ะะตััะฝะธะน ัะตะฝัั (ัะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ะฟะพัะพะผะบะฐ)
P7 = (412, 350)      // ะะธะถะฝะธะน ัะตะฝัั (ัะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ัะพะดะธัะตะปั)
```

---

### ะะฐะทะผะตัะตะฝะธะต ะทะฐะดะฐั ะพัะฝะพัะธัะตะปัะฝะพ ะดััะณ ะดััะณะฐ

#### ะะตััะธะบะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต (ััะฐะฝะดะฐัั)

**ะัะฐะฒะธะปะพ:** ะะพัะตัะฝัั ะทะฐะดะฐัะฐ ัะฐะทะผะตัะฐะตััั ะฟะพะด ัะพะดะธัะตะปััะบะพะน ะฝะฐ ััะฐะฝะดะฐััะฝะพะผ ัะฐัััะพัะฝะธะธ.

**ะคะพัะผัะปะฐ ัะฐะทะผะตัะตะฝะธั:**
```typescript
child.position_x = parent.position_x  // ะขะฐ ะถะต X ะบะพะพัะดะธะฝะฐัะฐ
child.position_y = snapToGrid(parent.position_y + STANDARD_OFFSET)
```

**ะะดะต:**
- `STANDARD_OFFSET = 150` - ััะฐะฝะดะฐััะฝัะน ะพััััะฟ ะผะตะถะดั ัะพะดะธัะตะปะตะผ ะธ ะฟะพัะพะผะบะพะผ

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพะดะธัะตะปั              โ  position: (300, 200)
โ   height: 150            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โ 150px (ััะฐะฝะดะฐััะฝัะน ะพััััะฟ)
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพัะพะผะพะบ               โ  position: (300, 350)
โ                         โ  = (300, 200 + 150)
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต:**
```typescript
raw_y = parent.position_y + 150
child.position_y = snapToGrid(raw_y)

// ะัะธะผะตั:
// parent.position_y = 207
// raw_y = 207 + 150 = 357
// child.position_y = snapToGrid(357) = Math.round(357/20) * 20 = 18 * 20 = 360
```

---

#### ะะพัะธะทะพะฝัะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต (ะฑัะฐััะบะธะต ะทะฐะดะฐัะธ)

**ะัะฐะฒะธะปะพ:** ะะฐะดะฐัะธ ะฝะฐ ะพะดะฝะพะผ ััะพะฒะฝะต ัะฐะทะผะตัะฐัััั ะณะพัะธะทะพะฝัะฐะปัะฝะพ ั ะพััััะฟะพะผ.

**ะคะพัะผัะปะฐ:**
```typescript
nextTask.position_x = previousTask.position_x + CARD_WIDTH + GAP
nextTask.position_y = previousTask.position_y  // ะขะฐ ะถะต Y ะบะพะพัะดะธะฝะฐัะฐ
```

**ะะดะต:**
- `CARD_WIDTH = 224`
- `GAP = 20` (1 ััะตะนะบะฐ ัะตัะบะธ)

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโ  20px  โโโโโโโ  20px  โโโโโโโ
โ  A  โ โโโโโโ โ  B  โ โโโโโโ โ  C  โ
โโโโโโโ        โโโโโโโ        โโโโโโโ
(100, 200)    (344, 200)    (588, 200)
```

**ะะฐััะตั:**
```
Task A: position_x = 100
Task B: position_x = 100 + 224 + 20 = 344
Task C: position_x = 344 + 224 + 20 = 588
```

---

#### ะะธะฐะณะพะฝะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต

**ะกัะตะฝะฐัะธะน:** ะะฐะดะฐัะธ ัะฐะทะผะตัะฐัััั ะฟะพ ะดะธะฐะณะพะฝะฐะปะธ (ัะฐะทะฝัะต X ะธ Y).

**ะัะธะผะตั:**
```
Task A: (200, 100)
Task B: (500, 300)  // ะกะผะตัะตะฝะธะต: +300 ะฟะพ X, +200 ะฟะพ Y
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโ
โ  A  โ  (200, 100)
โโโโโโโ
    โ
    โ  (ะดะธะฐะณะพะฝะฐะปัะฝะพะต ัะพะตะดะธะฝะตะฝะธะต)
    โ
         โโโโโโโ
         โ  B  โ  (500, 300)
         โโโโโโโ
```

---

### ะขะพัะฝะพะต ะพะฟะธัะฐะฝะธะต ัะพัะตะบ ัะพะตะดะธะฝะตะฝะธั

#### ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ะฝะฐ ัะพะดะธัะตะปััะบะพะน ะทะฐะดะฐัะต

**ะะฐะทะฒะฐะฝะธะต:** Start Point (ะฝะฐัะฐะปัะฝะฐั ัะพัะบะฐ)

**ะะฐัะฟะพะปะพะถะตะฝะธะต:** ะะธะถะฝะธะน ัะตะฝัั ะบะฐััะพัะบะธ

**ะะฐัะตะผะฐัะธัะตัะบะพะต ะพะฟะธัะฐะฝะธะต:**
```
startX = parent.position_x + (parentWidth / 2)
startY = parent.position_y + parentHeight
```

**ะะดะต:**
- `parentWidth = 224` (ัะธะบัะธัะพะฒะฐะฝะฝะฐั ัะธัะธะฝะฐ)
- `parentHeight = taskHeights[parent.id] || 150` (ะดะธะฝะฐะผะธัะตัะบะฐั ะฒััะพัะฐ)

**ะะธะทัะฐะปะธะทะฐัะธั ะฝะฐ ะบะฐััะพัะบะต:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพะดะธัะตะปััะบะฐั ะทะฐะดะฐัะฐ               โ
โ   position: (300, 200)              โ
โ   width: 224                        โ
โ   height: 150                        โ
โ                                     โ
โ                                     โ
โ                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
            โ
            โ (startX, startY)
            โ = (412, 350)
            โ
      [ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั]
      (ะบััะณ, r=4px)
```

**ะะตัะฐะปัะฝัะน ัะฐััะตั:**
```
parent.position_x = 300
parent.position_y = 200
parentWidth = 224
parentHeight = 150

startX = 300 + (224 / 2)
      = 300 + 112
      = 412

startY = 200 + 150
      = 350

ะะตะทัะปััะฐั: (412, 350)
```

**ะัะพะฑะตะฝะฝะพััะธ:**
- X ะบะพะพัะดะธะฝะฐัะฐ: ะฒัะตะณะดะฐ ัะตะฝัั ะบะฐััะพัะบะธ ะฟะพ ะณะพัะธะทะพะฝัะฐะปะธ
- Y ะบะพะพัะดะธะฝะฐัะฐ: ะฒัะตะณะดะฐ ะฝะธะถะฝะธะน ะบัะฐะน ะบะฐััะพัะบะธ
- ะะฐะฒะธัะธั ะพั ะฒััะพัั ะบะฐััะพัะบะธ (ะธะทะผะตะฝัะตััั ะฟัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ัะพะดะตัะถะธะผะพะณะพ)

---

#### ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ะฝะฐ ะดะพัะตัะฝะตะน ะทะฐะดะฐัะต

**ะะฐะทะฒะฐะฝะธะต:** End Point (ะบะพะฝะตัะฝะฐั ัะพัะบะฐ)

**ะะฐัะฟะพะปะพะถะตะฝะธะต:** ะะตััะฝะธะน ัะตะฝัั ะบะฐััะพัะบะธ

**ะะฐัะตะผะฐัะธัะตัะบะพะต ะพะฟะธัะฐะฝะธะต:**
```
endX = child.position_x + (childWidth / 2)
endY = child.position_y
```

**ะะดะต:**
- `childWidth = 224` (ัะธะบัะธัะพะฒะฐะฝะฝะฐั ัะธัะธะฝะฐ)
- `child.position_y` - ะฒะตััะฝะธะน ะบัะฐะน (ะฑะตะท ะดะพะฑะฐะฒะปะตะฝะธั ะฒััะพัั)

**ะะธะทัะฐะปะธะทะฐัะธั ะฝะฐ ะบะฐััะพัะบะต:**
```
      [ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั]
      (ะบััะณ, r=4px)
            โ
            โ (endX, endY)
            โ = (412, 400)
            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพัะตัะฝัั ะทะฐะดะฐัะฐ                   โ
โ   position: (300, 400)              โ
โ   width: 224                        โ
โ                                     โ
โ                                     โ
โ                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะตัะฐะปัะฝัะน ัะฐััะตั:**
```
child.position_x = 300
child.position_y = 400
childWidth = 224

endX = 300 + (224 / 2)
     = 300 + 112
     = 412

endY = 400

ะะตะทัะปััะฐั: (412, 400)
```

**ะัะพะฑะตะฝะฝะพััะธ:**
- X ะบะพะพัะดะธะฝะฐัะฐ: ะฒัะตะณะดะฐ ัะตะฝัั ะบะฐััะพัะบะธ ะฟะพ ะณะพัะธะทะพะฝัะฐะปะธ
- Y ะบะพะพัะดะธะฝะฐัะฐ: ะฒัะตะณะดะฐ ะฒะตััะฝะธะน ะบัะฐะน ะบะฐััะพัะบะธ
- ะะต ะทะฐะฒะธัะธั ะพั ะฒััะพัั ะบะฐััะพัะบะธ (ะธัะฟะพะปัะทัะตััั ัะพะปัะบะพ position_y)

---

### ะะพะปะฝัะน ะฟัะพัะตัั ัะฐะทะผะตัะตะฝะธั ะธ ัะพะตะดะธะฝะตะฝะธั

#### ะจะฐะณ 1: ะกะพะทะดะฐะฝะธะต ัะพะดะธัะตะปััะบะพะน ะทะฐะดะฐัะธ

**ะะตะนััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปั:** ะะฒะพะนะฝะพะน ะบะปะธะบ ะฝะฐ ะบะฐะฝะฒะฐัะต ะฒ ะฟะพะทะธัะธะธ (400, 200)

**ะััะธัะปะตะฝะธะต ะบะพะพัะดะธะฝะฐั:**
```typescript
// ะะพะพัะดะธะฝะฐัั ะบะปะธะบะฐ ะพัะฝะพัะธัะตะปัะฝะพ ะบะฐะฝะฒะฐัะฐ
const rect = canvasRef.current.getBoundingClientRect()
const x = (e.clientX - rect.left - offset.x) / scale
const y = (e.clientY - rect.top - offset.y) / scale

// ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต
const snappedX = snapToGrid(x)
const snappedY = snapToGrid(y)
```

**ะัะธะผะตั ัะฐััะตัะฐ:**
```
ะะปะธะบ ะฝะฐ ัะบัะฐะฝะต: (600, 300)
offset: (200, 100)
scale: 1.0

x = (600 - 200 - 200) / 1.0 = 200
y = (300 - 100 - 100) / 1.0 = 100

snappedX = snapToGrid(200) = 200
snappedY = snapToGrid(100) = 100

ะะตะทัะปััะฐั: position = (200, 100)
```

**ะกะพะทะดะฐะฝะธะต ะทะฐะดะฐัะธ:**
```typescript
insert({
  position_x: 200,
  position_y: 100,
  parent_id: null,  // ะะพัะฝะตะฒะฐั ะทะฐะดะฐัะฐ
  // ...
})
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
ะะฐะฝะฒะฐั
  โ
  โ     (200, 100)
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ     โ   ะะฐะดะฐัะฐ A           โ
  โ     โ   width: 224         โ
  โ     โ   height: 150        โ
  โ     โ                      โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ              (424, 250)
```

---

#### ะจะฐะณ 2: ะกะพะทะดะฐะฝะธะต ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ

**ะะตะนััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปั:** ะัะฐะฒัะน ะบะปะธะบ ะฝะฐ ะทะฐะดะฐัะต A โ "ะกะพะทะดะฐัั ัะฒัะทะฐะฝะฝัั ะทะฐะดะฐัั"

**ะััะธัะปะตะฝะธะต ะฟะพะทะธัะธะธ:**
```typescript
const parentTask = tasks.find(t => t.id === taskContextMenu.taskId)

const childX = parentTask.position_x  // 200
const childY = parentTask.position_y + 150  // 100 + 150 = 250

const snappedX = snapToGrid(childX)  // 200
const snappedY = snapToGrid(childY)   // 240 (ะฟัะธะฒัะทะบะฐ ะบ ัะตัะบะต)
```

**ะะตัะฐะปัะฝัะน ัะฐััะตั:**
```
parent.position_x = 200
parent.position_y = 100

childX = 200
childY = 100 + 150 = 250

snappedX = snapToGrid(200) = 200
snappedY = snapToGrid(250) = Math.round(250/20) * 20 = 12 * 20 = 240
```

**ะกะพะทะดะฐะฝะธะต ะทะฐะดะฐัะธ:**
```typescript
insert({
  position_x: 200,
  position_y: 240,
  parent_id: "task-a",  // โ ะกะฒัะทั ัะพะทะดะฐะตััั ะทะดะตัั
  // ...
})
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ A           โ  (200, 100)
โ   height: 150        โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โ 140px (ะฟัะธะฒัะทะฐะฝะพ ะบ ัะตัะบะต)
         โ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ B           โ  (200, 240)
โ   parent_id: "task-a"โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

#### ะจะฐะณ 3: ะะฒัะพะผะฐัะธัะตัะบะพะต ะฒััะธัะปะตะฝะธะต ัะพะตะดะธะฝะตะฝะธั

**ะขัะธะณะณะตั:** ะัะธ ัะตะฝะดะตัะต ะบะพะผะฟะพะฝะตะฝัะฐ ะฒัะทัะฒะฐะตััั `drawTaskConnections()`

**ะัะพัะตัั:**
```typescript
// 1. ะะฐัะพะดะธะผ ะฒัะต ะทะฐะดะฐัะธ ั ัะพะดะธัะตะปะตะผ
tasks.filter(task => task.parent_id)

// 2. ะะปั ะบะฐะถะดะพะน ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ ะฝะฐัะพะดะธะผ ัะพะดะธัะตะปั
const parent = tasks.find(t => t.id === task.parent_id)

// 3. ะััะธัะปัะตะผ ัะพัะบะธ ัะพะตะดะธะฝะตะฝะธั
const startX = parent.position_x + 112  // 200 + 112 = 312
const startY = parent.position_y + 150  // 100 + 150 = 250

const endX = child.position_x + 112  // 200 + 112 = 312
const endY = child.position_y  // 240

// 4. ะััะธัะปัะตะผ ะบะพะฝััะพะปัะฝัะต ัะพัะบะธ
const controlY = startY + (endY - startY) / 2
              = 250 + (240 - 250) / 2
              = 250 + (-10) / 2
              = 250 - 5
              = 245
```

**ะะตะทัะปััะฐั:**
```
ะะฐัะฐะปัะฝะฐั ัะพัะบะฐ: (312, 250)
ะะพะฝะตัะฝะฐั ัะพัะบะฐ:  (312, 240)
ะะพะฝััะพะปัะฝัะต:     (312, 245), (312, 245)
```

**SVG Path:**
```
M 312 250 C 312 245, 312 245, 312 240
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ A           โ
โ                      โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
    (312, 250) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั
         โ
    โโโโโโโโโ  (ะบัะธะฒะฐั ะะตะทัะต)
         โ
    (312, 240) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั
         โ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ B           โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

### ะะทะฐะธะผะพัะฒัะทั ัะฐะทะผะตัะตะฝะธั ะธ ัะพะตะดะธะฝะตะฝะธะน

#### ะะดะธะฝะฐั ัะธััะตะผะฐ ะบะพะพัะดะธะฝะฐั

**ะัะธะฝัะธะฟ:** ะัะต ะบะพะพัะดะธะฝะฐัั ะฒ ะตะดะธะฝะพะผ ะฟัะพัััะฐะฝััะฒะต ะบะฐะฝะฒะฐัะฐ

**ะกัะตะผะฐ:**
```
ะะฐะฝะฒะฐั (5000x5000)
  โ
  โโ ะะฐะดะฐัะฐ A
  โ    position: (300, 200)
  โ    ะัะฐะฝะธัั: (300, 200) โ (524, 350)
  โ    ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั: (412, 350)
  โ    โ
  โ    โโ ะกะพะตะดะธะฝะตะฝะธะต
  โ         ะะฐัะฐะปะพ: (412, 350)
  โ         ะะพะฝะตั: (412, 400)
  โ         ะัะธะฒะฐั: M 412 350 C ...
  โ
  โโ ะะฐะดะฐัะฐ B
       position: (300, 400)
       ะัะฐะฝะธัั: (300, 400) โ (524, 520)
       ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั: (412, 400)
```

**ะะปััะตะฒะพะน ะผะพะผะตะฝั:** ะะพะพัะดะธะฝะฐัั ะทะฐะดะฐั ะธ ัะพะตะดะธะฝะตะฝะธะน ะฒ ะพะดะฝะพะผ ะฟัะพัััะฐะฝััะฒะต

---

#### ะกะธะฝััะพะฝะธะทะฐัะธั ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ะฟะพะทะธัะธะธ

**ะกัะตะฝะฐัะธะน:** ะะพะปัะทะพะฒะฐัะตะปั ะฟะตัะตะผะตัะฐะตั ัะพะดะธัะตะปััะบัั ะทะฐะดะฐัั

**ะัะพัะตัั:**
```typescript
// ะกัะฐัะพะต ัะพััะพัะฝะธะต
parent.position_x = 300
parent.position_y = 200
startX = 300 + 112 = 412
startY = 200 + 150 = 350

// ะะพะปัะทะพะฒะฐัะตะปั ะฟะตัะตะผะตัะฐะตั ะทะฐะดะฐัั
// ะะพะฒัะต ะบะพะพัะดะธะฝะฐัั ะฟะพัะปะต ะฟะตัะตัะฐัะบะธะฒะฐะฝะธั
parent.position_x = 500
parent.position_y = 300

// ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ัะพะตะดะธะฝะตะฝะธั
startX = 500 + 112 = 612  // โ ะะฑะฝะพะฒะธะปะพัั
startY = 300 + 150 = 450  // โ ะะฑะฝะพะฒะธะปะพัั
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
ะะพ ะฟะตัะตะผะตัะตะฝะธั:
  ะะพะดะธัะตะปั: (300, 200)
  ะกะพะตะดะธะฝะตะฝะธะต: (412, 350) โ (412, 400)

ะะพัะปะต ะฟะตัะตะผะตัะตะฝะธั:
  ะะพะดะธัะตะปั: (500, 300)
  ะกะพะตะดะธะฝะตะฝะธะต: (612, 450) โ (412, 400)  โ ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะธะปะพัั
```

---

#### ะกะธะฝััะพะฝะธะทะฐัะธั ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ัะฐะทะผะตัะฐ

**ะกัะตะฝะฐัะธะน:** ะะพะปัะทะพะฒะฐัะตะปั ะธะทะผะตะฝัะตั ะฒััะพัั ะบะฐััะพัะบะธ (ะดะพะฑะฐะฒะปัะตั ัะพะดะตัะถะธะผะพะต)

**ะัะพัะตัั:**
```typescript
// ะะฐัะฐะปัะฝะพะต ัะพััะพัะฝะธะต
parentHeight = 150
startY = 200 + 150 = 350

// ะะพะปัะทะพะฒะฐัะตะปั ะดะพะฑะฐะฒะปัะตั ัะพะดะตัะถะธะผะพะต
// ResizeObserver ะพััะปะตะถะธะฒะฐะตั ะธะทะผะตะฝะตะฝะธะต
parentHeight = 250  // โ ะะฑะฝะพะฒะธะปะพัั

// ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ัะพะตะดะธะฝะตะฝะธั
startY = 200 + 250 = 450  // โ ะะฑะฝะพะฒะธะปะพัั
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
ะะพ ะดะพะฑะฐะฒะปะตะฝะธั ัะพะดะตัะถะธะผะพะณะพ:
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ A           โ  height: 150
โโโโโโโโโโโโโโโโโโโโโโโ
         โ (350)
    [ัะพะตะดะธะฝะตะฝะธะต]

ะะพัะปะต ะดะพะฑะฐะฒะปะตะฝะธั ัะพะดะตัะถะธะผะพะณะพ:
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ A           โ  height: 250
โ   [ัะพะดะตัะถะธะผะพะต]      โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ (450)  โ ะขะพัะบะฐ ะฟะตัะตะผะตััะธะปะฐัั
    [ัะพะตะดะธะฝะตะฝะธะต]
```

---

### ะะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ัะฐะทะผะตัะตะฝะธั ะฒ ะฟัะพัััะฐะฝััะฒะต

#### ะัะพัััะฐะฝััะฒะตะฝะฝะฐั ะผะพะดะตะปั

**ะขัะตัะผะตัะฝะพะต ะฟัะตะดััะฐะฒะปะตะฝะธะต (X, Y, Z-index):**

```
Z-index: 1 (ัะพะตะดะธะฝะตะฝะธั)
  โ
  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  โ  โ  SVG ั ัะพะตะดะธะฝะตะฝะธัะผะธ             โ
  โ  โ  z-index: 1                     โ
  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  โ
Z-index: 10 (ะพะฑััะฝัะต ะทะฐะดะฐัะธ)
  โ
  โ  โโโโโโโ     โโโโโโโ     โโโโโโโ
  โ  โ  A  โ     โ  B  โ     โ  C  โ
  โ  โโโโโโโ     โโโโโโโ     โโโโโโโ
  โ
Z-index: 30 (ะฒัะฑัะฐะฝะฝัะต ะทะฐะดะฐัะธ)
  โ
  โ  โโโโโโโ
  โ  โ  D  โ  โ ะัะฑัะฐะฝะฝะฐั ะทะฐะดะฐัะฐ ะฟะพะฒะตัั ะพััะฐะปัะฝัั
  โ  โโโโโโโ
```

**ะะปะพัะบะพััั X-Y (ะบะพะพัะดะธะฝะฐัั):**
```
Y=0
  โ
  โ  X=0    X=300    X=600    X=900
  โ   โ       โ        โ        โ
Y=200โ   โโโโโโผโโโโโโโโโผโโโโโโโโโผโโโ
     โ   โ    โ  Task Aโ        โ
     โ   โ    โ (300,200)       โ
Y=400โ   โ    โ        โ  Task Bโ
     โ   โ    โ        โ (600,400)โ
     โ   โ    โ        โ        โ
Y=600โ   โโโโโโผโโโโโโโโโผโโโโโโโโโผโโโ
     โ        โ        โ        โ
```

---

### ะะพะปะฝัะน ะฟัะธะผะตั ัะฐะทะผะตัะตะฝะธั ะธ ัะพะตะดะธะฝะตะฝะธั

#### ะััะพะดะฝัะต ะดะฐะฝะฝัะต

```
ะะฐะฝะฒะฐั:
  ะะฐะทะผะตั: 5000x5000px
  ะกะตัะบะฐ: 20px
  ะะฐัััะฐะฑ: 1.0
  ะกะผะตัะตะฝะธะต: (0, 0)

ะะฐะดะฐัะฐ A (ัะพะดะธัะตะปั):
  id: "task-a"
  position_x: 400
  position_y: 200
  width: 224
  height: 150
  parent_id: null

ะะฐะดะฐัะฐ B (ะฟะพัะพะผะพะบ A):
  id: "task-b"
  position_x: 400
  position_y: 360
  width: 224
  height: 120
  parent_id: "task-a"

ะะฐะดะฐัะฐ C (ะฟะพัะพะผะพะบ B):
  id: "task-c"
  position_x: 400
  position_y: 500
  width: 224
  height: 100
  parent_id: "task-b"
```

---

#### ะจะฐะณ 1: ะะตะพะผะตััะธั ะทะฐะดะฐัะธ A

**ะัะฐะฝะธัั ะบะฐััะพัะบะธ:**
```
ะะตะฒัะน ะฒะตััะฝะธะน:    (400, 200)
ะัะฐะฒัะน ะฒะตััะฝะธะน:   (624, 200)
ะะตะฒัะน ะฝะธะถะฝะธะน:     (400, 350)
ะัะฐะฒัะน ะฝะธะถะฝะธะน:    (624, 350)
ะฆะตะฝัั:            (512, 275)
```

**ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั (ะบะฐะบ ัะพะดะธัะตะปั):**
```
startX_A = 400 + 112 = 512
startY_A = 200 + 150 = 350
ะขะพัะบะฐ: (512, 350)
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
ะะฐะฝะฒะฐั (0, 0)
  โ
  โ     (400, 200) โโโโโโโโโโโโ (624, 200)
  โ     โ                        โ
  โ     โ   ะะฐะดะฐัะฐ A             โ
  โ     โ   width: 224           โ
  โ     โ   height: 150          โ
  โ     โ                        โ
  โ     โ                        โ
  โ     (400, 350) โโโโโโโโโโโโ (624, 350)
  โ              โ
  โ         (512, 350) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั
  โ              โ
```

---

#### ะจะฐะณ 2: ะะตะพะผะตััะธั ะทะฐะดะฐัะธ B

**ะัะฐะฝะธัั ะบะฐััะพัะบะธ:**
```
ะะตะฒัะน ะฒะตััะฝะธะน:    (400, 360)
ะัะฐะฒัะน ะฒะตััะฝะธะน:   (624, 360)
ะะตะฒัะน ะฝะธะถะฝะธะน:     (400, 480)
ะัะฐะฒัะน ะฝะธะถะฝะธะน:    (624, 480)
ะฆะตะฝัั:            (512, 420)
```

**ะขะพัะบะธ ัะพะตะดะธะฝะตะฝะธั:**
```
ะะฐะบ ะฟะพัะพะผะพะบ A:
  endX_B = 400 + 112 = 512
  endY_B = 360
  ะขะพัะบะฐ: (512, 360)

ะะฐะบ ัะพะดะธัะตะปั C:
  startX_B = 400 + 112 = 512
  startY_B = 360 + 120 = 480
  ะขะพัะบะฐ: (512, 480)
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
         (512, 360) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั (ะบะฐะบ ะฟะพัะพะผะพะบ)
              โ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ B           โ  (400, 360)
โ   height: 120        โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
    (512, 480) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั (ะบะฐะบ ัะพะดะธัะตะปั)
```

---

#### ะจะฐะณ 3: ะะตะพะผะตััะธั ะทะฐะดะฐัะธ C

**ะัะฐะฝะธัั ะบะฐััะพัะบะธ:**
```
ะะตะฒัะน ะฒะตััะฝะธะน:    (400, 500)
ะัะฐะฒัะน ะฒะตััะฝะธะน:   (624, 500)
ะะตะฒัะน ะฝะธะถะฝะธะน:     (400, 600)
ะัะฐะฒัะน ะฝะธะถะฝะธะน:    (624, 600)
ะฆะตะฝัั:            (512, 550)
```

**ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั (ะบะฐะบ ะฟะพัะพะผะพะบ):**
```
endX_C = 400 + 112 = 512
endY_C = 500
ะขะพัะบะฐ: (512, 500)
```

---

#### ะจะฐะณ 4: ะกะพะตะดะธะฝะตะฝะธะต A โ B

**ะััะธัะปะตะฝะธะต:**
```
startX = 512
startY = 350

endX = 512
endY = 360

controlY = 350 + (360 - 350) / 2 = 355
```

**SVG Path:**
```
M 512 350 C 512 355, 512 355, 512 360
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ A           โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
    (512, 350)
         โ
    โโโโโโโโโ  (ะบะพัะพัะบะฐั ะบัะธะฒะฐั, 10px)
         โ
    (512, 360)
         โ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ B           โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

#### ะจะฐะณ 5: ะกะพะตะดะธะฝะตะฝะธะต B โ C

**ะััะธัะปะตะฝะธะต:**
```
startX = 512
startY = 480

endX = 512
endY = 500

controlY = 480 + (500 - 480) / 2 = 490
```

**SVG Path:**
```
M 512 480 C 512 490, 512 490, 512 500
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ B           โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
    (512, 480)
         โ
    โโโโโโโโโ  (ะบัะธะฒะฐั, 20px)
         โ
    (512, 500)
         โ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ C           โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

#### ะจะฐะณ 6: ะะพะปะฝะฐั ะฒะธะทัะฐะปะธะทะฐัะธั

**ะัะพะณะพะฒะฐั ะบะฐััะธะฝะฐ:**
```
ะะฐะฝะฒะฐั (5000x5000)
  โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ     โ   ะะฐะดะฐัะฐ A           โ  (400, 200)
  โ     โ   height: 150        โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ              โ
  โ         (512, 350) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั
  โ              โ
  โ      โโโโโโโโโโโโโโโโ  ะกะพะตะดะธะฝะตะฝะธะต 1
  โ              โ
  โ         (512, 360) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั
  โ              โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ     โ   ะะฐะดะฐัะฐ B           โ  (400, 360)
  โ     โ   height: 120        โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ              โ
  โ         (512, 480) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั
  โ              โ
  โ      โโโโโโโโโโโโโโโโ  ะกะพะตะดะธะฝะตะฝะธะต 2
  โ              โ
  โ         (512, 500) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั
  โ              โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ     โ   ะะฐะดะฐัะฐ C           โ  (400, 500)
  โ     โ   height: 100        โ
  โ     โโโโโโโโโโโโโโโโโโโโโโโ
  โ
```

**ะัะต ะบะพะพัะดะธะฝะฐัั ะฒ ะตะดะธะฝะพะผ ะฟัะพัััะฐะฝััะฒะต:**
- ะะฐะดะฐัะฐ A: `(400, 200)` โ `(624, 350)`
- ะกะพะตะดะธะฝะตะฝะธะต 1: `(512, 350)` โ `(512, 360)`
- ะะฐะดะฐัะฐ B: `(400, 360)` โ `(624, 480)`
- ะกะพะตะดะธะฝะตะฝะธะต 2: `(512, 480)` โ `(512, 500)`
- ะะฐะดะฐัะฐ C: `(400, 500)` โ `(624, 600)`

---

### ะะปะธัะฝะธะต ััะฐะฝััะพัะผะฐัะธะน ะบะฐะฝะฒะฐัะฐ

#### ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต

**ะขัะฐะฝััะพัะผะฐัะธั:**
```typescript
transform: `scale(${scale})`
```

**ะะปะธัะฝะธะต ะฝะฐ ะบะพะพัะดะธะฝะฐัั:**
- ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั ะะ ะธะทะผะตะฝััััั
- ะะธะทัะฐะปัะฝัะน ัะฐะทะผะตั ะธะทะผะตะฝัะตััั
- ะกะพะตะดะธะฝะตะฝะธั ะผะฐัััะฐะฑะธัััััั ะฟัะพะฟะพััะธะพะฝะฐะปัะฝะพ

**ะัะธะผะตั ะฟัะธ scale = 0.5:**
```
ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั:
  ะะฐะดะฐัะฐ: (400, 200)
  ะกะพะตะดะธะฝะตะฝะธะต: (512, 350) โ (512, 360)

ะะธะทัะฐะปัะฝะพ (ะฟะพัะปะต scale 0.5):
  ะะฐะดะฐัะฐ ะฒะธะทัะฐะปัะฝะพ ะฒ: (200, 100)
  ะกะพะตะดะธะฝะตะฝะธะต ะฒะธะทัะฐะปัะฝะพ: (256, 175) โ (256, 180)
  ะะฐะทะผะตัั ะฒะธะทัะฐะปัะฝะพ ัะผะตะฝััะตะฝั ะฒ 2 ัะฐะทะฐ
```

---

#### ะะฐะฝะพัะฐะผะธัะพะฒะฐะฝะธะต

**ะขัะฐะฝััะพัะผะฐัะธั:**
```typescript
transform: `translate(${offset.x}px, ${offset.y}px)`
```

**ะะปะธัะฝะธะต:**
- ะัะต ัะปะตะผะตะฝัั ัะผะตัะฐัััั ะฒะผะตััะต
- ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั ะฝะต ะธะทะผะตะฝััััั
- ะะธะทัะฐะปัะฝะฐั ะฟะพะทะธัะธั = ะฐะฑัะพะปััะฝะฐั + offset

**ะัะธะผะตั:**
```
offset = (200, 100)

ะะฑัะพะปััะฝัะต ะบะพะพัะดะธะฝะฐัั:
  ะะฐะดะฐัะฐ: (400, 200)
  ะกะพะตะดะธะฝะตะฝะธะต: (512, 350) โ (512, 360)

ะะธะทัะฐะปัะฝะฐั ะฟะพะทะธัะธั:
  ะะฐะดะฐัะฐ: (600, 300)
  ะกะพะตะดะธะฝะตะฝะธะต: (712, 450) โ (712, 460)
```

---

### ะะฟัะธะผะธะทะฐัะธั ัะฐะทะผะตัะตะฝะธั

#### ะญััะตะบัะธะฒะฝะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟัะพัััะฐะฝััะฒะฐ

**ะะตะบะพะผะตะฝะดะฐัะธะธ:**
1. **ะะตััะธะบะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต:** ะะพัะพะผะบะธ ะฟะพะด ัะพะดะธัะตะปัะผะธ
2. **ะะพัะธะทะพะฝัะฐะปัะฝะพะต ัะฐะทะผะตัะตะฝะธะต:** ะัะฐััะบะธะต ะทะฐะดะฐัะธ ััะดะพะผ
3. **ะะธะฝะธะผะฐะปัะฝัะต ะพััััะฟั:** 20px (1 ััะตะนะบะฐ ัะตัะบะธ)
4. **ะััะฟะฟะธัะพะฒะบะฐ:** ะกะฒัะทะฐะฝะฝัะต ะทะฐะดะฐัะธ ะฑะปะธะทะบะพ ะดััะณ ะบ ะดััะณั

**ะัะธะผะตั ะพะฟัะธะผะฐะปัะฝะพะณะพ ัะฐะทะผะตัะตะฝะธั:**
```
โโโโโโโ     โโโโโโโ     โโโโโโโ
โ  A  โ     โ  B  โ     โ  C  โ  (ะฑัะฐััะบะธะต, ะณะพัะธะทะพะฝัะฐะปัะฝะพ)
โโโโโโโ     โโโโโโโ     โโโโโโโ
  โ           โ           โ
  โ           โ           โ
โโโโโโโ     โโโโโโโ     โโโโโโโ
โ  D  โ     โ  E  โ     โ  F  โ  (ะฟะพัะพะผะบะธ, ะฒะตััะธะบะฐะปัะฝะพ)
โโโโโโโ     โโโโโโโ     โโโโโโโ
```

**ะะพะพัะดะธะฝะฐัั:**
```
A: (100, 100)
B: (344, 100)  // 100 + 224 + 20
C: (588, 100)  // 344 + 224 + 20

D: (100, 250)  // 100 + 150 (ะพััััะฟ)
E: (344, 250)
F: (588, 250)
```

---

## ะะฝัะตะณัะฐัะธั ั ะบะฐะฝะฒะฐัะพะผ

### ะะฐะทะผะตัะตะฝะธะต SVG ัะปะตะผะตะฝัะฐ

**ะกัััะบัััะฐ:**
```tsx
<div
  data-canvas-content
  className="relative"
  style={{
    transform: `translate(${offset.x}px, ${offset.y}px) scale(${scale})`,
    transformOrigin: "0 0",
    width: `${CANVAS_WIDTH}px`,
    height: `${CANVAS_HEIGHT}px`,
  }}
>
  {/* SVG ะดะปั ัะพะตะดะธะฝะตะฝะธะน */}
  <svg
    className="pointer-events-none absolute left-0 top-0"
    style={{
      width: `${CANVAS_WIDTH}px`,
      height: `${CANVAS_HEIGHT}px`,
      overflow: "visible",
      zIndex: 1,
    }}
  >
    {drawTaskConnections()}
  </svg>

  {/* ะะฐะดะฐัะธ */}
  <div className="relative" style={{ zIndex: 10 }}>
    {tasks.map(task => <TaskNode key={task.id} task={task} />)}
  </div>
</div>
```

**ะัะพะฑะตะฝะฝะพััะธ:**
- SVG ะฝะฐัะพะดะธััั ะฒะฝัััะธ `data-canvas-content`
- ะัะธะผะตะฝััััั ัะต ะถะต ััะฐะฝััะพัะผะฐัะธะธ (translate, scale)
- ะกะพะตะดะธะฝะตะฝะธั ะผะฐัััะฐะฑะธัััััั ะฒะผะตััะต ั ะทะฐะดะฐัะฐะผะธ

---

### ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต ัะพะตะดะธะฝะตะฝะธะน

**ะขัะฐะฝััะพัะผะฐัะธั ะบะฐะฝะฒะฐัะฐ:**
```typescript
transform: `translate(${offset.x}px, ${offset.y}px) scale(${scale})`
```

**ะะปะธัะฝะธะต ะฝะฐ ัะพะตะดะธะฝะตะฝะธั:**
- ะะพะพัะดะธะฝะฐัั ะฒ SVG ัะถะต ะฒ ะฟัะพัััะฐะฝััะฒะต ะบะฐะฝะฒะฐัะฐ
- ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต ะฟัะธะผะตะฝัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะตะท CSS transform
- ะะธะฝะธะธ ะธ ัะพัะบะธ ะผะฐัััะฐะฑะธัััััั ะฟัะพะฟะพััะธะพะฝะฐะปัะฝะพ

**ะัะธะผะตั:**
- ะัะธ `scale = 0.5` (50%):
  - ะะธะฝะธั ััะฐะฝะพะฒะธััั ัะพะฝััะต ะฒะธะทัะฐะปัะฝะพ
  - ะขะพัะบะธ ััะฐะฝะพะฒัััั ะผะตะฝััะต
  - ะะพะพัะดะธะฝะฐัั ะพััะฐัััั ัะตะผะธ ะถะต

---

### ะะฐะฝะพัะฐะผะธัะพะฒะฐะฝะธะต ัะพะตะดะธะฝะตะฝะธะน

**ะขัะฐะฝััะพัะผะฐัะธั ะบะฐะฝะฒะฐัะฐ:**
```typescript
transform: `translate(${offset.x}px, ${offset.y}px) scale(${scale})`
```

**ะะปะธัะฝะธะต ะฝะฐ ัะพะตะดะธะฝะตะฝะธั:**
- ะกะผะตัะตะฝะธะต `offset` ะฟัะธะผะตะฝัะตััั ะบะพ ะฒัะตะผั ะบะฐะฝะฒะฐัั
- ะกะพะตะดะธะฝะตะฝะธั ะดะฒะธะณะฐัััั ะฒะผะตััะต ั ะทะฐะดะฐัะฐะผะธ
- ะะธะทัะฐะปัะฝะพ ัะพะตะดะธะฝะตะฝะธั ะฒัะตะณะดะฐ ะพััะฐัััั ะฝะฐ ัะฒะพะธั ะผะตััะฐั

---

### ะะตัะฐะปัะฝะฐั ะฒะธะทัะฐะปัะฝะฐั ััะตะผะฐ ัะฐะทะผะตัะตะฝะธั ะธ ัะพะตะดะธะฝะตะฝะธั

#### ะะพะปะฝะฐั ััะตะผะฐ ะพะดะฝะพะน ัะฒัะทะธ

```
                    ะะะะะะก (5000x5000px)
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ                                                      โ
    โ  ะะพะพัะดะธะฝะฐัะฝะฐั ัะธััะตะผะฐ:                              โ
    โ  X: 0 โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ 5000        โ
    โ  Y: 0                                                โ
    โ    โ                                                โ
    โ    โ                                                โ
    โ    โ                                                โ
    โ   5000                                              โ
    โ                                                      โ
    โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
    โ  โ  ะะะะะขะะะฌะกะะะฏ ะะะะะงะ                         โ  โ
    โ  โ                                               โ  โ
    โ  โ  ะะตะพะผะตััะธั:                                   โ  โ
    โ  โ    ะะตะฒัะน ะฒะตััะฝะธะน: (300, 200)                 โ  โ
    โ  โ    ะัะฐะฒัะน ะฒะตััะฝะธะน: (524, 200)                 โ  โ
    โ  โ    ะะตะฒัะน ะฝะธะถะฝะธะน: (300, 350)                   โ  โ
    โ  โ    ะัะฐะฒัะน ะฝะธะถะฝะธะน: (524, 350)                  โ  โ
    โ  โ    ะฆะตะฝัั: (412, 275)                          โ  โ
    โ  โ                                               โ  โ
    โ  โ  ะะฐะทะผะตัั:                                      โ  โ
    โ  โ    width: 224px                                โ  โ
    โ  โ    height: 150px                               โ  โ
    โ  โ                                               โ  โ
    โ  โ  ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั (ะฝะธะถะฝะธะน ัะตะฝัั):             โ  โ
    โ  โ    X = 300 + 224/2 = 412                      โ  โ
    โ  โ    Y = 200 + 150 = 350                        โ  โ
    โ  โ    ะะพะพัะดะธะฝะฐัั: (412, 350)                     โ  โ
    โ  โ    ะะธะทัะฐะปัะฝะพ: ะบััะณ r=4px                      โ  โ
    โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
    โ            โ                                        โ
    โ            โ  ะกะพะตะดะธะฝะตะฝะธะต (ะบัะธะฒะฐั ะะตะทัะต)            โ
    โ            โ  ะะฐัะฐะปะพ: (412, 350)                   โ
    โ            โ  ะะพะฝะตั: (412, 400)                    โ
    โ            โ  ะะพะฝััะพะปัะฝัะต: (412, 375), (412, 375) โ
    โ            โ  Path: M 412 350 C 412 375, 412 375, 412 400
    โ            โ                                        โ
    โ            โ                                        โ
    โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
    โ  โ  ะะะงะะะะฏะฏ ะะะะะงะ                              โ  โ
    โ  โ                                               โ  โ
    โ  โ  ะะตะพะผะตััะธั:                                   โ  โ
    โ  โ    ะะตะฒัะน ะฒะตััะฝะธะน: (300, 400)                 โ  โ
    โ  โ    ะัะฐะฒัะน ะฒะตััะฝะธะน: (524, 400)                โ  โ
    โ  โ    ะะตะฒัะน ะฝะธะถะฝะธะน: (300, 520)                   โ  โ
    โ  โ    ะัะฐะฒัะน ะฝะธะถะฝะธะน: (524, 520)                  โ  โ
    โ  โ    ะฆะตะฝัั: (412, 460)                          โ  โ
    โ  โ                                               โ  โ
    โ  โ  ะะฐะทะผะตัั:                                      โ  โ
    โ  โ    width: 224px                                โ  โ
    โ  โ    height: 120px                               โ  โ
    โ  โ                                               โ  โ
    โ  โ  ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั (ะฒะตััะฝะธะน ัะตะฝัั):             โ  โ
    โ  โ    X = 300 + 224/2 = 412                      โ  โ
    โ  โ    Y = 400                                     โ  โ
    โ  โ    ะะพะพัะดะธะฝะฐัั: (412, 400)                     โ  โ
    โ  โ    ะะธะทัะฐะปัะฝะพ: ะบััะณ r=4px                      โ  โ
    โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
    โ                                                      โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

#### ะะตัะฐะปัะฝะฐั ััะตะผะฐ ะบะพะพัะดะธะฝะฐั

**ะะพะดะธัะตะปััะบะฐั ะทะฐะดะฐัะฐ:**
```
ะะพะพัะดะธะฝะฐัั ะบะฐััะพัะบะธ:
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  โ (300, 200)                    (524, 200) โ
  โ                                         โ
  โ                                         โ
  โ                                         โ
  โ                                         โ
  โ (300, 350)                    (524, 350) โ
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
            โ
            โ ะฆะตะฝัั ะฟะพ X: 300 + 112 = 412
            โ
            โ
      (412, 350) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั
```

**ะะพัะตัะฝัั ะทะฐะดะฐัะฐ:**
```
      (412, 400) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั
            โ
            โ ะฆะตะฝัั ะฟะพ X: 300 + 112 = 412
            โ
            โ
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  โ (300, 400)                    (524, 400) โ
  โ                                         โ
  โ                                         โ
  โ                                         โ
  โ (300, 520)                    (524, 520) โ
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะกะพะตะดะธะฝะตะฝะธะต:**
```
(412, 350) โ ะะฐัะฐะปัะฝะฐั ัะพัะบะฐ
    โ
    โ  ะะตััะธะบะฐะปัะฝะพะต ัะฐัััะพัะฝะธะต: 400 - 350 = 50px
    โ
    โ  ะะพะฝััะพะปัะฝะฐั ัะพัะบะฐ Y: 350 + 50/2 = 375
    โ
    โ  ะัะธะฒะฐั: M 412 350 C 412 375, 412 375, 412 400
    โ
    โ
(412, 400) โ ะะพะฝะตัะฝะฐั ัะพัะบะฐ
```

---

#### ะกัะตะผะฐ ั ัะธัะปะพะฒัะผะธ ะทะฝะฐัะตะฝะธัะผะธ

**ะะพะปะฝัะน ัะฐััะตั ะดะปั ะฟัะธะผะตัะฐ:**

```
ะะกะฅะะะะซะ ะะะะะซะ:
โโโโโโโโโโโโโโโโโ
ะะพะดะธัะตะปั:
  position_x = 300
  position_y = 200
  width = 224
  height = 150

ะะพัะพะผะพะบ:
  position_x = 300
  position_y = 400
  width = 224
  height = 120

ะะซะงะะกะะะะะ ะขะะงะะ:
โโโโโโโโโโโโโโโโโ
ะะฐัะฐะปัะฝะฐั ัะพัะบะฐ (ัะพะดะธัะตะปั):
  startX = 300 + (224 / 2) = 300 + 112 = 412
  startY = 200 + 150 = 350
  ะะตะทัะปััะฐั: (412, 350)

ะะพะฝะตัะฝะฐั ัะพัะบะฐ (ะฟะพัะพะผะพะบ):
  endX = 300 + (224 / 2) = 300 + 112 = 412
  endY = 400
  ะะตะทัะปััะฐั: (412, 400)

ะะพะฝััะพะปัะฝัะต ัะพัะบะธ:
  controlY = 350 + (400 - 350) / 2 = 350 + 25 = 375
  ะะตัะฒะฐั ะบะพะฝััะพะปัะฝะฐั: (412, 375)
  ะัะพัะฐั ะบะพะฝััะพะปัะฝะฐั: (412, 375)

ะะะะะะฏ ะะะะฌะ:
โโโโโโโโโโโโโ
Path: M 412 350 C 412 375, 412 375, 412 400

ะะะะฃะะะะะะฆะะฏ:
โโโโโโโโโโโโโโ
     (412, 350) โ ะะพะดะธัะตะปั
          โ
          โ 50px
          โ
     (412, 375) โ ะะพะฝััะพะปัะฝะฐั ัะพัะบะฐ
          โ
          โ
     (412, 400) โ ะะพัะพะผะพะบ
```

---

### ะะฐะทะผะตัะตะฝะธะต ะบะฐะบ ัะตะปัะฝัะน ะฟัะพัะตัั

#### ะะพะปะฝัะน ัะธะบะป: ะพั ัะพะทะดะฐะฝะธั ะดะพ ะพััะธัะพะฒะบะธ

**ะญัะฐะฟ 1: ะะพะปัะทะพะฒะฐัะตะปั ัะพะทะดะฐะตั ัะพะดะธัะตะปััะบัั ะทะฐะดะฐัั**

```
ะะตะนััะฒะธะต: ะะฒะพะนะฝะพะน ะบะปะธะบ ะฝะฐ ะบะฐะฝะฒะฐัะต
  โ
ะััะธัะปะตะฝะธะต ะบะพะพัะดะธะฝะฐั ะบะปะธะบะฐ:
  screenX = 600, screenY = 300
  offset = (200, 100)
  scale = 1.0
  
  canvasX = (600 - 200 - 200) / 1.0 = 200
  canvasY = (300 - 100 - 100) / 1.0 = 100
  โ
ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต:
  snappedX = snapToGrid(200) = 200
  snappedY = snapToGrid(100) = 100
  โ
ะกะพะทะดะฐะฝะธะต ะทะฐะดะฐัะธ:
  insert({
    position_x: 200,
    position_y: 100,
    parent_id: null
  })
  โ
ะััะธัะพะฒะบะฐ ะฝะฐ ะบะฐะฝะฒะฐัะต:
  <div style={{ left: 200, top: 100 }}>
    {/* ะะฐััะพัะบะฐ ะทะฐะดะฐัะธ */}
  </div>
```

---

**ะญัะฐะฟ 2: ะะพะปัะทะพะฒะฐัะตะปั ัะพะทะดะฐะตั ะดะพัะตัะฝัั ะทะฐะดะฐัั**

```
ะะตะนััะฒะธะต: ะัะฐะฒัะน ะบะปะธะบ ะฝะฐ ัะพะดะธัะตะปะต โ "ะกะพะทะดะฐัั ัะฒัะทะฐะฝะฝัั ะทะฐะดะฐัั"
  โ
ะััะธัะปะตะฝะธะต ะฟะพะทะธัะธะธ:
  parent.position_x = 200
  parent.position_y = 100
  
  childX = 200  (ัะฐ ะถะต X)
  childY = 100 + 150 = 250  (ะฝะฐ 150px ะฝะธะถะต)
  โ
ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต:
  snappedX = snapToGrid(200) = 200
  snappedY = snapToGrid(250) = 240
  โ
ะกะพะทะดะฐะฝะธะต ะทะฐะดะฐัะธ:
  insert({
    position_x: 200,
    position_y: 240,
    parent_id: "task-a"  // โ ะกะฒัะทั ัะพะทะดะฐะตััั
  })
  โ
ะััะธัะพะฒะบะฐ ะฝะฐ ะบะฐะฝะฒะฐัะต:
  <div style={{ left: 200, top: 240 }}>
    {/* ะะฐััะพัะบะฐ ะทะฐะดะฐัะธ */}
  </div>
  โ
ะะฒัะพะผะฐัะธัะตัะบะพะต ะฒััะธัะปะตะฝะธะต ัะพะตะดะธะฝะตะฝะธั:
  drawTaskConnections() ะฒัะทัะฒะฐะตััั ะฟัะธ ัะตะฝะดะตัะต
```

---

**ะญัะฐะฟ 3: ะะฒัะพะผะฐัะธัะตัะบะพะต ัะพะทะดะฐะฝะธะต ัะพะตะดะธะฝะตะฝะธั**

```
ะขัะธะณะณะตั: ะะตะฝะดะตั ะบะพะผะฟะพะฝะตะฝัะฐ TaskBoard
  โ
ะคัะฝะบัะธั drawTaskConnections():
  1. ะคะธะปัััะฐัะธั: tasks.filter(t => t.parent_id)
     โ ะะฐะนะดะตะฝะฐ ะทะฐะดะฐัะฐ ั parent_id = "task-a"
  2. ะะพะธัะบ ัะพะดะธัะตะปั: tasks.find(t => t.id === "task-a")
     โ ะะฐะนะดะตะฝ ัะพะดะธัะตะปั
  3. ะััะธัะปะตะฝะธะต ะบะพะพัะดะธะฝะฐั:
     startX = 200 + 112 = 312
     startY = 100 + 150 = 250
     endX = 200 + 112 = 312
     endY = 240
  4. ะััะธัะปะตะฝะธะต ะบะพะฝััะพะปัะฝัั ัะพัะตะบ:
     controlY = 250 + (240 - 250) / 2 = 245
  5. ะคะพัะผะธัะพะฒะฐะฝะธะต ะฟััะธ:
     path = "M 312 250 C 312 245, 312 245, 312 240"
  6. ะกะพะทะดะฐะฝะธะต SVG ัะปะตะผะตะฝัะพะฒ:
     <path d={path} />
     <circle cx={312} cy={250} />
     <circle cx={312} cy={240} />
  โ
ะััะธัะพะฒะบะฐ ัะพะตะดะธะฝะตะฝะธั:
  <svg>
    {drawTaskConnections()}
  </svg>
```

---

**ะญัะฐะฟ 4: ะะธะทัะฐะปะธะทะฐัะธั ะฝะฐ ัะบัะฐะฝะต**

```
ะญะบัะฐะฝ ะฟะพะปัะทะพะฒะฐัะตะปั:
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  โ  ะะฐะฝะฒะฐั (ะฒะธะดะธะผะฐั ะพะฑะปะฐััั)           โ
  โ                                     โ
  โ  โโโโโโโโโโโโโโโโโโโโโโโ            โ
  โ  โ   ะะฐะดะฐัะฐ A           โ            โ
  โ  โ   (200, 100)         โ            โ
  โ  โ                      โ            โ
  โ  โโโโโโโโโโโโโโโโโโโโโโโ            โ
  โ            โ                        โ
  โ      (312, 250) โ                   โ
  โ            โ                        โ
  โ      โโโโโโโโโโโโ  (ะบัะธะฒะฐั)         โ
  โ            โ                        โ
  โ      (312, 240) โ                   โ
  โ            โ                        โ
  โ  โโโโโโโโโโโโโโโโโโโโโโโ            โ
  โ  โ   ะะฐะดะฐัะฐ B           โ            โ
  โ  โ   (200, 240)         โ            โ
  โ  โโโโโโโโโโโโโโโโโโโโโโโ            โ
  โ                                     โ
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### ะะฐัะตะผะฐัะธัะตัะบะฐั ะผะพะดะตะปั ัะตะปัะฝะพะน ัะธััะตะผั

#### ะกะธััะตะผะฐ ััะฐะฒะฝะตะฝะธะน ัะฐะทะผะตัะตะฝะธั

**ะฃัะฐะฒะฝะตะฝะธะต 1: ะะพะทะธัะธั ะทะฐะดะฐัะธ**
```
task.position_x = snapToGrid(raw_x)
task.position_y = snapToGrid(raw_y)
```

**ะฃัะฐะฒะฝะตะฝะธะต 2: ะัะฐะฝะธัั ะบะฐััะพัะบะธ**
```
left = task.position_x
top = task.position_y
right = task.position_x + cardWidth
bottom = task.position_y + cardHeight
centerX = task.position_x + (cardWidth / 2)
```

**ะฃัะฐะฒะฝะตะฝะธะต 3: ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั (ัะพะดะธัะตะปั)**
```
startX = parent.position_x + (parentWidth / 2)
startY = parent.position_y + parentHeight
```

**ะฃัะฐะฒะฝะตะฝะธะต 4: ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั (ะฟะพัะพะผะพะบ)**
```
endX = child.position_x + (childWidth / 2)
endY = child.position_y
```

**ะฃัะฐะฒะฝะตะฝะธะต 5: ะะพะฝััะพะปัะฝัะต ัะพัะบะธ**
```
controlY = startY + (endY - startY) / 2
```

**ะฃัะฐะฒะฝะตะฝะธะต 6: ะัะธะฒะฐั ะะตะทัะต**
```
path = `M ${startX} ${startY} C ${startX} ${controlY}, ${endX} ${controlY}, ${endX} ${endY}`
```

**ะฃัะฐะฒะฝะตะฝะธะต 7: ะฃัะปะพะฒะธะต ัะฒัะทะธ**
```
child.parent_id === parent.id
```

---

#### ะะพะปะฝัะน ัะฐััะตั ะดะปั ะฟัะธะผะตัะฐ

**ะะฐะฝะพ:**
```
parent.position_x = 400
parent.position_y = 200
parentWidth = 224
parentHeight = 150

child.position_x = 400
child.position_y = 360
childWidth = 224
```

**ะะตัะตะฝะธะต:**

**ะจะฐะณ 1: ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ัะพะดะธัะตะปั**
```
startX = 400 + (224 / 2) = 400 + 112 = 512
startY = 200 + 150 = 350
```

**ะจะฐะณ 2: ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ะฟะพัะพะผะบะฐ**
```
endX = 400 + (224 / 2) = 400 + 112 = 512
endY = 360
```

**ะจะฐะณ 3: ะะพะฝััะพะปัะฝัะต ัะพัะบะธ**
```
controlY = 350 + (360 - 350) / 2 = 350 + 5 = 355
```

**ะจะฐะณ 4: ะัะธะฒะฐั ะะตะทัะต**
```
path = "M 512 350 C 512 355, 512 355, 512 360"
```

**ะะตะทัะปััะฐั:**
```
ะะฐัะฐะปัะฝะฐั ัะพัะบะฐ: (512, 350)
ะะพะฝะตัะฝะฐั ัะพัะบะฐ:  (512, 360)
ะะพะฝััะพะปัะฝัะต:     (512, 355), (512, 355)
ะัะธะฒะฐั:          M 512 350 C 512 355, 512 355, 512 360
```

---

### ะะธะทัะฐะปัะฝะฐั ััะตะผะฐ ัะฐะทะผะตัะตะฝะธั ะผะฝะพะถะตััะฒะตะฝะฝัั ะทะฐะดะฐั

#### ะัะธะผะตั ั 5 ะทะฐะดะฐัะฐะผะธ

**ะกัััะบัััะฐ:**
```
Task A (ะบะพัะฝะตะฒะฐั)
  โโ Task B (ะฟะพัะพะผะพะบ A)
  โ   โโ Task C (ะฟะพัะพะผะพะบ B)
  โโ Task D (ะฟะพัะพะผะพะบ A)
      โโ Task E (ะฟะพัะพะผะพะบ D)
```

**ะะพะพัะดะธะฝะฐัั:**
```
Task A: (400, 100)
Task B: (300, 280)  // ะกะปะตะฒะฐ ะพั A
Task C: (300, 440)  // ะะพะด B
Task D: (500, 280)  // ะกะฟัะฐะฒะฐ ะพั A
Task E: (500, 440)  // ะะพะด D
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
         โโโโโโโโโโโโโโโโโโโโโโโ
         โ   Task A            โ  (400, 100)
         โ   (ะบะพัะฝะตะฒะฐั)        โ
         โโโโโโโโโโโโโโโโโโโโโโโ
              โ         โ
        โโโโโโโ         โโโโโโโ
        โ                      โ
        โ                      โ
โโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ
โ   Task B            โ  โ   Task D            โ
โ   (300, 280)        โ  โ   (500, 280)        โ
โโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ
        โ                      โ
        โ                      โ
โโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ
โ   Task C            โ  โ   Task E            โ
โ   (300, 440)        โ  โ   (500, 440)        โ
โโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ
```

**ะกะพะตะดะธะฝะตะฝะธั:**
```
1. A โ B: (512, 250) โ (412, 280)
2. B โ C: (412, 430) โ (412, 440)
3. A โ D: (512, 250) โ (612, 280)
4. D โ E: (612, 430) โ (612, 440)
```

---

### ะะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ัะฐะทะผะตัะตะฝะธั ะฟัะธ ัะฐะทะฝัั ััะตะฝะฐัะธัั

#### ะกัะตะฝะฐัะธะน 1: ะะตััะธะบะฐะปัะฝะพะต ะฒััะฐะฒะฝะธะฒะฐะฝะธะต

**ะฃัะปะพะฒะธะต:** `parent.position_x === child.position_x`

**ะะฐะทะผะตัะตะฝะธะต:**
```
ะะพะดะธัะตะปั: (400, 200)
ะะพัะพะผะพะบ:  (400, 360)  // ะขะฐ ะถะต X ะบะพะพัะดะธะฝะฐัะฐ
```

**ะกะพะตะดะธะฝะตะฝะธะต:**
```
startX = 400 + 112 = 512
endX = 400 + 112 = 512

ะะตะทัะปััะฐั: startX === endX
```

**ะัะธะฒะฐั:**
```
controlY = 350 + (360 - 350) / 2 = 355
path = "M 512 350 C 512 355, 512 355, 512 360"
```

**ะะธะทัะฐะปัะฝะพ:** ะะพััะธ ะฟััะผะฐั ะฒะตััะธะบะฐะปัะฝะฐั ะปะธะฝะธั

---

#### ะกัะตะฝะฐัะธะน 2: ะะพัะธะทะพะฝัะฐะปัะฝะพะต ัะผะตัะตะฝะธะต

**ะฃัะปะพะฒะธะต:** `parent.position_x !== child.position_x`

**ะะฐะทะผะตัะตะฝะธะต:**
```
ะะพะดะธัะตะปั: (300, 200)
ะะพัะพะผะพะบ:  (500, 360)  // ะกะผะตัะตะฝะธะต +200 ะฟะพ X
```

**ะกะพะตะดะธะฝะตะฝะธะต:**
```
startX = 300 + 112 = 412
endX = 500 + 112 = 612

ะะตะทัะปััะฐั: startX !== endX (ัะผะตัะตะฝะธะต 200px)
```

**ะัะธะฒะฐั:**
```
controlY = 350 + (360 - 350) / 2 = 355
path = "M 412 350 C 412 355, 612 355, 612 360"
```

**ะะธะทัะฐะปัะฝะพ:** S-ะพะฑัะฐะทะฝะฐั ะบัะธะฒะฐั ั ะณะพัะธะทะพะฝัะฐะปัะฝัะผ ัะผะตัะตะฝะธะตะผ

---

#### ะกัะตะฝะฐัะธะน 3: ะะพะปััะพะต ัะฐัััะพัะฝะธะต

**ะฃัะปะพะฒะธะต:** ะะฐะดะฐัะธ ะดะฐะปะตะบะพ ะดััะณ ะพั ะดััะณะฐ

**ะะฐะทะผะตัะตะฝะธะต:**
```
ะะพะดะธัะตะปั: (100, 100)
ะะพัะพะผะพะบ:  (1000, 800)  // ะัะตะฝั ะดะฐะปะตะบะพ
```

**ะกะพะตะดะธะฝะตะฝะธะต:**
```
startX = 100 + 112 = 212
startY = 100 + 150 = 250

endX = 1000 + 112 = 1112
endY = 800

controlY = 250 + (800 - 250) / 2 = 525
```

**ะัะธะฒะฐั:**
```
path = "M 212 250 C 212 525, 1112 525, 1112 800"
```

**ะะธะทัะฐะปัะฝะพ:** ะะปะธะฝะฝะฐั ะดะธะฐะณะพะฝะฐะปัะฝะฐั S-ะพะฑัะฐะทะฝะฐั ะบัะธะฒะฐั

---

### ะะปะธัะฝะธะต ัะพะดะตัะถะธะผะพะณะพ ะฝะฐ ัะฐะทะผะตัะตะฝะธะต ัะพะตะดะธะฝะตะฝะธะน

#### ะะทะผะตะฝะตะฝะธะต ะฒััะพัั ะบะฐััะพัะบะธ

**ะกัะตะฝะฐัะธะน:** ะะพะปัะทะพะฒะฐัะตะปั ะดะพะฑะฐะฒะปัะตั ัะพะดะตัะถะธะผะพะต ะฒ ัะพะดะธัะตะปััะบัั ะทะฐะดะฐัั

**ะะพ ะดะพะฑะฐะฒะปะตะฝะธั:**
```
parentHeight = 150
startY = 200 + 150 = 350
ะกะพะตะดะธะฝะตะฝะธะต: (512, 350) โ (512, 360)
```

**ะะพัะปะต ะดะพะฑะฐะฒะปะตะฝะธั:**
```
parentHeight = 250  // โ ะฃะฒะตะปะธัะธะปะฐัั ะฝะฐ 100px
startY = 200 + 250 = 450  // โ ะขะพัะบะฐ ะฟะตัะตะผะตััะธะปะฐัั ะฝะฐ 100px ะฒะฝะธะท
ะกะพะตะดะธะฝะตะฝะธะต: (512, 450) โ (512, 360)  // โ ะะฑะฝะพะฒะธะปะพัั ะฐะฒัะพะผะฐัะธัะตัะบะธ
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
ะะพ:
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ A           โ  height: 150
โโโโโโโโโโโโโโโโโโโโโโโ
         โ (350)
    [ัะพะตะดะธะฝะตะฝะธะต]

ะะพัะปะต:
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะดะฐัะฐ A           โ  height: 250
โ   [ัะพะดะตัะถะธะผะพะต]      โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ (450)  โ ะะตัะตะผะตััะธะปะพัั
    [ัะพะตะดะธะฝะตะฝะธะต]
```

---

### ะะพะปะฝะฐั ะธะฝัะตะณัะฐัะธั: ะทะฐะดะฐัะธ + ัะพะตะดะธะฝะตะฝะธั + ะบะฐะฝะฒะฐั

#### ะะดะธะฝะฐั ัะธััะตะผะฐ ะบะพะพัะดะธะฝะฐั

**ะกัะตะผะฐ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะะะะะก (5000x5000px)                           โ
โ  transform: translate(offset) scale(scale)      โ
โ                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  SVG ะกะะะ (z-index: 1)                    โ โ
โ  โ  {drawTaskConnections()}                   โ โ
โ  โ  ะกะพะตะดะธะฝะตะฝะธั ะพััะธัะพะฒัะฒะฐัััั ะทะดะตัั          โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  ะะะะะงะ ะกะะะ (z-index: 10/30)             โ โ
โ  โ  {tasks.map(task => <TaskNode />)}        โ โ
โ  โ  ะะฐะดะฐัะธ ะพััะธัะพะฒัะฒะฐัััั ะทะดะตัั               โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  ะกะะขะะ ะกะะะ (background)                  โ โ
โ  โ  ะะพะผะพะณะฐะตั ะฒััะฐะฒะฝะธะฒะฐะฝะธั                    โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะทะฐะธะผะพะดะตะนััะฒะธะต:**
1. ะกะตัะบะฐ ะฟะพะผะพะณะฐะตั ะฒััะฐะฒะฝะธะฒะฐะฝะธั ะทะฐะดะฐั
2. ะะฐะดะฐัะธ ัะฐะทะผะตัะฐัััั ะฒ ะฐะฑัะพะปััะฝัั ะบะพะพัะดะธะฝะฐัะฐั
3. ะกะพะตะดะธะฝะตะฝะธั ะฒััะธัะปััััั ะฝะฐ ะพัะฝะพะฒะต ะบะพะพัะดะธะฝะฐั ะทะฐะดะฐั
4. ะัะต ััะฐะฝััะพัะผะธััะตััั ะฒะผะตััะต (translate + scale)

---

#### ะะตัะฐะปัะฝะฐั ััะตะผะฐ ะบะพะพัะดะธะฝะฐัะฝะพะน ัะธััะตะผั

**ะัะพัััะฐะฝััะฒะพ ะบะฐะฝะฒะฐัะฐ:**
```
(0, 0) โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ (5000, 0)
  โ                                            โ
  โ                                            โ
  โ                                            โ
  โ         ะะธัััะฐะปัะฝะพะต ะฟัะพัััะฐะฝััะฒะพ           โ
  โ           5000 x 5000 ะฟะธะบัะตะปะตะน             โ
  โ                                            โ
  โ                                            โ
  โ                                            โ
(0, 5000) โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ (5000, 5000)
```

**ะะฐะทะผะตัะตะฝะธะต ะทะฐะดะฐัะธ:**
```
ะะฐะดะฐัะฐ ะฒ ะฟะพะทะธัะธะธ (400, 200):
  
  (400, 200) โโโโโโโโโโโโโโโโโโโโ (624, 200)
     โ                                โ
     โ      ะะฐััะพัะบะฐ ะทะฐะดะฐัะธ           โ
     โ      width: 224px              โ
     โ      height: 150px              โ
     โ                                โ
  (400, 350) โโโโโโโโโโโโโโโโโโโโ (624, 350)
```

**ะขะพัะบะธ ัะพะตะดะธะฝะตะฝะธั:**
```
ะะพะดะธัะตะปั:
  ะขะพัะบะฐ: (512, 350)  โ ะะธะถะฝะธะน ัะตะฝัั
  ะััะธัะปะตะฝะธะต: (400 + 112, 200 + 150)

ะะพัะพะผะพะบ:
  ะขะพัะบะฐ: (512, 400)  โ ะะตััะฝะธะน ัะตะฝัั
  ะััะธัะปะตะฝะธะต: (400 + 112, 400)
```

**ะกะพะตะดะธะฝะตะฝะธะต:**
```
ะัะธะฒะฐั ะพั (512, 350) ะดะพ (512, 400)
ะะพะฝััะพะปัะฝัะต ัะพัะบะธ: (512, 375), (512, 375)
Path: M 512 350 C 512 375, 512 375, 512 400
```

---

### ะะธะทัะฐะปัะฝะพะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ัะตะปัะฝะพะน ัะธััะตะผั

#### ะะพะปะฝะฐั ะบะฐััะธะฝะฐ ั ะบะพะพัะดะธะฝะฐัะฐะผะธ

```
                    ะะะะะะก (5000x5000)
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ                                                  โ
    โ  ะะพะพัะดะธะฝะฐัั:                                     โ
    โ  X: 0 โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ 5000   โ
    โ  Y: 0                                            โ
    โ    โ                                            โ
    โ    โ                                            โ
    โ    โ                                            โ
    โ   5000                                          โ
    โ                                                  โ
    โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
    โ  โ  ะะะะะขะะะฌ (400, 200)                      โ  โ
    โ  โ  โโโโโโโโโโโโโโโโโโโโโโโ                  โ  โ
    โ  โ  โ (400,200)    (624,200) โ              โ  โ
    โ  โ  โ                       โ                โ  โ
    โ  โ  โ    ะะฐััะพัะบะฐ ะทะฐะดะฐัะธ    โ                โ  โ
    โ  โ  โ    width: 224         โ                โ  โ
    โ  โ  โ    height: 150         โ                โ  โ
    โ  โ  โ                       โ                โ  โ
    โ  โ  โ (400,350)    (624,350) โ              โ  โ
    โ  โ  โโโโโโโโโโโโโโโโโโโโโโโ                  โ  โ
    โ  โ            โ                              โ  โ
    โ  โ       (512, 350) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั      โ  โ
    โ  โ            โ                              โ  โ
    โ  โ       โโโโโโโโโโโโ  ะกะพะตะดะธะฝะตะฝะธะต            โ  โ
    โ  โ            โ    (ะบัะธะฒะฐั ะะตะทัะต)           โ  โ
    โ  โ       (512, 375) โ ะะพะฝััะพะปัะฝะฐั ัะพัะบะฐ    โ  โ
    โ  โ            โ                              โ  โ
    โ  โ       โโโโโโโโโโโโ                        โ  โ
    โ  โ            โ                              โ  โ
    โ  โ       (512, 400) โ ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั      โ  โ
    โ  โ            โ                              โ  โ
    โ  โ  โโโโโโโโโโโโโโโโโโโโโโโ                  โ  โ
    โ  โ  โ (400,400)    (624,400) โ              โ  โ
    โ  โ  โ                       โ                โ  โ
    โ  โ  โ    ะะฐััะพัะบะฐ ะทะฐะดะฐัะธ    โ                โ  โ
    โ  โ  โ    width: 224         โ                โ  โ
    โ  โ  โ    height: 120         โ                โ  โ
    โ  โ  โ                       โ                โ  โ
    โ  โ  โ (400,520)    (624,520) โ              โ  โ
    โ  โ  โโโโโโโโโโโโโโโโโโโโโโโ                  โ  โ
    โ  โ  ะะะขะะะะ (400, 400)                      โ  โ
    โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
    โ                                                  โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### ะะฐัะตะผะฐัะธัะตัะบะธะต ัะพัะผัะปั ัะฐะทะผะตัะตะฝะธั

#### ะะพะปะฝะฐั ัะธััะตะผะฐ ััะฐะฒะฝะตะฝะธะน

**ะฃัะฐะฒะฝะตะฝะธะต ัะฐะทะผะตัะตะฝะธั ะทะฐะดะฐัะธ:**
```
task.position_x = snapToGrid(raw_x)
task.position_y = snapToGrid(raw_y)

ะณะดะต:
  snapToGrid(v) = round(v / GRID_SIZE) * GRID_SIZE
  GRID_SIZE = 20
```

**ะฃัะฐะฒะฝะตะฝะธะต ะณัะฐะฝะธั ะบะฐััะพัะบะธ:**
```
left = position_x
top = position_y
right = position_x + CARD_WIDTH
bottom = position_y + CARD_HEIGHT
centerX = position_x + (CARD_WIDTH / 2)
centerY = position_y + (CARD_HEIGHT / 2)
```

**ะฃัะฐะฒะฝะตะฝะธะต ัะพัะบะธ ัะพะตะดะธะฝะตะฝะธั ัะพะดะธัะตะปั:**
```
startX = parent.position_x + (CARD_WIDTH / 2)
startY = parent.position_y + parentHeight

ะณะดะต:
  CARD_WIDTH = 224
  parentHeight = taskHeights[parent.id] || 150
```

**ะฃัะฐะฒะฝะตะฝะธะต ัะพัะบะธ ัะพะตะดะธะฝะตะฝะธั ะฟะพัะพะผะบะฐ:**
```
endX = child.position_x + (CARD_WIDTH / 2)
endY = child.position_y
```

**ะฃัะฐะฒะฝะตะฝะธะต ะบะพะฝััะพะปัะฝัั ัะพัะตะบ:**
```
controlY = startY + (endY - startY) / 2
         = (startY + endY) / 2
```

**ะฃัะฐะฒะฝะตะฝะธะต ะบัะธะฒะพะน ะะตะทัะต:**
```
path = `M ${startX} ${startY} C ${startX} ${controlY}, ${endX} ${controlY}, ${endX} ${endY}`
```

---

### ะัะธะผะตั ะฟะพะปะฝะพะณะพ ัะฐััะตัะฐ

**ะััะพะดะฝัะต ะดะฐะฝะฝัะต:**
```
ะะพะดะธัะตะปั:
  position_x = 300
  position_y = 200
  height = 150

ะะพัะพะผะพะบ:
  position_x = 300
  position_y = 360
  height = 120
```

**ะะฐััะตั:**

**ะจะฐะณ 1: ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ัะพะดะธัะตะปั**
```
startX = 300 + (224 / 2) = 300 + 112 = 412
startY = 200 + 150 = 350
ะะตะทัะปััะฐั: (412, 350)
```

**ะจะฐะณ 2: ะขะพัะบะฐ ัะพะตะดะธะฝะตะฝะธั ะฟะพัะพะผะบะฐ**
```
endX = 300 + (224 / 2) = 300 + 112 = 412
endY = 360
ะะตะทัะปััะฐั: (412, 360)
```

**ะจะฐะณ 3: ะะพะฝััะพะปัะฝัะต ัะพัะบะธ**
```
controlY = 350 + (360 - 350) / 2 = 350 + 5 = 355
ะะตัะฒะฐั ะบะพะฝััะพะปัะฝะฐั: (412, 355)
ะัะพัะฐั ะบะพะฝััะพะปัะฝะฐั: (412, 355)
```

**ะจะฐะณ 4: ะัะธะฒะฐั ะะตะทัะต**
```
path = "M 412 350 C 412 355, 412 355, 412 360"
```

**ะจะฐะณ 5: ะะธะทัะฐะปะธะทะฐัะธั**
```
     (412, 350) โ ะะพะดะธัะตะปั
          โ
          โ 10px
          โ
     (412, 355) โ ะะพะฝััะพะปัะฝะฐั
          โ
          โ
     (412, 360) โ ะะพัะพะผะพะบ
```

---

## ะะฟัะธะผะธะทะฐัะธั ะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะคะธะปัััะฐัะธั ะฟะตัะตะด ะพััะธัะพะฒะบะพะน

**ะะฟัะธะผะธะทะฐัะธั:**
```typescript
tasks
  .filter((task) => task.parent_id)  // โ ะขะพะปัะบะพ ะทะฐะดะฐัะธ ั ัะพะดะธัะตะปะตะผ
  .map((task) => {
    // ...
  })
  .filter(Boolean)  // โ ะฃะดะฐะปะตะฝะธะต null ะทะฝะฐัะตะฝะธะน
```

**ะัะตะธะผััะตััะฒะฐ:**
- ะััะธัะพะฒัะฒะฐัััั ัะพะปัะบะพ ะฝะตะพะฑัะพะดะธะผัะต ัะพะตะดะธะฝะตะฝะธั
- ะัะพะฟััะบะฐัััั ะทะฐะดะฐัะธ ะฑะตะท ัะพะดะธัะตะปั
- ะฃะดะฐะปััััั ะฝะตะฒะฐะปะธะดะฝัะต ัะฒัะทะธ (ัะพะดะธัะตะปั ะฝะต ะฝะฐะนะดะตะฝ)

---

### ะะตะผะพะธะทะฐัะธั (ะฟะพัะตะฝัะธะฐะปัะฝะฐั ะพะฟัะธะผะธะทะฐัะธั)

**ะขะตะบััะฐั ัะตะฐะปะธะทะฐัะธั:** ะคัะฝะบัะธั ะฒัะทัะฒะฐะตััั ะฟัะธ ะบะฐะถะดะพะผ ัะตะฝะดะตัะต

**ะะพัะตะฝัะธะฐะปัะฝะฐั ะพะฟัะธะผะธะทะฐัะธั:**
```typescript
const drawTaskConnections = useMemo(() => {
  // ... ะปะพะณะธะบะฐ ะพััะธัะพะฒะบะธ
}, [tasks, draggingTaskId, draggingPosition, taskHeights])
```

**ะะฐะฒะธัะธะผะพััะธ:**
- `tasks` - ัะฟะธัะพะบ ะทะฐะดะฐั
- `draggingTaskId` - ID ะฟะตัะตัะฐัะบะธะฒะฐะตะผะพะน ะทะฐะดะฐัะธ
- `draggingPosition` - ะฒัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั
- `taskHeights` - ะฒััะพัั ะบะฐััะพัะตะบ

**ะัะธะผะตัะฐะฝะธะต:** ะ ัะตะบััะตะน ัะตะฐะปะธะทะฐัะธะธ ะผะตะผะพะธะทะฐัะธั ะฝะต ะธัะฟะพะปัะทัะตััั, ัะฐะบ ะบะฐะบ ััะฝะบัะธั ะฒัะทัะฒะฐะตััั ะฒะฝัััะธ JSX

---

### ะะพะปะธัะตััะฒะพ ัะพะตะดะธะฝะตะฝะธะน

**ะะณัะฐะฝะธัะตะฝะธั:**
- ะะฐะบัะธะผะฐะปัะฝะพะต ะบะพะปะธัะตััะฒะพ ัะพะตะดะธะฝะตะฝะธะน = ะบะพะปะธัะตััะฒะพ ะทะฐะดะฐั ั ัะพะดะธัะตะปะตะผ
- ะ ััะดัะตะผ ัะปััะฐะต: N-1 ัะพะตะดะธะฝะตะฝะธะน (ะณะดะต N - ะบะพะปะธัะตััะฒะพ ะทะฐะดะฐั)
- ะะฐะถะดะพะต ัะพะตะดะธะฝะตะฝะธะต = 3 SVG ัะปะตะผะตะฝัะฐ (path + 2 circles)

**ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั:**
- ะะปั 100 ะทะฐะดะฐั: ~99 ัะพะตะดะธะฝะตะฝะธะน = ~297 SVG ัะปะตะผะตะฝัะพะฒ
- ะะปั 1000 ะทะฐะดะฐั: ~999 ัะพะตะดะธะฝะตะฝะธะน = ~2997 SVG ัะปะตะผะตะฝัะพะฒ

**ะะตะบะพะผะตะฝะดะฐัะธะธ:**
- ะะปั ะฑะพะปััะธั ะฟัะพะตะบัะพะฒ ะผะพะถะฝะพ ะดะพะฑะฐะฒะธัั ะฒะธัััะฐะปะธะทะฐัะธั
- ะัะพะฑัะฐะถะฐัั ัะพะปัะบะพ ัะพะตะดะธะฝะตะฝะธั ะฒ ะฒะธะดะธะผะพะน ะพะฑะปะฐััะธ
- ะัะฟะพะปัะทะพะฒะฐัั canvas ะฒะผะตััะพ SVG ะดะปั ะปัััะตะน ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

---

## ะัะธะผะตัั ะธ ััะตะฝะฐัะธะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะัะพััะพะต ัะพะตะดะธะฝะตะฝะธะต (ะฒะตััะธะบะฐะปัะฝะพะต)

**ะกัะตะฝะฐัะธะน:**
- ะะพะดะธัะตะปั: `position_x = 400, position_y = 100, height = 150`
- ะะพัะพะผะพะบ: `position_x = 400, position_y = 300`

**ะะฐััะตั:**
```
parentWidth = 224
childWidth = 224

startX = 400 + 224/2 = 512
startY = 100 + 150 = 250

endX = 400 + 224/2 = 512
endY = 300

controlY = 250 + (300 - 250)/2 = 275
```

**ะะตะทัะปััะฐั:**
```
Path: M 512 250 C 512 275, 512 275, 512 300
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
     (512, 250) โ ะะพะดะธัะตะปั
          โ
          โ
          โ  (ะฟััะผะฐั ะฒะตััะธะบะฐะปัะฝะฐั ะปะธะฝะธั)
          โ
     (512, 300) โ ะะพัะพะผะพะบ
```

---

### ะัะธะผะตั 2: ะกะพะตะดะธะฝะตะฝะธะต ัะพ ัะผะตัะตะฝะธะตะผ (ะดะธะฐะณะพะฝะฐะปัะฝะพะต)

**ะกัะตะฝะฐัะธะน:**
- ะะพะดะธัะตะปั: `position_x = 300, position_y = 100, height = 150`
- ะะพัะพะผะพะบ: `position_x = 500, position_y = 350`

**ะะฐััะตั:**
```
startX = 300 + 224/2 = 412
startY = 100 + 150 = 250

endX = 500 + 224/2 = 612
endY = 350

controlY = 250 + (350 - 250)/2 = 300
```

**ะะตะทัะปััะฐั:**
```
Path: M 412 250 C 412 300, 612 300, 612 350
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
     (412, 250) โ ะะพะดะธัะตะปั
          โ
          โ
          โ
          โ
     (412, 300) โโโโโโโโโโโโ (612, 300)
          โ                      โ
          โ                      โ
          โ                      โ
                              (612, 350) โ ะะพัะพะผะพะบ
```

**ะคะพัะผะฐ:** S-ะพะฑัะฐะทะฝะฐั ะบัะธะฒะฐั

---

### ะัะธะผะตั 3: ะะตัะตัะฐัะบะธะฒะฐะฝะธะต ัะพะดะธัะตะปััะบะพะน ะทะฐะดะฐัะธ

**ะกัะตะฝะฐัะธะน:**
- ะะพะดะธัะตะปั ะฟะตัะตัะฐัะบะธะฒะฐะตััั
- `draggingPosition = {x: 600, y: 200}`
- ะะพัะพะผะพะบ ะฝะต ะฟะตัะตัะฐัะบะธะฒะฐะตััั: `position_x = 400, position_y = 400`

**ะะฐััะตั:**
```
isParentDragging = true
isTaskDragging = false

startX = 600 + 224/2 = 712  // โ ะัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั
startY = 200 + 150 = 350    // โ ะัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั

endX = 400 + 224/2 = 512    // โ ะกะพััะฐะฝะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั
endY = 400                   // โ ะกะพััะฐะฝะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั

controlY = 350 + (400 - 350)/2 = 375
```

**ะะตะทัะปััะฐั:**
```
Path: M 712 350 C 712 375, 512 375, 512 400
```

**ะะธะทัะฐะปะธะทะฐัะธั:**
- ะกะพะตะดะธะฝะตะฝะธะต ะพะฑะฝะพะฒะปัะตััั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั, ะบะฐะบ ะฑัะดะตั ะฒัะณะปัะดะตัั ัะฒัะทั ะฟะพัะปะต ะฟะตัะตะผะตัะตะฝะธั
- ะะพัะปะต ะพัะฟััะบะฐะฝะธั ะผััะธ ะบะพะพัะดะธะฝะฐัั ัะพััะฐะฝััััั ะฒ ะะ

---

### ะัะธะผะตั 4: ะะตัะตัะฐัะบะธะฒะฐะฝะธะต ะดะพัะตัะฝะตะน ะทะฐะดะฐัะธ

**ะกัะตะฝะฐัะธะน:**
- ะะพะดะธัะตะปั ะฝะต ะฟะตัะตัะฐัะบะธะฒะฐะตััั: `position_x = 300, position_y = 100`
- ะะพัะพะผะพะบ ะฟะตัะตัะฐัะบะธะฒะฐะตััั
- `draggingPosition = {x: 500, y: 400}`

**ะะฐััะตั:**
```
isParentDragging = false
isTaskDragging = true

startX = 300 + 224/2 = 412  // โ ะกะพััะฐะฝะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั
startY = 100 + 150 = 250    // โ ะกะพััะฐะฝะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั

endX = 500 + 224/2 = 612    // โ ะัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั
endY = 400                   // โ ะัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั

controlY = 250 + (400 - 250)/2 = 325
```

**ะะตะทัะปััะฐั:**
```
Path: M 412 250 C 412 325, 612 325, 612 400
```

---

### ะัะธะผะตั 5: ะะฝะพะถะตััะฒะตะฝะฝัะต ะฟะพัะพะผะบะธ

**ะกัะตะฝะฐัะธะน:**
- ะะพะดะธัะตะปั: `id = "parent", position_x = 400, position_y = 100`
- ะะพัะพะผะพะบ 1: `id = "child1", parent_id = "parent", position_x = 300, position_y = 300`
- ะะพัะพะผะพะบ 2: `id = "child2", parent_id = "parent", position_x = 500, position_y = 300`

**ะะตะทัะปััะฐั:**
- ะกะพะทะดะฐัััั 2 ัะพะตะดะธะฝะตะฝะธั:
  1. `parent โ child1`: `M 512 250 C 512 275, 412 275, 412 300`
  2. `parent โ child2`: `M 512 250 C 512 275, 612 275, 612 300`

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
     (512, 250) โ ะะพะดะธัะตะปั
          โ
          โโโโโโโโโโโโโโโโโ
          โ               โ
          โ               โ
     (412, 300)      (612, 300)
     ะะพัะพะผะพะบ 1      ะะพัะพะผะพะบ 2
```

---

### ะัะธะผะตั 6: ะะตัะฐััะธั (3 ััะพะฒะฝั)

**ะกัะตะฝะฐัะธะน:**
- ะฃัะพะฒะตะฝั 1: `Task A` (parent_id = null)
- ะฃัะพะฒะตะฝั 2: `Task B` (parent_id = "Task A")
- ะฃัะพะฒะตะฝั 3: `Task C` (parent_id = "Task B")

**ะะตะทัะปััะฐั:**
- ะกะพะทะดะฐัััั 2 ัะพะตะดะธะฝะตะฝะธั:
  1. `Task A โ Task B`
  2. `Task B โ Task C`

**ะะธะทัะฐะปะธะทะฐัะธั:**
```
     Task A
       โ
       โ
     Task B
       โ
       โ
     Task C
```

**ะัะพะฑะตะฝะฝะพััั:** ะะฐะถะดะพะต ัะพะตะดะธะฝะตะฝะธะต ะพััะธัะพะฒัะฒะฐะตััั ะฝะตะทะฐะฒะธัะธะผะพ

---

## ะะตัะฐะปัะฝัะน ัะฐะทะฑะพั ัะพัะผัะปั ะบัะธะฒะพะน ะะตะทัะต

### ะะฐัะฐะผะตััะธัะตัะบะพะต ััะฐะฒะฝะตะฝะธะต

**ะะฑัะฐั ัะพัะผัะปะฐ ะบัะฑะธัะตัะบะพะน ะบัะธะฒะพะน ะะตะทัะต:**

```
B(t) = (1-t)ยณPโ + 3(1-t)ยฒtPโ + 3(1-t)tยฒPโ + tยณPโ
```

ะะดะต `t โ [0, 1]` - ะฟะฐัะฐะผะตัั ะบัะธะฒะพะน

---

### ะะฐะทะปะพะถะตะฝะธะต ะฟะพ ะบะพะผะฟะพะฝะตะฝัะฐะผ

**X ะบะพะผะฟะพะฝะตะฝัะฐ:**
```
X(t) = (1-t)ยณยทstartX + 3(1-t)ยฒtยทstartX + 3(1-t)tยฒยทendX + tยณยทendX
```

**Y ะบะพะผะฟะพะฝะตะฝัะฐ:**
```
Y(t) = (1-t)ยณยทstartY + 3(1-t)ยฒtยทcontrolY + 3(1-t)tยฒยทcontrolY + tยณยทendY
```

---

### ะฃะฟัะพัะตะฝะธะต ะดะปั ะฝะฐัะตะณะพ ัะปััะฐั

**ะฃัะปะพะฒะธะต:** `startX === endX` (ะทะฐะดะฐัะธ ะฝะฐ ะพะดะฝะพะน ะฒะตััะธะบะฐะปะธ)

**X ะบะพะผะฟะพะฝะตะฝัะฐ ัะฟัะพัะฐะตััั:**
```
X(t) = startX = endX  (ะฟะพััะพัะฝะฝะฐั)
```

**Y ะบะพะผะฟะพะฝะตะฝัะฐ:**
```
Y(t) = (1-t)ยณยทstartY + 3(1-t)ยฒtยทcontrolY + 3(1-t)tยฒยทcontrolY + tยณยทendY
     = (1-t)ยณยทstartY + 3(1-t)tยทcontrolY + tยณยทendY
```

**ะะดะต:**
```
controlY = (startY + endY) / 2
```

---

### ะะปััะตะฒัะต ัะพัะบะธ ะฝะฐ ะบัะธะฒะพะน

**t = 0 (ะฝะฐัะฐะปะพ):**
```
X(0) = startX
Y(0) = startY
```

**t = 0.5 (ัะตัะตะดะธะฝะฐ):**
```
X(0.5) = startX
Y(0.5) = 0.125ยทstartY + 0.75ยทcontrolY + 0.125ยทendY
       โ controlY  (ะฟัะธะฑะปะธะทะธัะตะปัะฝะพ)
```

**t = 1 (ะบะพะฝะตั):**
```
X(1) = endX
Y(1) = endY
```

---

### ะะฐัะฐัะตะปัะฝัะต ะฒะตะบัะพัั

**ะัะพะธะทะฒะพะดะฝะฐั (ะฝะฐะฟัะฐะฒะปะตะฝะธะต ะบัะธะฒะพะน):**

```
B'(t) = -3(1-t)ยฒPโ + 3(1-t)(1-3t)Pโ + 3t(2-3t)Pโ + 3tยฒPโ
```

**ะ ะฝะฐัะฐะปัะฝะพะน ัะพัะบะต (t=0):**
```
B'(0) = -3Pโ + 3Pโ = 3(Pโ - Pโ)
```

**ะ ะบะพะฝะตัะฝะพะน ัะพัะบะต (t=1):**
```
B'(1) = -3Pโ + 3Pโ = 3(Pโ - Pโ)
```

**ะ ะฝะฐัะตะผ ัะปััะฐะต:**
- ะะฐัะฐะปัะฝะฐั ะบะฐัะฐัะตะปัะฝะฐั: ะฒะตััะธะบะฐะปัะฝะฐั (ะฒะฝะธะท)
- ะะพะฝะตัะฝะฐั ะบะฐัะฐัะตะปัะฝะฐั: ะฒะตััะธะบะฐะปัะฝะฐั (ะฒะฒะตัั)

---

## ะะฑัะฐะฑะพัะบะฐ ะณัะฐะฝะธัะฝัั ัะปััะฐะตะฒ

### ะกะปััะฐะน 1: ะะพะดะธัะตะปั ะฝะต ะฝะฐะนะดะตะฝ

**ะกะธััะฐัะธั:** `task.parent_id` ัััะตััะฒัะตั, ะฝะพ ัะพะดะธัะตะปััะบะฐั ะทะฐะดะฐัะฐ ะฝะต ะฝะฐะนะดะตะฝะฐ ะฒ ัะฟะธัะบะต

**ะะฑัะฐะฑะพัะบะฐ:**
```typescript
const parent = tasks.find((t) => t.id === task.parent_id)
if (!parent) return null  // โ ะกะพะตะดะธะฝะตะฝะธะต ะฝะต ะพััะธัะพะฒัะฒะฐะตััั
```

**ะัะธัะธะฝั:**
- ะะพะดะธัะตะปััะบะฐั ะทะฐะดะฐัะฐ ะฑัะปะฐ ัะดะฐะปะตะฝะฐ
- ะะพะดะธัะตะปั ะฝะฐัะพะดะธััั ะฒ ะดััะณะพะผ ะฟัะพะตะบัะต
- ะัะธะฑะบะฐ ะฒ ะดะฐะฝะฝัั

**ะะตะทัะปััะฐั:** ะกะพะตะดะธะฝะตะฝะธะต ะฝะต ะพััะธัะพะฒัะฒะฐะตััั, ะทะฐะดะฐัะฐ ะพััะฐะตััั ะฑะตะท ัะฒัะทะธ

---

### ะกะปััะฐะน 2: ะะฐะดะฐัะธ ะฟะตัะตะบััะฒะฐัััั

**ะกะธััะฐัะธั:** ะะพัะตัะฝัั ะทะฐะดะฐัะฐ ะฝะฐัะพะดะธััั ะฒััะต ัะพะดะธัะตะปััะบะพะน

**ะะฐััะตั:**
```
startY = parent.position_y + parentHeight  // ะะธะถะฝัั ัะพัะบะฐ ัะพะดะธัะตะปั
endY = task.position_y                     // ะะตััะฝัั ัะพัะบะฐ ะฟะพัะพะผะบะฐ

// ะัะปะธ endY < startY โ ะทะฐะดะฐัะธ ะฟะตัะตะบััะฒะฐัััั
```

**ะะตะทัะปััะฐั:** ะัะธะฒะฐั ะฒัะต ัะฐะฒะฝะพ ะพััะธัะพะฒัะฒะฐะตััั, ะฝะพ ะผะพะถะตั ะฒัะณะปัะดะตัั ัััะฐะฝะฝะพ

**ะะตะบะพะผะตะฝะดะฐัะธั:** ะะพะฑะฐะฒะธัั ะฟัะพะฒะตัะบั ะธ ะฟัะตะดัะฟัะตะถะดะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั

---

### ะกะปััะฐะน 3: ะัะตะฝั ะฑะพะปััะพะต ัะฐัััะพัะฝะธะต

**ะกะธััะฐัะธั:** ะะฐะดะฐัะธ ะฝะฐัะพะดัััั ะพัะตะฝั ะดะฐะปะตะบะพ ะดััะณ ะพั ะดััะณะฐ

**ะะฐััะตั:**
```
distance = Math.sqrt((endX - startX)ยฒ + (endY - startY)ยฒ)
```

**ะะตะทัะปััะฐั:** ะัะธะฒะฐั ะพััะธัะพะฒัะฒะฐะตััั, ะฝะพ ะผะพะถะตั ะฑััั ะฝะต ะฒะธะดะฝะฐ ะฝะฐ ัะบัะฐะฝะต

**ะะฟัะธะผะธะทะฐัะธั:** ะะพะถะฝะพ ะดะพะฑะฐะฒะธัั ะฟัะพะฒะตัะบั ะฒะธะดะธะผะพััะธ ะธ ะฝะต ะพััะธัะพะฒัะฒะฐัั ะฝะตะฒะธะดะธะผัะต ัะพะตะดะธะฝะตะฝะธั

---

### ะกะปััะฐะน 4: ะะฐัััะฐะฑ ะพัะตะฝั ะผะฐะปะตะฝัะบะธะน

**ะกะธััะฐัะธั:** `scale < 0.3` (ะพัะตะฝั ัะธะปัะฝะพะต ัะผะตะฝััะตะฝะธะต)

**ะะตะทัะปััะฐั:**
- ะะธะฝะธะธ ััะฐะฝะพะฒัััั ะพัะตะฝั ัะพะฝะบะธะผะธ
- ะขะพัะบะธ ััะฐะฝะพะฒัััั ะพัะตะฝั ะผะฐะปะตะฝัะบะธะผะธ
- ะกะพะตะดะธะฝะตะฝะธั ะผะพะณัั ะฑััั ะฟะปะพัะพ ะฒะธะดะฝั

**ะะตะบะพะผะตะฝะดะฐัะธั:** ะะพะถะฝะพ ัะบััะฒะฐัั ัะพะตะดะธะฝะตะฝะธั ะฟัะธ ะพัะตะฝั ะผะฐะปะตะฝัะบะพะผ ะผะฐัััะฐะฑะต

---

## ะะธะทัะฐะปัะฝัะต ัะปัััะตะฝะธั (ะฟะพัะตะฝัะธะฐะปัะฝัะต)

### ะะฝะธะผะฐัะธั ะฟะพัะฒะปะตะฝะธั ัะพะตะดะธะฝะตะฝะธั

**ะขะตะบััะฐั ัะตะฐะปะธะทะฐัะธั:** ะกะพะตะดะธะฝะตะฝะธั ะฟะพัะฒะปััััั ะผะณะฝะพะฒะตะฝะฝะพ

**ะะพัะตะฝัะธะฐะปัะฝะพะต ัะปัััะตะฝะธะต:**
```tsx
<path
  d={path}
  stroke="rgba(255, 255, 255, 0.3)"
  strokeWidth="2"
  fill="none"
  strokeDasharray={pathLength}
  strokeDashoffset={pathLength}
  style={{
    animation: `drawLine 0.5s ease-out forwards`
  }}
/>
```

**ะญััะตะบั:** ะะธะฝะธั "ัะธััะตััั" ะพั ะฝะฐัะฐะปะฐ ะบ ะบะพะฝัั

---

### ะะพะดัะฒะตัะบะฐ ะฟัะธ hover

**ะะพัะตะฝัะธะฐะปัะฝะพะต ัะปัััะตะฝะธะต:**
```tsx
<path
  d={path}
  stroke="rgba(255, 255, 255, 0.3)"
  strokeWidth="2"
  className="hover:stroke-white/60 transition-colors"
/>
```

**ะญััะตะบั:** ะะธะฝะธั ััะฐะฝะพะฒะธััั ัััะต ะฟัะธ ะฝะฐะฒะตะดะตะฝะธะธ

---

### ะะฐะทะฝัะต ััะธะปะธ ะดะปั ัะฐะทะฝัั ัะธะฟะพะฒ ัะฒัะทะตะน

**ะะพัะตะฝัะธะฐะปัะฝะพะต ัะปัััะตะฝะธะต:**
```typescript
const getConnectionStyle = (task: Task) => {
  if (task.status === 'completed') {
    return { stroke: 'rgba(34, 197, 94, 0.5)' }  // ะะตะปะตะฝัะน
  }
  if (task.status === 'blocked') {
    return { stroke: 'rgba(239, 68, 68, 0.5)' }   // ะัะฐัะฝัะน
  }
  return { stroke: 'rgba(255, 255, 255, 0.3)' }   // ะะตะปัะน
}
```

**ะญััะตะบั:** ะฆะฒะตั ัะพะตะดะธะฝะตะฝะธั ะทะฐะฒะธัะธั ะพั ััะฐัััะฐ ะทะฐะดะฐัะธ

---

## ะะฐะบะปััะตะฝะธะต

ะกะธััะตะผะฐ ัะพะตะดะธะฝะตะฝะธะน ะทะฐะดะฐั ะฟัะตะดััะฐะฒะปัะตั ัะพะฑะพะน ัะปะพะถะฝัะน ะผะตัะฐะฝะธะทะผ ะฒะธะทัะฐะปะธะทะฐัะธะธ ะธะตัะฐััะธัะตัะบะธั ัะฒัะทะตะน. ะะปััะตะฒัะต ะฐัะฟะตะบัั:

1. **ะกะพะทะดะฐะฝะธะต ัะฒัะทะตะน:** ะงะตัะตะท ะฟะพะปะต `parent_id` ะฒ ัะฐะฑะปะธัะต `tasks`
2. **ะััะธัะพะฒะบะฐ:** ะคัะฝะบัะธั `drawTaskConnections()` ัะพะทะดะฐะตั SVG ัะปะตะผะตะฝัั
3. **ะะฐัะตะผะฐัะธะบะฐ:** ะัะฑะธัะตัะบะฐั ะบัะธะฒะฐั ะะตะทัะต ั ะบะพะฝััะพะปัะฝัะผะธ ัะพัะบะฐะผะธ
4. **ะะตะฐะปัะฐะนะผ:** ะะฑะฝะพะฒะปะตะฝะธะต ะฟัะธ ะฟะตัะตัะฐัะบะธะฒะฐะฝะธะธ ัะตัะตะท ะฒัะตะผะตะฝะฝัะต ะบะพะพัะดะธะฝะฐัั
5. **ะััะพัะฐ:** ะััะปะตะถะธะฒะฐะฝะธะต ัะตัะตะท ResizeObserver ะดะปั ัะพัะฝะพะณะพ ะฟะพะทะธัะธะพะฝะธัะพะฒะฐะฝะธั
6. **ะะธะทัะฐะปะธะทะฐัะธั:** ะะพะปัะฟัะพะทัะฐัะฝัะต ะปะธะฝะธะธ ะธ ัะพัะบะธ ัะพะตะดะธะฝะตะฝะธั

**ะะปั ัะตะฐะปะธะทะฐัะธะธ ะฒ ะฝะพะฒะพะผ ะฟัะพะตะบัะต:**
- ะัะฟะพะปัะทัะนัะต ัั ะถะต ะปะพะณะธะบั ะฒััะธัะปะตะฝะธั ะบะพะพัะดะธะฝะฐั
- ะัะธะผะตะฝะธัะต ัะพัะผัะปั ะบัะฑะธัะตัะบะพะน ะบัะธะฒะพะน ะะตะทัะต
- ะะตะฐะปะธะทัะนัะต ะพััะปะตะถะธะฒะฐะฝะธะต ะฒััะพัั ะบะฐััะพัะตะบ
- ะะฑะตัะฟะตัััะต ะพะฑะฝะพะฒะปะตะฝะธะต ะฟัะธ ะฟะตัะตัะฐัะบะธะฒะฐะฝะธะธ
- ะัะฟะพะปัะทัะนัะต SVG ะดะปั ะพััะธัะพะฒะบะธ (ะธะปะธ Canvas ะดะปั ะปัััะตะน ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ)
